<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F10%2F28%2F20251028-100943.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F10%2F28%2F20251028-100948.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/manifest.json">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-corner-indicator.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ikoct.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="好玩, 以后不玩了">
<meta property="og:type" content="article">
<meta property="og:title" content="KCTF2025 Writeups">
<meta property="og:url" content="https://ikoct.com/2025/09/09/KCTF2025-Writeups/">
<meta property="og:site_name" content="Ikoct的饮冰室">
<meta property="og:description" content="好玩, 以后不玩了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154142.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-102206.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-102320.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-103109.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-103351.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-103833.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-104012.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-104155.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-110311.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154351.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154411.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154351.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154433.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154456.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154507.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154512.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154353.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F18%2F20250918-102736.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154611.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154613.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154615.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154616.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154622.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154626.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154844.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154954.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154858.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154902.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154737.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155043.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155032.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155126.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155239.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155250.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154738.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154738.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155254.png">
<meta property="og:image" content="f:/Learn/REprac/KCTF2025/6/assets/%7B6D7BEEB9-344B-4566-ABFE-14BFF6CE9FA4%7D">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154738.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154739.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155259.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-092530.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-092820.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-093050.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-093954.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-094511.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-094740.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-094937.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-095143.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-095539.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F03%2F20250903-164202.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F03%2F20250903-164237.png">
<meta property="article:published_time" content="2025-09-09T07:57:42.000Z">
<meta property="article:modified_time" content="2025-10-02T05:58:09.374Z">
<meta property="article:author" content="1K0CT B14s">
<meta property="article:tag" content="Reverse">
<meta property="article:tag" content="Writeups">
<meta property="article:tag" content="Pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154142.png">

<link rel="canonical" href="https://ikoct.com/2025/09/09/KCTF2025-Writeups/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>KCTF2025 Writeups | Ikoct的饮冰室</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ikoct的饮冰室</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">你愿意和我学一辈子二进制吗?</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ikoct.com/2025/09/09/KCTF2025-Writeups/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F10%2F28%2F20251028-101335.gif">
      <meta itemprop="name" content="1K0CT B14s">
      <meta itemprop="description" content="残りの人生、私にくれませんか？">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ikoct的饮冰室">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          KCTF2025 Writeups
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-09 15:57:42" itemprop="dateCreated datePublished" datetime="2025-09-09T15:57:42+08:00">2025-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-02 13:58:09" itemprop="dateModified" datetime="2025-10-02T13:58:09+08:00">2025-10-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/" itemprop="url" rel="index"><span itemprop="name">二进制</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>46k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>42 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>好玩, 以后不玩了</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154142.png" alt="QQ_1757403693172"></p>
<span id="more"></span>

<h2 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h2><p>字符串定位到校验的位置:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-102206.png" alt="QQ_1755397308067"></p>
<p>校验函数里就是一个字节一个字节地明文校验, 得到flag:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-102320.png" alt="QQ_1755397397041"></p>
<h2 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h2><p>主函数中输入长度小于0x70时会进入<code>check</code>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-103109.png" alt="QQ_1755397836021"></p>
<p>但是函数结构很奇怪, <code>push ebp</code>后进入7011b6执行了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov     [esp+arg_0], offset sub_701EEB</span><br><span class="line">retn</span><br></pre></td></tr></table></figure>

<p>也就是调整栈指针然后直接修改返回地址, 这是一个跳板, 进入跳板跳到地函数, 先是又执行了一个<code>strlen</code>然后<code>push edi</code>又进入了一个跳板:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-103351.png" alt="QQ_1755398022466"></p>
<p>新的跳板跳向了<code>loc_70129F</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov     [esp+arg_0], offset loc_70129F</span><br><span class="line">retn</span><br></pre></td></tr></table></figure>

<p>所以实际上<code>check</code>函数先是通过跳板的方法执行了一个<code>strlen</code>然后跳回<code>check</code>来达成控制流混淆, patch成下面的样子就能让IDA正常反编译了:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-103833.png" alt="QQ_1755398290721"></p>
<p>然后分析<code>check</code>的功能, 先是根据当前位的输入在一个<code>0-9a-z</code>的表里取idx:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-104012.png" alt="QQ_1755398397795"></p>
<p>然后根据这个idx以及当前所在是奇偶位来确定三个变量<code>x, y, z</code>, 很容易联想到是一个迷宫程序:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-104155.png" alt="QQ_1755398468338"></p>
<p>也就是每一步由输入的2个字节来确定, 第一个确定<code>y</code>, 第二个确定<code>x, z</code>, 同时限定起点是<code>0x2c0e</code>终点是<code>0x1fb2</code>,  每次行动完的位置与上一次的位置曼哈顿距离必须是1, 剩下的一个限制就在<code>defactor_prime</code>中:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> __cdecl <span class="title function_">defactor_prime</span><span class="params">(<span class="type">int</span> n4_1, <span class="type">int</span> *p_n2, <span class="type">int</span> *p_n3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> n2; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> n4_2; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> n2_3; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> n2_2; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> n2_1; <span class="comment">// [esp+1Ch] [ebp-4h]</span></span><br><span class="line">  <span class="type">int</span> n4_3; <span class="comment">// [esp+24h] [ebp+4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( n4_1 &lt; <span class="number">4</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  n2 = <span class="number">2</span>;</span><br><span class="line">  n2_1 = <span class="number">2</span>;</span><br><span class="line">  n4_2 = (<span class="type">int</span>)<span class="built_in">sqrt</span>((<span class="type">double</span>)n4_1);</span><br><span class="line">  n4_3 = n4_2;</span><br><span class="line">  <span class="keyword">if</span> ( n4_2 &lt; <span class="number">2</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( n4_1 % n2 || n2 &lt; <span class="number">2</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">    n2_3 = <span class="number">2</span>;</span><br><span class="line">    n2_2 = (<span class="type">int</span>)<span class="built_in">sqrt</span>((<span class="type">double</span>)n2_1);</span><br><span class="line">    <span class="keyword">if</span> ( n2_2 &gt;= <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( n2 % n2_3 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( ++n2_3 &gt; n2_2 )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_8:</span><br><span class="line">    <span class="keyword">if</span> ( is_prime(n4_1 / n2) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">LABEL_9:</span><br><span class="line">    n4_2 = n4_3;</span><br><span class="line">LABEL_10:</span><br><span class="line">    n2_1 = ++n2;</span><br><span class="line">    <span class="keyword">if</span> ( n2 &gt; n4_2 )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( p_n2 )</span><br><span class="line">    *p_n2 = n2;</span><br><span class="line">  <span class="keyword">if</span> ( p_n3 )</span><br><span class="line">    *p_n3 = n4_1 / n2;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>sqrt</code>是牛顿迭代法求根, 猜测这是分解质因数的程序, 调试也可以验证确实是, 接下来就是写程序打印地图:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="built_in">round</span>(math.sqrt(n)) + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">defactor_prime</span>(<span class="params">n: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    limit = <span class="built_in">round</span>(math.sqrt(n))</span><br><span class="line">    <span class="keyword">if</span> limit &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, limit + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">            q = n // p</span><br><span class="line">            <span class="keyword">if</span> is_prime(p) <span class="keyword">and</span> is_prime(q):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span> = [<span class="number">0x2C0E</span>, <span class="number">0x1312</span>, <span class="number">0x7F44</span>, <span class="number">0x4C2B</span>, <span class="number">0x966</span>, <span class="number">0x1E12</span>, <span class="number">0x1263</span>, <span class="number">0x1828</span>, <span class="number">0x31A1</span>, <span class="number">0x52AE</span>, <span class="number">0x1DC6</span>, <span class="number">0x4019</span>, <span class="number">0x3D89</span>, <span class="number">0x614D</span>, <span class="number">0x1A4A</span>, <span class="number">0x3A24</span>, <span class="number">0x5406</span>, <span class="number">0xE61</span>, <span class="number">0x658</span>, <span class="number">0xD4C</span>, <span class="number">0x5423</span>, <span class="number">0x4860</span>, <span class="number">0x7988</span>, <span class="number">0x1FA3</span>, <span class="number">0x705B</span>, <span class="number">0x4464</span>, <span class="number">0x63EF</span>, <span class="number">0x403E</span>, <span class="number">0x50CB</span>, <span class="number">0x1676</span>, <span class="number">0x5132</span>, <span class="number">0x68B5</span>, <span class="number">0x4A38</span>, <span class="number">0x6FF5</span>, <span class="number">0x189B</span>, <span class="number">0x170B</span>, <span class="number">0x2704</span>, <span class="number">0x20ED</span>, <span class="number">0x4938</span>, <span class="number">0x47F6</span>, <span class="number">0x7512</span>, <span class="number">0x5196</span>, <span class="number">0x2B7C</span>, <span class="number">0x4A50</span>, <span class="number">0x2E54</span>, <span class="number">0x6FBE</span>, <span class="number">0x3532</span>, <span class="number">0x7B54</span>, <span class="number">0xABD</span>, <span class="number">0x2889</span>, <span class="number">0x56C0</span>, <span class="number">0x323B</span>, <span class="number">0x3698</span>, <span class="number">0x31CF</span>, <span class="number">0x435A</span>, <span class="number">0x75FA</span>, <span class="number">0xA2B</span>, <span class="number">0x200B</span>, <span class="number">0x45ED</span>, <span class="number">0x163F</span>, <span class="number">0x2554</span>, <span class="number">0x62BB</span>, <span class="number">0x3393</span>, <span class="number">0x2A31</span>, <span class="number">0x2956</span>, <span class="number">0x3004</span>, <span class="number">0x3684</span>, <span class="number">0x3DEE</span>, <span class="number">0x47AC</span>, <span class="number">0x2267</span>, <span class="number">0x629E</span>, <span class="number">0x1E93</span>, <span class="number">0x7943</span>, <span class="number">0x661B</span>, <span class="number">0x7FB4</span>, <span class="number">0x255A</span>, <span class="number">0x3D37</span>, <span class="number">0x1804</span>, <span class="number">0x69E1</span>, <span class="number">0x312C</span>, <span class="number">0x3999</span>, <span class="number">0x293F</span>, <span class="number">0x2F0E</span>, <span class="number">0x743A</span>, <span class="number">0x117</span>, <span class="number">0x64CD</span>, <span class="number">0x7C76</span>, <span class="number">0x5CBF</span>, <span class="number">0x6AB0</span>, <span class="number">0x585</span>, <span class="number">0x6CFC</span>, <span class="number">0x3CE6</span>, <span class="number">0x6FAB</span>, <span class="number">0xF81</span>, <span class="number">0x511C</span>, <span class="number">0x24E4</span>, <span class="number">0x785</span>, <span class="number">0x5AEB</span>, <span class="number">0x2977</span>, <span class="number">0xBFB</span>, <span class="number">0x55F8</span>, <span class="number">0x39</span>, <span class="number">0x29DD</span>, <span class="number">0x4987</span>, <span class="number">0x133B</span>, <span class="number">0x5E2F</span>, <span class="number">0x7F4D</span>, <span class="number">0x6497</span>, <span class="number">0x62C2</span>, <span class="number">0x3774</span>, <span class="number">0x1826</span>, <span class="number">0x78C</span>, <span class="number">0x20BB</span>, <span class="number">0x5473</span>, <span class="number">0x68B6</span>, <span class="number">0x27FB</span>, <span class="number">0x7321</span>, <span class="number">0x1B0E</span>, <span class="number">0x6280</span>, <span class="number">0x54E2</span>, <span class="number">0x5133</span>, <span class="number">0x61E7</span>, <span class="number">0x2F6B</span>, <span class="number">0x5AE2</span>, <span class="number">0x1B09</span>, <span class="number">0x64BB</span>, <span class="number">0x71B</span>, <span class="number">0x6272</span>, <span class="number">0x453F</span>, <span class="number">0x22BD</span>, <span class="number">0xD68</span>, <span class="number">0x52A9</span>, <span class="number">0x3116</span>, <span class="number">0x19AD</span>, <span class="number">0x28F6</span>, <span class="number">0x141E</span>, <span class="number">0x6B10</span>, <span class="number">0x32AC</span>, <span class="number">0x2394</span>, <span class="number">0x353D</span>, <span class="number">0x6A40</span>, <span class="number">0x697</span>, <span class="number">0x80E</span>, <span class="number">0x6883</span>, <span class="number">0x4297</span>, <span class="number">0x175D</span>, <span class="number">0xB3A</span>, <span class="number">0x4584</span>, <span class="number">0x4FB8</span>, <span class="number">0x55D2</span>, <span class="number">0x2592</span>, <span class="number">0x5F99</span>, <span class="number">0x5986</span>, <span class="number">0x5A84</span>, <span class="number">0x71A3</span>, <span class="number">0x3975</span>, <span class="number">0x525</span>, <span class="number">0x3E15</span>, <span class="number">0x823</span>, <span class="number">0x12D7</span>, <span class="number">0x78EF</span>, <span class="number">0x636B</span>, <span class="number">0x471A</span>, <span class="number">0x531C</span>, <span class="number">0x23F8</span>, <span class="number">0x38D7</span>, <span class="number">0x7E64</span>, <span class="number">0x18DB</span>, <span class="number">0x344E</span>, <span class="number">0x5655</span>, <span class="number">0x1C69</span>, <span class="number">0xEE8</span>, <span class="number">0x23C</span>, <span class="number">0x25C8</span>, <span class="number">0x684</span>, <span class="number">0x776D</span>, <span class="number">0xB65</span>, <span class="number">0x7855</span>, <span class="number">0x602D</span>, <span class="number">0x277E</span>, <span class="number">0x60AC</span>, <span class="number">0x1885</span>, <span class="number">0x6E40</span>, <span class="number">0x3EEC</span>, <span class="number">0x175C</span>, <span class="number">0xD2B</span>, <span class="number">0x4F2E</span>, <span class="number">0x645</span>, <span class="number">0x6C70</span>, <span class="number">0x457D</span>, <span class="number">0x5CD8</span>, <span class="number">0x2B12</span>, <span class="number">0x11C</span>, <span class="number">0x7AAD</span>, <span class="number">0x2E5E</span>, <span class="number">0x37CB</span>, <span class="number">0x5CF8</span>, <span class="number">0x5C48</span>, <span class="number">0x648F</span>, <span class="number">0x3841</span>, <span class="number">0x6344</span>, <span class="number">0x7F63</span>, <span class="number">0x5C2</span>, <span class="number">0xBE2</span>, <span class="number">0x717A</span>, <span class="number">0x7317</span>, <span class="number">0x711A</span>, <span class="number">0x4344</span>, <span class="number">0x319</span>, <span class="number">0x756E</span>, <span class="number">0x2F5E</span>, <span class="number">0x6EF2</span>, <span class="number">0x23B0</span>, <span class="number">0x1ED5</span>, <span class="number">0x5A1B</span>, <span class="number">0x5FFF</span>, <span class="number">0x7494</span>, <span class="number">0x5C4C</span>, <span class="number">0x7D2C</span>, <span class="number">0x2C51</span>, <span class="number">0x4BE4</span>, <span class="number">0x5197</span>, <span class="number">0x2384</span>, <span class="number">0x64DD</span>, <span class="number">0x62E9</span>, <span class="number">0x5019</span>, <span class="number">0x447E</span>, <span class="number">0x1DA1</span>, <span class="number">0x70B3</span>, <span class="number">0x5B03</span>, <span class="number">0x17BC</span>, <span class="number">0x4ED4</span>, <span class="number">0x3E1F</span>, <span class="number">0x26F8</span>, <span class="number">0x2AF2</span>, <span class="number">0x7B64</span>, <span class="number">0x4634</span>, <span class="number">0x69D9</span>, <span class="number">0x75A</span>, <span class="number">0x344B</span>, <span class="number">0x27D0</span>, <span class="number">0xC9C</span>, <span class="number">0x385E</span>, <span class="number">0x2496</span>, <span class="number">0x5635</span>, <span class="number">0x57AA</span>, <span class="number">0x44A8</span>, <span class="number">0x62AF</span>, <span class="number">0x65E7</span>, <span class="number">0x3284</span>, <span class="number">0x7A73</span>, <span class="number">0x1CCF</span>, <span class="number">0x25F4</span>, <span class="number">0x5DCD</span>, <span class="number">0x5CDE</span>, <span class="number">0x109B</span>, <span class="number">0x7890</span>, <span class="number">0x45CF</span>, <span class="number">0x5FEF</span>, <span class="number">0x4ABB</span>, <span class="number">0x26</span>, <span class="number">0x47D</span>, <span class="number">0x6121</span>, <span class="number">0x3A42</span>, <span class="number">0x5519</span>, <span class="number">0x32AF</span>, <span class="number">0x2096</span>, <span class="number">0x18E7</span>, <span class="number">0x4181</span>, <span class="number">0x1FB2</span>]</span><br><span class="line"></span><br><span class="line">bitmap = [[<span class="number">0</span>] * <span class="number">90</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">90</span>):</span><br><span class="line">        bitmap[i][j] = <span class="string">&#x27;*&#x27;</span> <span class="keyword">if</span> defactor_prime(<span class="built_in">map</span>[i * <span class="number">90</span> + j]) <span class="keyword">else</span> <span class="string">&#x27;#&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> z <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="built_in">print</span>(bitmap[i][j * <span class="number">10</span> + z], end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<p>得到地图后手动解出:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F08%2F17%2F20250817-110311.png" alt="QQ_1755399778768"></p>
<p>根据路径生成key:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&#x27;dsuddssaassddnssaauasuddddwwndddnwaawwuddwwdusdsssasssd&#x27;</span></span><br><span class="line">table = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line"></span><br><span class="line">key = [<span class="string">&#x27;?&#x27;</span>] * <span class="number">2</span> * <span class="built_in">len</span>(path)</span><br><span class="line">state = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, step <span class="keyword">in</span> <span class="built_in">enumerate</span>(path):</span><br><span class="line">    <span class="keyword">if</span> step == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">        state[<span class="number">2</span>] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> step == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        state[<span class="number">1</span>] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> step == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">        state[<span class="number">2</span>] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> step == <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">        state[<span class="number">1</span>] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> step == <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">        state[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> step == <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">        state[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    key[<span class="number">2</span> * idx] = table[state[<span class="number">1</span>]]</span><br><span class="line">    key[<span class="number">2</span> * idx + <span class="number">1</span>] = table[state[<span class="number">0</span>] * <span class="number">12</span> + state[<span class="number">2</span>]]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;00&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join(key))</span><br></pre></td></tr></table></figure>

<h2 id="第三题"><a href="#第三题" class="headerlink" title="第三题"></a>第三题</h2><p>程序为32位程序, 核心加密和校验在<code>0x0402380</code>.</p>
<p>由于题目不用写注册机, 只需要求<code>name</code>为<code>KCTF</code>时的序列号, 所以有关<code>name</code>的处理全部无视, 根据格式化字符串可以定位到在这里进行了序列号的初步处理:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154351.png" alt="image-20250819212333637"></p>
<p>以十六进制字符串形式将对应数据读取到内存后先进行了一个反转操作, 然后进入以下函数进行了按30bit进行分割:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154411.png" alt="QQ_1755610022715"></p>
<p>有python逆向经验的都可以察觉到这和python底层中<code>Py_Long</code>类型储存大数字的形式是一样的, 结合下面某个函数中的报错:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154351.png" alt="image-20250819212923190"></p>
<p>应该是将序列号作为一个大数字利进行了一些运算, 对于这些处理大数字的函数最好的分析方法就是调试猜测功能.</p>
<p>下面的处理还有几百行伪代码, 反正最后解密也要从尾开始, 接下来将从校验开始向上开始分析加密流程.</p>
<p>在最后校验处下断点, 修改用户名可以发现只有密文发生变化, 也就是说整个加密流程由序列号单独完成:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154433.png" alt="image-20250819214104301"></p>
<p>并且最后一步加密是反转然后第一个_DWORD自增, 因为最后的密文第一个字节固定是<code>b&#39;J&#39;</code>, 这里直接当是第一个字节自增就行了.</p>
<p>继续向上查找加密结果的来源, 在<code>from_bignum</code>上下断点, 最后的密文明显来自第二个参数:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154456.png" alt="image-20250819214918482"></p>
<p>结合上面对序列号初步处理的分析, 应该是将一个大数转化为字节串, 用以下函数来验证(由于程序用到多种大数, 这里给出我用到的几种转化):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span> get_bytes</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">origin_data2bignum</span>(<span class="params">data</span>):</span><br><span class="line">    bignum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">        r = data[i] &amp; <span class="number">0x3FFFFFFF</span></span><br><span class="line">        bignum |= r &lt;&lt; (<span class="number">30</span> * i)</span><br><span class="line">    <span class="keyword">return</span> bignum</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bignumat</span>(<span class="params">addr</span>):</span><br><span class="line">    digtsLen = <span class="built_in">int</span>.from_bytes(get_bytes(addr, <span class="number">4</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> digtsLen &gt;= <span class="number">0x1000</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    digtsAddr = addr + <span class="number">4</span></span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(digtsLen):</span><br><span class="line">        data.append(<span class="built_in">int</span>.from_bytes(get_bytes(digtsAddr + i * <span class="number">4</span>, <span class="number">4</span>), <span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> origin_data2bignum(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bignum1at</span>(<span class="params">addr</span>):</span><br><span class="line">    digitsAddr = <span class="built_in">int</span>.from_bytes(get_bytes(addr, <span class="number">4</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    digitsLen = <span class="built_in">int</span>.from_bytes(get_bytes(addr + <span class="number">4</span>, <span class="number">4</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    data = get_bytes(digitsAddr, digitsLen * <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(data, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bignum3at</span>(<span class="params">addr</span>):</span><br><span class="line">    digtsLen = <span class="built_in">int</span>.from_bytes(get_bytes(addr, <span class="number">4</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    digtsAddr = <span class="built_in">int</span>.from_bytes(get_bytes(addr + <span class="number">0xc</span>, <span class="number">4</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(digtsLen):</span><br><span class="line">        data.append(<span class="built_in">int</span>.from_bytes(get_bytes(digtsAddr + i * <span class="number">4</span>, <span class="number">4</span>), <span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> origin_data2bignum(data)</span><br></pre></td></tr></table></figure>

<p>接下来就是通过调试和拷打AI不断还原这个大数是通过什么运算得到的, 最终恢复了3个最重要的符号:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154507.png" alt="image-20250819215307588"></p>
<p>分别是大数相乘, 取模, 求模逆操作, 用伪代码来表示这个阶段的加密逻辑就是:</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">m2 = big<span class="built_in">_</span>num<span class="built_in">_</span>type2(key)</span><br><span class="line">m1 = m2 ** 3</span><br><span class="line">m1 **= 4</span><br><span class="line">m1 <span class="comment">%= c</span></span><br><span class="line">m1 **= 3</span><br><span class="line">n = (m1 * m2) <span class="comment">% c</span></span><br><span class="line">final = inverse(n, c)</span><br></pre></td></tr></table></figure>

<p>其中<code>key</code>是上阶段加密的结果, 并且所有相乘都化简对应的乘方, <code>c</code>是一个函数开头初始化的常数<code>0x56f67550f16a00390dcf0b2715708e61c5b3f23101862fc1</code>, 接下来就是拷打AI怎么解出上一阶段的<code>key</code>(不然呢, 我又不是密码手).</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154512.png" alt="image-20250819215819269"></p>
<p>这里放出怎么得到的<code>37次方</code>是方便后面还要解类似问题时能快速上手使用解密函数, 根据<code>c</code>可以分解为两个质因数, AI给出了以下通用解法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> mod_inverse</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">result, c, p, q, k</span>):</span><br><span class="line">    d_p = mod_inverse(k, p-<span class="number">1</span>)</span><br><span class="line">    d_q = mod_inverse(k, q-<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    x_p = <span class="built_in">pow</span>(result, d_p, p)</span><br><span class="line">    x_q = <span class="built_in">pow</span>(result, d_q, q)</span><br><span class="line">    </span><br><span class="line">    n = c</span><br><span class="line">    n1, n2 = q, p</span><br><span class="line">    m1, m2 = mod_inverse(n1, p), mod_inverse(n2, q)</span><br><span class="line">    </span><br><span class="line">    code = (x_p * n1 * m1 + x_q * n2 * m2) % n</span><br><span class="line">    <span class="keyword">return</span> code</span><br></pre></td></tr></table></figure>

<p>参数的含义分别是: 最后取模的结果, 模数, 模数的第一个质因数, 第二个质因数, k次方</p>
<p>上<a target="_blank" rel="noopener" href="http://www.factordb.com/">facordb</a>分解一下<code>c</code>就能得到两个常数, 对于上面37次方的解法就是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">0x56f67550f16a00390dcf0b2715708e61c5b3f23101862fc1</span></span><br><span class="line">p1 = <span class="number">45424490472579293708671645907</span></span><br><span class="line">p2 = <span class="number">46942075831425428541187578011</span></span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">keys = solve(enc, c, p1, p2, <span class="number">37</span>)</span><br></pre></td></tr></table></figure>

<p>求模逆是一个可逆操作, 再对<code>c</code>做一次就能求回来, 然后<code>solve</code>函数求解得到上一阶段的结果<code>key</code>.</p>
<p>这里验证结果的方法是找到一开始通过字节串转化为大数的地方将字节串替换为求出的大数的小端序字节串, 然后让程序运行到最后校验处看看是否匹配密文.</p>
<p>现在基本上可以确定序列号就是作为大数不断进行运算得到最终结果, 实际上并没有针对序列号字节串的加密, 但是在最后一个阶段恢复的符号前面并没有任何一处调用, 猜测题目可能使用了多种数论库进行大数运算.</p>
<p>而中间常见的自增1再反转的操作可以通过调试来分析实际对一个大数的影响, 这里以倒数第二阶段到上面那个阶段为例探索这个操作的实际效果, 倒数第二阶段用到的是<code>bignum1at</code>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154353.png" alt="image-20250819221608550"></p>
<p>可以看到实际上就是最高一个_DWORD自增, 那么下面就不探索大数和字节串之间的转化了, 只会越绕越晕, 只把它当成一个数处理就行.</p>
<p>倒数第二阶段也能恢复出乘, 取模, 模逆的符号:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F18%2F20250918-102736.png" alt="image-20250819221911827"></p>
<p>运算对应的伪代码:</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">key = code</span><br><span class="line">tmp = key</span><br><span class="line">key **= 10</span><br><span class="line">key <span class="comment">%= c</span></span><br><span class="line">key **= 3</span><br><span class="line">key *= tmp</span><br><span class="line">key <span class="comment">%= c</span></span><br><span class="line">key = inverse(key, c)</span><br></pre></td></tr></table></figure>

<p>也能转化为和最后一个阶段一样的问题, 能用一样的解法, 这里对应的是10 * 3 + 1 &#x3D; 31次</p>
<p>接下来继续向上分析也是一样的方法, 分析到倒数第三阶段还是一样的加密方式, 这时候已经开始不需要每次都验证每个函数的作用了, 因为上面说了程序用到了多种数论库(也可能是一个库的同样效果不同实现的函数?), 每一阶段都有自己的乘, 取模, 模逆, 这里直接通过这个加密模式来猜测每一个函数对应的运算即可, 其中有几个函数IDA识别参数有问题手动调一下参数个数能分别结果放在哪个参数即可, 最终一共是有9个阶段, 全部是同类型加密, 解密代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse</span><br><span class="line"></span><br><span class="line">c = <span class="number">0x56f67550f16a00390dcf0b2715708e61c5b3f23101862fc1</span></span><br><span class="line">p1 = <span class="number">45424490472579293708671645907</span></span><br><span class="line">p2 = <span class="number">46942075831425428541187578011</span></span><br><span class="line">enc = [<span class="number">0x4B</span>, <span class="number">0x43</span>, <span class="number">0x54</span>, <span class="number">0x46</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x35</span>, <span class="number">0x7A</span>, <span class="number">0x1A</span>, <span class="number">0xB1</span>, <span class="number">0xC6</span>, <span class="number">0xA2</span>, <span class="number">0x99</span>, <span class="number">0x9F</span>, <span class="number">0x97</span>, <span class="number">0x97</span>, <span class="number">0xF5</span>, <span class="number">0xAB</span>, <span class="number">0xD5</span>, <span class="number">0xB4</span>, <span class="number">0x9F</span>, <span class="number">0xD9</span>, <span class="number">0xA0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b2hex</span>(<span class="params">b</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span>.join([<span class="string">f&quot;<span class="subst">&#123;x:02x&#125;</span>&quot;</span> <span class="keyword">for</span> x <span class="keyword">in</span> b]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">n2hex</span>(<span class="params">n</span>):</span><br><span class="line">    n = n.to_bytes(<span class="number">24</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    b2hex(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> mod_inverse</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">result, c, p, q, k</span>):</span><br><span class="line">    d_p = mod_inverse(k, p-<span class="number">1</span>)</span><br><span class="line">    d_q = mod_inverse(k, q-<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    x_p = <span class="built_in">pow</span>(result, d_p, p)</span><br><span class="line">    x_q = <span class="built_in">pow</span>(result, d_q, q)</span><br><span class="line">    </span><br><span class="line">    n = c</span><br><span class="line">    n1, n2 = q, p</span><br><span class="line">    m1, m2 = mod_inverse(n1, p), mod_inverse(n2, q)</span><br><span class="line">    </span><br><span class="line">    code = (x_p * n1 * m1 + x_q * n2 * m2) % n</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = enc[::-<span class="number">1</span>]</span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">keys = solve(enc, c, p1, p2, <span class="number">37</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(keys))</span><br><span class="line">enc = <span class="built_in">bytearray</span>(keys.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">code = solve(enc, c, p1, p2, <span class="number">31</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(code))</span><br><span class="line">enc = <span class="built_in">bytearray</span>(code.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">ser = solve(enc, c, p1, p2, <span class="number">29</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(ser))</span><br><span class="line">enc = <span class="built_in">bytearray</span>(ser.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">enc = solve(enc, c, p1, p2, <span class="number">23</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(enc))</span><br><span class="line">n2hex(enc)</span><br><span class="line">enc = <span class="built_in">bytearray</span>(enc.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">enc = solve(enc, c, p1, p2, <span class="number">19</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(enc))</span><br><span class="line">enc = <span class="built_in">bytearray</span>(enc.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">enc = solve(enc, c, p1, p2, <span class="number">17</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(enc))</span><br><span class="line">enc = <span class="built_in">bytearray</span>(enc.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">enc = solve(enc, c, p1, p2, <span class="number">11</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(enc))</span><br><span class="line">enc = <span class="built_in">bytearray</span>(enc.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">enc = solve(enc, c, p1, p2, <span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(enc))</span><br><span class="line">enc = <span class="built_in">bytearray</span>(enc.to_bytes(<span class="number">24</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">enc[<span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">enc = <span class="built_in">int</span>.from_bytes(enc, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enc = inverse(enc, c)</span><br><span class="line">enc = solve(enc, c, p1, p2, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;found: &quot;</span>, <span class="built_in">hex</span>(enc)[<span class="number">2</span>:].upper())</span><br></pre></td></tr></table></figure>

<h2 id="第四题"><a href="#第四题" class="headerlink" title="第四题"></a>第四题</h2><p>注意到函数列表里IDA识别出来的TLS回调, 其中初始化了一些资源, 这些都不重要, 重点看看其中的反调试.</p>
<p><code>0000000140003774</code>调用了<code>0000000140007303</code>来执行系统调用, 此处系统调用号为0x19, 接触过VMP的反调试就知道这是<code>ZwQueryInformationProcess</code>的系统调用, 第一个参数为自身进程句柄, 二个参数7说明查询的是调试器信息:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154611.png" alt="image-20250822085521631"></p>
<p>将检测到调试器调用先前分配的可执行页的分支patch掉:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154613.png" alt="image-20250822085706338"></p>
<p><code>main+373</code>是一样的反调试, <code>main+1ae</code>处有同样的反调试手法, 调用的是SetInformation, 将调试器从进程剥离.</p>
<p>另外<code>main+1c9</code>注册了一个异常处理函数(<code>0000000140006D40</code>), 一上来就清除了进程的调试寄存器, 虽然不一定会用到硬件断点但还是patch掉:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154615.png" alt="image-20250822090352613"></p>
<p>若触发软件断点就会根据一个全局变量进行不同的操作:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154616.png" alt="image-20250822090625101"></p>
<p>之前的反调试就是将<code>ctol</code>设置为4然后执行<code>int 3</code>来让程序退出的, 由于不用写注册机, 所以这里不分析用户名的处理, 直接跳到处理序列号的地方, 对应<code>ctol</code>为3:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154622.png" alt="image-20250822090923888"></p>
<p>核心处理逻辑在<code>decryptstring(0000000140005D6C)</code>, 这是先前用来解密一些字符串使用的函数, 也就是说需要编写的是相应的加密函数, 从公开序列号可以看出最后一步的加密应该是base64编码(对应题目中的<code>0000000140001684</code>), 但是使用题目中发现的表会发现编码不回原来的字符串, 调试会发现题目中的解码过程将每3个字符合成时竟然是大端序的, 那只能自己手搓一个对应的base64编码函数了:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">table = <span class="string">&#x27;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789+/&#x27;</span></span><br><span class="line"></span><br><span class="line">idx = <span class="number">0</span></span><br><span class="line">res = []</span><br><span class="line">eof = <span class="literal">False</span></span><br><span class="line">padding = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> idx &gt;= <span class="number">0x40</span> - <span class="number">3</span>:</span><br><span class="line">        p = enc[idx :]</span><br><span class="line">        padding = <span class="number">3</span> - <span class="built_in">len</span>(p)</span><br><span class="line">        eof = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = enc[idx : idx + <span class="number">3</span>]</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(p):</span><br><span class="line">        n |= b &lt;&lt; <span class="number">8</span>  * i</span><br><span class="line">    c = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span> - padding):</span><br><span class="line">        c += [table[n &amp; <span class="number">0x3f</span>]]</span><br><span class="line">        n &gt;&gt;= <span class="number">6</span></span><br><span class="line">    c += [<span class="string">&#x27;=&#x27;</span>] * (<span class="number">4</span> - <span class="built_in">len</span>(c))</span><br><span class="line">    res += c</span><br><span class="line">    <span class="keyword">if</span> eof:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    idx += <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>然后程序进行了一个类似AES的操作(<code>000000014000593C</code>):</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">aes</span><span class="params">(__int64 a1, _QWORD *key)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> *v5; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">size_t</span> Size; <span class="comment">// rbx</span></span><br><span class="line">  BYTE **to_encrypt; <span class="comment">// rdi</span></span><br><span class="line">  _DWORD *key_1; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// ebp</span></span><br><span class="line">  _QWORD *v10; <span class="comment">// r14</span></span><br><span class="line">  __int64 v11; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> i_1; <span class="comment">// ebp</span></span><br><span class="line">  __int64 v13; <span class="comment">// r12</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// r15d</span></span><br><span class="line">  __int64 v15; <span class="comment">// r13</span></span><br><span class="line">  _BYTE *v16; <span class="comment">// rbx</span></span><br><span class="line">  _QWORD *v17; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">void</span> *v19[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-58h] BYREF</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+30h] [rbp-48h]</span></span><br><span class="line">  _QWORD *v21; <span class="comment">// [rsp+38h] [rbp-40h]</span></span><br><span class="line">  __int64 v22; <span class="comment">// [rsp+40h] [rbp-38h]</span></span><br><span class="line"></span><br><span class="line">  v22 = a1;</span><br><span class="line">  *(_OWORD *)v19 = <span class="number">0</span>;</span><br><span class="line">  v20 = <span class="number">0</span>;</span><br><span class="line">  v4 = *(_QWORD *)(a1 + <span class="number">8</span>) - *(_QWORD *)a1;</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_140002824(v19, v4);</span><br><span class="line">    v5 = (<span class="type">char</span> *)v19[<span class="number">0</span>];</span><br><span class="line">    Size = *(_QWORD *)(a1 + <span class="number">8</span>) - *(_QWORD *)a1;</span><br><span class="line">    memmove(v19[<span class="number">0</span>], *(<span class="type">const</span> <span class="type">void</span> **)a1, Size);</span><br><span class="line">    v19[<span class="number">1</span>] = &amp;v5[Size];</span><br><span class="line">  &#125;</span><br><span class="line">  to_encrypt = (BYTE **)sub_140004A60(v19);</span><br><span class="line">  AddRoundKey(to_encrypt, (_DWORD *)(*key + <span class="number">160LL</span>));</span><br><span class="line">  key_1 = (_DWORD *)(*key + <span class="number">144LL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">9</span>; i &gt; <span class="number">0</span>; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    SBOXswap(to_encrypt);</span><br><span class="line">    ShiftRows(to_encrypt);</span><br><span class="line">    AddRoundKey(to_encrypt, key_1);</span><br><span class="line">    key_1 -= <span class="number">4</span>;</span><br><span class="line">    col_mix(to_encrypt);</span><br><span class="line">  &#125;</span><br><span class="line">  SBOXswap(to_encrypt);</span><br><span class="line">  ShiftRows(to_encrypt);</span><br><span class="line">  AddRoundKey(to_encrypt, key_1);</span><br><span class="line">  v10 = operator new(<span class="number">0x18</span>u);</span><br><span class="line">  v21 = v10;</span><br><span class="line">  *(_OWORD *)v10 = <span class="number">0</span>;</span><br><span class="line">  v10[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  *v10 = <span class="number">0</span>;</span><br><span class="line">  v10[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v10[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  sub_140002824(v10, <span class="number">0x10</span>u);</span><br><span class="line">  v11 = *v10;</span><br><span class="line">  <span class="built_in">memset</span>((<span class="type">void</span> *)*v10, <span class="number">0</span>, <span class="number">0x10</span>u);</span><br><span class="line">  v10[<span class="number">1</span>] = v11 + <span class="number">16</span>;</span><br><span class="line">  i_1 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    v15 = v13;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v16 = (_BYTE *)*v10;</span><br><span class="line">      v16[v15] = *(_BYTE *)byteat_matrix((__int64)to_encrypt, i_1, j++);</span><br><span class="line">      v15 += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( j &lt; <span class="number">4</span> );</span><br><span class="line">    ++i_1;</span><br><span class="line">    ++v13;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( i_1 &lt; <span class="number">4</span> );</span><br><span class="line">  <span class="keyword">if</span> ( to_encrypt )</span><br><span class="line">  &#123;</span><br><span class="line">    j_j_free(*to_encrypt);</span><br><span class="line">    j_j_free(to_encrypt);</span><br><span class="line">  &#125;</span><br><span class="line">  v17 = *(_QWORD **)a1;</span><br><span class="line">  <span class="keyword">if</span> ( *(_QWORD *)a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(_QWORD *)(a1 + <span class="number">16</span>) - (_QWORD)v17 &gt;= <span class="number">0x1000</span>u )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)v17 - *(v17 - <span class="number">1</span>) - <span class="number">8</span> &gt; <span class="number">0x1F</span> )</span><br><span class="line">        invalid_parameter_noinfo_noreturn();</span><br><span class="line">      v17 = (_QWORD *)*(v17 - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    j_j_free(v17);</span><br><span class="line">    *(_QWORD *)a1 = <span class="number">0</span>;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">8</span>) = <span class="number">0</span>;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">16</span>) = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从使用的SBOX可以看出是标准逆SBOX, 但是其中的列混合步骤用的貌似是白盒:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154626.png" alt="image-20250822160212647"></p>
<p>tbl是一个整整5 * 0x100字节的盒, 拷打AI写出爆破脚本后来到最后一步解密, 是一个简单的异或, 调试拿到异或的字节流即可, 完整脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"></span><br><span class="line">enc = <span class="built_in">bytearray</span>(<span class="string">b&#x27;l/SxsR0BCjRZTmc7XWscrMv38iYuoiUECvi9Tuvi+ZiJZmdR5EcvVnTZOZvrnOrw&#x27;</span>)</span><br><span class="line"></span><br><span class="line">inv_sbox = [<span class="number">0x52</span>, <span class="number">0x9</span>, <span class="number">0x6A</span>, <span class="number">0xD5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xA5</span>, <span class="number">0x38</span>, <span class="number">0xBF</span>, <span class="number">0x40</span>, <span class="number">0xA3</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0xD7</span>, <span class="number">0xFB</span>, <span class="number">0x7C</span>, <span class="number">0xE3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8E</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xC4</span>, <span class="number">0xDE</span>, <span class="number">0xE9</span>, <span class="number">0xCB</span>, <span class="number">0x54</span>, <span class="number">0x7B</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0xEE</span>, <span class="number">0x4C</span>, <span class="number">0x95</span>, <span class="number">0xB</span>, <span class="number">0x42</span>, <span class="number">0xFA</span>, <span class="number">0xC3</span>, <span class="number">0x4E</span>, <span class="number">0x8</span>, <span class="number">0x2E</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xD9</span>, <span class="number">0x24</span>, <span class="number">0xB2</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0xA2</span>, <span class="number">0x49</span>, <span class="number">0x6D</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0x25</span>, <span class="number">0x72</span>, <span class="number">0xF8</span>, <span class="number">0xF6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xD4</span>, <span class="number">0xA4</span>, <span class="number">0x5C</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, <span class="number">0x65</span>, <span class="number">0xB6</span>, <span class="number">0x92</span>, <span class="number">0x6C</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xFD</span>, <span class="number">0xED</span>, <span class="number">0xB9</span>, <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x9D</span>, <span class="number">0x84</span>, <span class="number">0x90</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x0</span>, <span class="number">0x8C</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0xA</span>, <span class="number">0xF7</span>, <span class="number">0xE4</span>, <span class="number">0x58</span>, <span class="number">0x5</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x45</span>, <span class="number">0x6</span>, <span class="number">0xD0</span>, <span class="number">0x2C</span>, <span class="number">0x1E</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x3F</span>, <span class="number">0xF</span>, <span class="number">0x2</span>, <span class="number">0xC1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x13</span>, <span class="number">0x8A</span>, <span class="number">0x6B</span>, <span class="number">0x3A</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x67</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, <span class="number">0x97</span>, <span class="number">0xF2</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xB4</span>, <span class="number">0xE6</span>, <span class="number">0x73</span>, <span class="number">0x96</span>, <span class="number">0xAC</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xE7</span>, <span class="number">0xAD</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x37</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x75</span>, <span class="number">0xDF</span>, <span class="number">0x6E</span>, <span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0x1A</span>, <span class="number">0x71</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0xC5</span>, <span class="number">0x89</span>, <span class="number">0x6F</span>, <span class="number">0xB7</span>, <span class="number">0x62</span>, <span class="number">0xE</span>, <span class="number">0xAA</span>, <span class="number">0x18</span>, <span class="number">0xBE</span>, <span class="number">0x1B</span>, <span class="number">0xFC</span>, <span class="number">0x56</span>, <span class="number">0x3E</span>, <span class="number">0x4B</span>, <span class="number">0xC6</span>, <span class="number">0xD2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9A</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xFE</span>, <span class="number">0x78</span>, <span class="number">0xCD</span>, <span class="number">0x5A</span>, <span class="number">0xF4</span>, <span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0xA8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x7</span>, <span class="number">0xC7</span>, <span class="number">0x31</span>, <span class="number">0xB1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7F</span>, <span class="number">0xA9</span>, <span class="number">0x19</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0xD</span>, <span class="number">0x2D</span>, <span class="number">0xE5</span>, <span class="number">0x7A</span>, <span class="number">0x9F</span>, <span class="number">0x93</span>, <span class="number">0xC9</span>, <span class="number">0x9C</span>, <span class="number">0xEF</span>, <span class="number">0xA0</span>, <span class="number">0xE0</span>, <span class="number">0x3B</span>, <span class="number">0x4D</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xF5</span>, <span class="number">0xB0</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xBB</span>, <span class="number">0x3C</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>, <span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x4</span>, <span class="number">0x7E</span>, <span class="number">0xBA</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0x26</span>, <span class="number">0xE1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0xC</span>, <span class="number">0x7D</span>]</span><br><span class="line"></span><br><span class="line">tbl = [<span class="number">0x0</span>, <span class="number">0xD</span>, <span class="number">0x1A</span>, <span class="number">0x17</span>, <span class="number">0x34</span>, <span class="number">0x39</span>, <span class="number">0x2E</span>, <span class="number">0x23</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x7F</span>, <span class="number">0x5C</span>, <span class="number">0x51</span>, <span class="number">0x46</span>, <span class="number">0x4B</span>, <span class="number">0xD0</span>, <span class="number">0xDD</span>, <span class="number">0xCA</span>, <span class="number">0xC7</span>, <span class="number">0xE4</span>, <span class="number">0xE9</span>, <span class="number">0xFE</span>, <span class="number">0xF3</span>, <span class="number">0xB8</span>, <span class="number">0xB5</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x8C</span>, <span class="number">0x81</span>, <span class="number">0x96</span>, <span class="number">0x9B</span>, <span class="number">0xBB</span>, <span class="number">0xB6</span>, <span class="number">0xA1</span>, <span class="number">0xAC</span>, <span class="number">0x8F</span>, <span class="number">0x82</span>, <span class="number">0x95</span>, <span class="number">0x98</span>, <span class="number">0xD3</span>, <span class="number">0xDE</span>, <span class="number">0xC9</span>, <span class="number">0xC4</span>, <span class="number">0xE7</span>, <span class="number">0xEA</span>, <span class="number">0xFD</span>, <span class="number">0xF0</span>, <span class="number">0x6B</span>, <span class="number">0x66</span>, <span class="number">0x71</span>, <span class="number">0x7C</span>, <span class="number">0x5F</span>, <span class="number">0x52</span>, <span class="number">0x45</span>, <span class="number">0x48</span>, <span class="number">0x3</span>, <span class="number">0xE</span>, <span class="number">0x19</span>, <span class="number">0x14</span>, <span class="number">0x37</span>, <span class="number">0x3A</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x6D</span>, <span class="number">0x60</span>, <span class="number">0x77</span>, <span class="number">0x7A</span>, <span class="number">0x59</span>, <span class="number">0x54</span>, <span class="number">0x43</span>, <span class="number">0x4E</span>, <span class="number">0x5</span>, <span class="number">0x8</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0x31</span>, <span class="number">0x3C</span>, <span class="number">0x2B</span>, <span class="number">0x26</span>, <span class="number">0xBD</span>, <span class="number">0xB0</span>, <span class="number">0xA7</span>, <span class="number">0xAA</span>, <span class="number">0x89</span>, <span class="number">0x84</span>, <span class="number">0x93</span>, <span class="number">0x9E</span>, <span class="number">0xD5</span>, <span class="number">0xD8</span>, <span class="number">0xCF</span>, <span class="number">0xC2</span>, <span class="number">0xE1</span>, <span class="number">0xEC</span>, <span class="number">0xFB</span>, <span class="number">0xF6</span>, <span class="number">0xD6</span>, <span class="number">0xDB</span>, <span class="number">0xCC</span>, <span class="number">0xC1</span>, <span class="number">0xE2</span>, <span class="number">0xEF</span>, <span class="number">0xF8</span>, <span class="number">0xF5</span>, <span class="number">0xBE</span>, <span class="number">0xB3</span>, <span class="number">0xA4</span>, <span class="number">0xA9</span>, <span class="number">0x8A</span>, <span class="number">0x87</span>, <span class="number">0x90</span>, <span class="number">0x9D</span>, <span class="number">0x6</span>, <span class="number">0xB</span>, <span class="number">0x1C</span>, <span class="number">0x11</span>, <span class="number">0x32</span>, <span class="number">0x3F</span>, <span class="number">0x28</span>, <span class="number">0x25</span>, <span class="number">0x6E</span>, <span class="number">0x63</span>, <span class="number">0x74</span>, <span class="number">0x79</span>, <span class="number">0x5A</span>, <span class="number">0x57</span>, <span class="number">0x40</span>, <span class="number">0x4D</span>, <span class="number">0xDA</span>, <span class="number">0xD7</span>, <span class="number">0xC0</span>, <span class="number">0xCD</span>, <span class="number">0xEE</span>, <span class="number">0xE3</span>, <span class="number">0xF4</span>, <span class="number">0xF9</span>, <span class="number">0xB2</span>, <span class="number">0xBF</span>, <span class="number">0xA8</span>, <span class="number">0xA5</span>, <span class="number">0x86</span>, <span class="number">0x8B</span>, <span class="number">0x9C</span>, <span class="number">0x91</span>, <span class="number">0xA</span>, <span class="number">0x7</span>, <span class="number">0x10</span>, <span class="number">0x1D</span>, <span class="number">0x3E</span>, <span class="number">0x33</span>, <span class="number">0x24</span>, <span class="number">0x29</span>, <span class="number">0x62</span>, <span class="number">0x6F</span>, <span class="number">0x78</span>, <span class="number">0x75</span>, <span class="number">0x56</span>, <span class="number">0x5B</span>, <span class="number">0x4C</span>, <span class="number">0x41</span>, <span class="number">0x61</span>, <span class="number">0x6C</span>, <span class="number">0x7B</span>, <span class="number">0x76</span>, <span class="number">0x55</span>, <span class="number">0x58</span>, <span class="number">0x4F</span>, <span class="number">0x42</span>, <span class="number">0x9</span>, <span class="number">0x4</span>, <span class="number">0x13</span>, <span class="number">0x1E</span>, <span class="number">0x3D</span>, <span class="number">0x30</span>, <span class="number">0x27</span>, <span class="number">0x2A</span>, <span class="number">0xB1</span>, <span class="number">0xBC</span>, <span class="number">0xAB</span>, <span class="number">0xA6</span>, <span class="number">0x85</span>, <span class="number">0x88</span>, <span class="number">0x9F</span>, <span class="number">0x92</span>, <span class="number">0xD9</span>, <span class="number">0xD4</span>, <span class="number">0xC3</span>, <span class="number">0xCE</span>, <span class="number">0xED</span>, <span class="number">0xE0</span>, <span class="number">0xF7</span>, <span class="number">0xFA</span>, <span class="number">0xB7</span>, <span class="number">0xBA</span>, <span class="number">0xAD</span>, <span class="number">0xA0</span>, <span class="number">0x83</span>, <span class="number">0x8E</span>, <span class="number">0x99</span>, <span class="number">0x94</span>, <span class="number">0xDF</span>, <span class="number">0xD2</span>, <span class="number">0xC5</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xE6</span>, <span class="number">0xF1</span>, <span class="number">0xFC</span>, <span class="number">0x67</span>, <span class="number">0x6A</span>, <span class="number">0x7D</span>, <span class="number">0x70</span>, <span class="number">0x53</span>, <span class="number">0x5E</span>, <span class="number">0x49</span>, <span class="number">0x44</span>, <span class="number">0xF</span>, <span class="number">0x2</span>, <span class="number">0x15</span>, <span class="number">0x18</span>, <span class="number">0x3B</span>, <span class="number">0x36</span>, <span class="number">0x21</span>, <span class="number">0x2C</span>, <span class="number">0xC</span>, <span class="number">0x1</span>, <span class="number">0x16</span>, <span class="number">0x1B</span>, <span class="number">0x38</span>, <span class="number">0x35</span>, <span class="number">0x22</span>, <span class="number">0x2F</span>, <span class="number">0x64</span>, <span class="number">0x69</span>, <span class="number">0x7E</span>, <span class="number">0x73</span>, <span class="number">0x50</span>, <span class="number">0x5D</span>, <span class="number">0x4A</span>, <span class="number">0x47</span>, <span class="number">0xDC</span>, <span class="number">0xD1</span>, <span class="number">0xC6</span>, <span class="number">0xCB</span>, <span class="number">0xE8</span>, <span class="number">0xE5</span>, <span class="number">0xF2</span>, <span class="number">0xFF</span>, <span class="number">0xB4</span>, <span class="number">0xB9</span>, <span class="number">0xAE</span>, <span class="number">0xA3</span>, <span class="number">0x80</span>, <span class="number">0x8D</span>, <span class="number">0x9A</span>, <span class="number">0x97</span>, <span class="number">0x0</span>, <span class="number">0xE</span>, <span class="number">0x1C</span>, <span class="number">0x12</span>, <span class="number">0x38</span>, <span class="number">0x36</span>, <span class="number">0x24</span>, <span class="number">0x2A</span>, <span class="number">0x70</span>, <span class="number">0x7E</span>, <span class="number">0x6C</span>, <span class="number">0x62</span>, <span class="number">0x48</span>, <span class="number">0x46</span>, <span class="number">0x54</span>, <span class="number">0x5A</span>, <span class="number">0xE0</span>, <span class="number">0xEE</span>, <span class="number">0xFC</span>, <span class="number">0xF2</span>, <span class="number">0xD8</span>, <span class="number">0xD6</span>, <span class="number">0xC4</span>, <span class="number">0xCA</span>, <span class="number">0x90</span>, <span class="number">0x9E</span>, <span class="number">0x8C</span>, <span class="number">0x82</span>, <span class="number">0xA8</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xBA</span>, <span class="number">0xDB</span>, <span class="number">0xD5</span>, <span class="number">0xC7</span>, <span class="number">0xC9</span>, <span class="number">0xE3</span>, <span class="number">0xED</span>, <span class="number">0xFF</span>, <span class="number">0xF1</span>, <span class="number">0xAB</span>, <span class="number">0xA5</span>, <span class="number">0xB7</span>, <span class="number">0xB9</span>, <span class="number">0x93</span>, <span class="number">0x9D</span>, <span class="number">0x8F</span>, <span class="number">0x81</span>, <span class="number">0x3B</span>, <span class="number">0x35</span>, <span class="number">0x27</span>, <span class="number">0x29</span>, <span class="number">0x3</span>, <span class="number">0xD</span>, <span class="number">0x1F</span>, <span class="number">0x11</span>, <span class="number">0x4B</span>, <span class="number">0x45</span>, <span class="number">0x57</span>, <span class="number">0x59</span>, <span class="number">0x73</span>, <span class="number">0x7D</span>, <span class="number">0x6F</span>, <span class="number">0x61</span>, <span class="number">0xAD</span>, <span class="number">0xA3</span>, <span class="number">0xB1</span>, <span class="number">0xBF</span>, <span class="number">0x95</span>, <span class="number">0x9B</span>, <span class="number">0x89</span>, <span class="number">0x87</span>, <span class="number">0xDD</span>, <span class="number">0xD3</span>, <span class="number">0xC1</span>, <span class="number">0xCF</span>, <span class="number">0xE5</span>, <span class="number">0xEB</span>, <span class="number">0xF9</span>, <span class="number">0xF7</span>, <span class="number">0x4D</span>, <span class="number">0x43</span>, <span class="number">0x51</span>, <span class="number">0x5F</span>, <span class="number">0x75</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x67</span>, <span class="number">0x3D</span>, <span class="number">0x33</span>, <span class="number">0x21</span>, <span class="number">0x2F</span>, <span class="number">0x5</span>, <span class="number">0xB</span>, <span class="number">0x19</span>, <span class="number">0x17</span>, <span class="number">0x76</span>, <span class="number">0x78</span>, <span class="number">0x6A</span>, <span class="number">0x64</span>, <span class="number">0x4E</span>, <span class="number">0x40</span>, <span class="number">0x52</span>, <span class="number">0x5C</span>, <span class="number">0x6</span>, <span class="number">0x8</span>, <span class="number">0x1A</span>, <span class="number">0x14</span>, <span class="number">0x3E</span>, <span class="number">0x30</span>, <span class="number">0x22</span>, <span class="number">0x2C</span>, <span class="number">0x96</span>, <span class="number">0x98</span>, <span class="number">0x8A</span>, <span class="number">0x84</span>, <span class="number">0xAE</span>, <span class="number">0xA0</span>, <span class="number">0xB2</span>, <span class="number">0xBC</span>, <span class="number">0xE6</span>, <span class="number">0xE8</span>, <span class="number">0xFA</span>, <span class="number">0xF4</span>, <span class="number">0xDE</span>, <span class="number">0xD0</span>, <span class="number">0xC2</span>, <span class="number">0xCC</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x5D</span>, <span class="number">0x53</span>, <span class="number">0x79</span>, <span class="number">0x77</span>, <span class="number">0x65</span>, <span class="number">0x6B</span>, <span class="number">0x31</span>, <span class="number">0x3F</span>, <span class="number">0x2D</span>, <span class="number">0x23</span>, <span class="number">0x9</span>, <span class="number">0x7</span>, <span class="number">0x15</span>, <span class="number">0x1B</span>, <span class="number">0xA1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0xB3</span>, <span class="number">0x99</span>, <span class="number">0x97</span>, <span class="number">0x85</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0xDF</span>, <span class="number">0xCD</span>, <span class="number">0xC3</span>, <span class="number">0xE9</span>, <span class="number">0xE7</span>, <span class="number">0xF5</span>, <span class="number">0xFB</span>, <span class="number">0x9A</span>, <span class="number">0x94</span>, <span class="number">0x86</span>, <span class="number">0x88</span>, <span class="number">0xA2</span>, <span class="number">0xAC</span>, <span class="number">0xBE</span>, <span class="number">0xB0</span>, <span class="number">0xEA</span>, <span class="number">0xE4</span>, <span class="number">0xF6</span>, <span class="number">0xF8</span>, <span class="number">0xD2</span>, <span class="number">0xDC</span>, <span class="number">0xCE</span>, <span class="number">0xC0</span>, <span class="number">0x7A</span>, <span class="number">0x74</span>, <span class="number">0x66</span>, <span class="number">0x68</span>, <span class="number">0x42</span>, <span class="number">0x4C</span>, <span class="number">0x5E</span>, <span class="number">0x50</span>, <span class="number">0xA</span>, <span class="number">0x4</span>, <span class="number">0x16</span>, <span class="number">0x18</span>, <span class="number">0x32</span>, <span class="number">0x3C</span>, <span class="number">0x2E</span>, <span class="number">0x20</span>, <span class="number">0xEC</span>, <span class="number">0xE2</span>, <span class="number">0xF0</span>, <span class="number">0xFE</span>, <span class="number">0xD4</span>, <span class="number">0xDA</span>, <span class="number">0xC8</span>, <span class="number">0xC6</span>, <span class="number">0x9C</span>, <span class="number">0x92</span>, <span class="number">0x80</span>, <span class="number">0x8E</span>, <span class="number">0xA4</span>, <span class="number">0xAA</span>, <span class="number">0xB8</span>, <span class="number">0xB6</span>, <span class="number">0xC</span>, <span class="number">0x2</span>, <span class="number">0x10</span>, <span class="number">0x1E</span>, <span class="number">0x34</span>, <span class="number">0x3A</span>, <span class="number">0x28</span>, <span class="number">0x26</span>, <span class="number">0x7C</span>, <span class="number">0x72</span>, <span class="number">0x60</span>, <span class="number">0x6E</span>, <span class="number">0x44</span>, <span class="number">0x4A</span>, <span class="number">0x58</span>, <span class="number">0x56</span>, <span class="number">0x37</span>, <span class="number">0x39</span>, <span class="number">0x2B</span>, <span class="number">0x25</span>, <span class="number">0xF</span>, <span class="number">0x1</span>, <span class="number">0x13</span>, <span class="number">0x1D</span>, <span class="number">0x47</span>, <span class="number">0x49</span>, <span class="number">0x5B</span>, <span class="number">0x55</span>, <span class="number">0x7F</span>, <span class="number">0x71</span>, <span class="number">0x63</span>, <span class="number">0x6D</span>, <span class="number">0xD7</span>, <span class="number">0xD9</span>, <span class="number">0xCB</span>, <span class="number">0xC5</span>, <span class="number">0xEF</span>, <span class="number">0xE1</span>, <span class="number">0xF3</span>, <span class="number">0xFD</span>, <span class="number">0xA7</span>, <span class="number">0xA9</span>, <span class="number">0xBB</span>, <span class="number">0xB5</span>, <span class="number">0x9F</span>, <span class="number">0x91</span>, <span class="number">0x83</span>, <span class="number">0x8D</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0x6</span>, <span class="number">0x8</span>, <span class="number">0xA</span>, <span class="number">0xC</span>, <span class="number">0xE</span>, <span class="number">0x10</span>, <span class="number">0x12</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x18</span>, <span class="number">0x1A</span>, <span class="number">0x1C</span>, <span class="number">0x1E</span>, <span class="number">0x20</span>, <span class="number">0x22</span>, <span class="number">0x24</span>, <span class="number">0x26</span>, <span class="number">0x28</span>, <span class="number">0x2A</span>, <span class="number">0x2C</span>, <span class="number">0x2E</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x34</span>, <span class="number">0x36</span>, <span class="number">0x38</span>, <span class="number">0x3A</span>, <span class="number">0x3C</span>, <span class="number">0x3E</span>, <span class="number">0x40</span>, <span class="number">0x42</span>, <span class="number">0x44</span>, <span class="number">0x46</span>, <span class="number">0x48</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x4E</span>, <span class="number">0x50</span>, <span class="number">0x52</span>, <span class="number">0x54</span>, <span class="number">0x56</span>, <span class="number">0x58</span>, <span class="number">0x5A</span>, <span class="number">0x5C</span>, <span class="number">0x5E</span>, <span class="number">0x60</span>, <span class="number">0x62</span>, <span class="number">0x64</span>, <span class="number">0x66</span>, <span class="number">0x68</span>, <span class="number">0x6A</span>, <span class="number">0x6C</span>, <span class="number">0x6E</span>, <span class="number">0x70</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">0x76</span>, <span class="number">0x78</span>, <span class="number">0x7A</span>, <span class="number">0x7C</span>, <span class="number">0x7E</span>, <span class="number">0x80</span>, <span class="number">0x82</span>, <span class="number">0x84</span>, <span class="number">0x86</span>, <span class="number">0x88</span>, <span class="number">0x8A</span>, <span class="number">0x8C</span>, <span class="number">0x8E</span>, <span class="number">0x90</span>, <span class="number">0x92</span>, <span class="number">0x94</span>, <span class="number">0x96</span>, <span class="number">0x98</span>, <span class="number">0x9A</span>, <span class="number">0x9C</span>, <span class="number">0x9E</span>, <span class="number">0xA0</span>, <span class="number">0xA2</span>, <span class="number">0xA4</span>, <span class="number">0xA6</span>, <span class="number">0xA8</span>, <span class="number">0xAA</span>, <span class="number">0xAC</span>, <span class="number">0xAE</span>, <span class="number">0xB0</span>, <span class="number">0xB2</span>, <span class="number">0xB4</span>, <span class="number">0xB6</span>, <span class="number">0xB8</span>, <span class="number">0xBA</span>, <span class="number">0xBC</span>, <span class="number">0xBE</span>, <span class="number">0xC0</span>, <span class="number">0xC2</span>, <span class="number">0xC4</span>, <span class="number">0xC6</span>, <span class="number">0xC8</span>, <span class="number">0xCA</span>, <span class="number">0xCC</span>, <span class="number">0xCE</span>, <span class="number">0xD0</span>, <span class="number">0xD2</span>, <span class="number">0xD4</span>, <span class="number">0xD6</span>, <span class="number">0xD8</span>, <span class="number">0xDA</span>, <span class="number">0xDC</span>, <span class="number">0xDE</span>, <span class="number">0xE0</span>, <span class="number">0xE2</span>, <span class="number">0xE4</span>, <span class="number">0xE6</span>, <span class="number">0xE8</span>, <span class="number">0xEA</span>, <span class="number">0xEC</span>, <span class="number">0xEE</span>, <span class="number">0xF0</span>, <span class="number">0xF2</span>, <span class="number">0xF4</span>, <span class="number">0xF6</span>, <span class="number">0xF8</span>, <span class="number">0xFA</span>, <span class="number">0xFC</span>, <span class="number">0xFE</span>, <span class="number">0x1B</span>, <span class="number">0x19</span>, <span class="number">0x1F</span>, <span class="number">0x1D</span>, <span class="number">0x13</span>, <span class="number">0x11</span>, <span class="number">0x17</span>, <span class="number">0x15</span>, <span class="number">0xB</span>, <span class="number">0x9</span>, <span class="number">0xF</span>, <span class="number">0xD</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x7</span>, <span class="number">0x5</span>, <span class="number">0x3B</span>, <span class="number">0x39</span>, <span class="number">0x3F</span>, <span class="number">0x3D</span>, <span class="number">0x33</span>, <span class="number">0x31</span>, <span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x2B</span>, <span class="number">0x29</span>, <span class="number">0x2F</span>, <span class="number">0x2D</span>, <span class="number">0x23</span>, <span class="number">0x21</span>, <span class="number">0x27</span>, <span class="number">0x25</span>, <span class="number">0x5B</span>, <span class="number">0x59</span>, <span class="number">0x5F</span>, <span class="number">0x5D</span>, <span class="number">0x53</span>, <span class="number">0x51</span>, <span class="number">0x57</span>, <span class="number">0x55</span>, <span class="number">0x4B</span>, <span class="number">0x49</span>, <span class="number">0x4F</span>, <span class="number">0x4D</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x47</span>, <span class="number">0x45</span>, <span class="number">0x7B</span>, <span class="number">0x79</span>, <span class="number">0x7F</span>, <span class="number">0x7D</span>, <span class="number">0x73</span>, <span class="number">0x71</span>, <span class="number">0x77</span>, <span class="number">0x75</span>, <span class="number">0x6B</span>, <span class="number">0x69</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x65</span>, <span class="number">0x9B</span>, <span class="number">0x99</span>, <span class="number">0x9F</span>, <span class="number">0x9D</span>, <span class="number">0x93</span>, <span class="number">0x91</span>, <span class="number">0x97</span>, <span class="number">0x95</span>, <span class="number">0x8B</span>, <span class="number">0x89</span>, <span class="number">0x8F</span>, <span class="number">0x8D</span>, <span class="number">0x83</span>, <span class="number">0x81</span>, <span class="number">0x87</span>, <span class="number">0x85</span>, <span class="number">0xBB</span>, <span class="number">0xB9</span>, <span class="number">0xBF</span>, <span class="number">0xBD</span>, <span class="number">0xB3</span>, <span class="number">0xB1</span>, <span class="number">0xB7</span>, <span class="number">0xB5</span>, <span class="number">0xAB</span>, <span class="number">0xA9</span>, <span class="number">0xAF</span>, <span class="number">0xAD</span>, <span class="number">0xA3</span>, <span class="number">0xA1</span>, <span class="number">0xA7</span>, <span class="number">0xA5</span>, <span class="number">0xDB</span>, <span class="number">0xD9</span>, <span class="number">0xDF</span>, <span class="number">0xDD</span>, <span class="number">0xD3</span>, <span class="number">0xD1</span>, <span class="number">0xD7</span>, <span class="number">0xD5</span>, <span class="number">0xCB</span>, <span class="number">0xC9</span>, <span class="number">0xCF</span>, <span class="number">0xCD</span>, <span class="number">0xC3</span>, <span class="number">0xC1</span>, <span class="number">0xC7</span>, <span class="number">0xC5</span>, <span class="number">0xFB</span>, <span class="number">0xF9</span>, <span class="number">0xFF</span>, <span class="number">0xFD</span>, <span class="number">0xF3</span>, <span class="number">0xF1</span>, <span class="number">0xF7</span>, <span class="number">0xF5</span>, <span class="number">0xEB</span>, <span class="number">0xE9</span>, <span class="number">0xEF</span>, <span class="number">0xED</span>, <span class="number">0xE3</span>, <span class="number">0xE1</span>, <span class="number">0xE7</span>, <span class="number">0xE5</span>, <span class="number">0x0</span>, <span class="number">0x9</span>, <span class="number">0x12</span>, <span class="number">0x1B</span>, <span class="number">0x24</span>, <span class="number">0x2D</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0x48</span>, <span class="number">0x41</span>, <span class="number">0x5A</span>, <span class="number">0x53</span>, <span class="number">0x6C</span>, <span class="number">0x65</span>, <span class="number">0x7E</span>, <span class="number">0x77</span>, <span class="number">0x90</span>, <span class="number">0x99</span>, <span class="number">0x82</span>, <span class="number">0x8B</span>, <span class="number">0xB4</span>, <span class="number">0xBD</span>, <span class="number">0xA6</span>, <span class="number">0xAF</span>, <span class="number">0xD8</span>, <span class="number">0xD1</span>, <span class="number">0xCA</span>, <span class="number">0xC3</span>, <span class="number">0xFC</span>, <span class="number">0xF5</span>, <span class="number">0xEE</span>, <span class="number">0xE7</span>, <span class="number">0x3B</span>, <span class="number">0x32</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x1F</span>, <span class="number">0x16</span>, <span class="number">0xD</span>, <span class="number">0x4</span>, <span class="number">0x73</span>, <span class="number">0x7A</span>, <span class="number">0x61</span>, <span class="number">0x68</span>, <span class="number">0x57</span>, <span class="number">0x5E</span>, <span class="number">0x45</span>, <span class="number">0x4C</span>, <span class="number">0xAB</span>, <span class="number">0xA2</span>, <span class="number">0xB9</span>, <span class="number">0xB0</span>, <span class="number">0x8F</span>, <span class="number">0x86</span>, <span class="number">0x9D</span>, <span class="number">0x94</span>, <span class="number">0xE3</span>, <span class="number">0xEA</span>, <span class="number">0xF1</span>, <span class="number">0xF8</span>, <span class="number">0xC7</span>, <span class="number">0xCE</span>, <span class="number">0xD5</span>, <span class="number">0xDC</span>, <span class="number">0x76</span>, <span class="number">0x7F</span>, <span class="number">0x64</span>, <span class="number">0x6D</span>, <span class="number">0x52</span>, <span class="number">0x5B</span>, <span class="number">0x40</span>, <span class="number">0x49</span>, <span class="number">0x3E</span>, <span class="number">0x37</span>, <span class="number">0x2C</span>, <span class="number">0x25</span>, <span class="number">0x1A</span>, <span class="number">0x13</span>, <span class="number">0x8</span>, <span class="number">0x1</span>, <span class="number">0xE6</span>, <span class="number">0xEF</span>, <span class="number">0xF4</span>, <span class="number">0xFD</span>, <span class="number">0xC2</span>, <span class="number">0xCB</span>, <span class="number">0xD0</span>, <span class="number">0xD9</span>, <span class="number">0xAE</span>, <span class="number">0xA7</span>, <span class="number">0xBC</span>, <span class="number">0xB5</span>, <span class="number">0x8A</span>, <span class="number">0x83</span>, <span class="number">0x98</span>, <span class="number">0x91</span>, <span class="number">0x4D</span>, <span class="number">0x44</span>, <span class="number">0x5F</span>, <span class="number">0x56</span>, <span class="number">0x69</span>, <span class="number">0x60</span>, <span class="number">0x7B</span>, <span class="number">0x72</span>, <span class="number">0x5</span>, <span class="number">0xC</span>, <span class="number">0x17</span>, <span class="number">0x1E</span>, <span class="number">0x21</span>, <span class="number">0x28</span>, <span class="number">0x33</span>, <span class="number">0x3A</span>, <span class="number">0xDD</span>, <span class="number">0xD4</span>, <span class="number">0xCF</span>, <span class="number">0xC6</span>, <span class="number">0xF9</span>, <span class="number">0xF0</span>, <span class="number">0xEB</span>, <span class="number">0xE2</span>, <span class="number">0x95</span>, <span class="number">0x9C</span>, <span class="number">0x87</span>, <span class="number">0x8E</span>, <span class="number">0xB1</span>, <span class="number">0xB8</span>, <span class="number">0xA3</span>, <span class="number">0xAA</span>, <span class="number">0xEC</span>, <span class="number">0xE5</span>, <span class="number">0xFE</span>, <span class="number">0xF7</span>, <span class="number">0xC8</span>, <span class="number">0xC1</span>, <span class="number">0xDA</span>, <span class="number">0xD3</span>, <span class="number">0xA4</span>, <span class="number">0xAD</span>, <span class="number">0xB6</span>, <span class="number">0xBF</span>, <span class="number">0x80</span>, <span class="number">0x89</span>, <span class="number">0x92</span>, <span class="number">0x9B</span>, <span class="number">0x7C</span>, <span class="number">0x75</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x58</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x43</span>, <span class="number">0x34</span>, <span class="number">0x3D</span>, <span class="number">0x26</span>, <span class="number">0x2F</span>, <span class="number">0x10</span>, <span class="number">0x19</span>, <span class="number">0x2</span>, <span class="number">0xB</span>, <span class="number">0xD7</span>, <span class="number">0xDE</span>, <span class="number">0xC5</span>, <span class="number">0xCC</span>, <span class="number">0xF3</span>, <span class="number">0xFA</span>, <span class="number">0xE1</span>, <span class="number">0xE8</span>, <span class="number">0x9F</span>, <span class="number">0x96</span>, <span class="number">0x8D</span>, <span class="number">0x84</span>, <span class="number">0xBB</span>, <span class="number">0xB2</span>, <span class="number">0xA9</span>, <span class="number">0xA0</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x55</span>, <span class="number">0x5C</span>, <span class="number">0x63</span>, <span class="number">0x6A</span>, <span class="number">0x71</span>, <span class="number">0x78</span>, <span class="number">0xF</span>, <span class="number">0x6</span>, <span class="number">0x1D</span>, <span class="number">0x14</span>, <span class="number">0x2B</span>, <span class="number">0x22</span>, <span class="number">0x39</span>, <span class="number">0x30</span>, <span class="number">0x9A</span>, <span class="number">0x93</span>, <span class="number">0x88</span>, <span class="number">0x81</span>, <span class="number">0xBE</span>, <span class="number">0xB7</span>, <span class="number">0xAC</span>, <span class="number">0xA5</span>, <span class="number">0xD2</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xC9</span>, <span class="number">0xF6</span>, <span class="number">0xFF</span>, <span class="number">0xE4</span>, <span class="number">0xED</span>, <span class="number">0xA</span>, <span class="number">0x3</span>, <span class="number">0x18</span>, <span class="number">0x11</span>, <span class="number">0x2E</span>, <span class="number">0x27</span>, <span class="number">0x3C</span>, <span class="number">0x35</span>, <span class="number">0x42</span>, <span class="number">0x4B</span>, <span class="number">0x50</span>, <span class="number">0x59</span>, <span class="number">0x66</span>, <span class="number">0x6F</span>, <span class="number">0x74</span>, <span class="number">0x7D</span>, <span class="number">0xA1</span>, <span class="number">0xA8</span>, <span class="number">0xB3</span>, <span class="number">0xBA</span>, <span class="number">0x85</span>, <span class="number">0x8C</span>, <span class="number">0x97</span>, <span class="number">0x9E</span>, <span class="number">0xE9</span>, <span class="number">0xE0</span>, <span class="number">0xFB</span>, <span class="number">0xF2</span>, <span class="number">0xCD</span>, <span class="number">0xC4</span>, <span class="number">0xDF</span>, <span class="number">0xD6</span>, <span class="number">0x31</span>, <span class="number">0x38</span>, <span class="number">0x23</span>, <span class="number">0x2A</span>, <span class="number">0x15</span>, <span class="number">0x1C</span>, <span class="number">0x7</span>, <span class="number">0xE</span>, <span class="number">0x79</span>, <span class="number">0x70</span>, <span class="number">0x6B</span>, <span class="number">0x62</span>, <span class="number">0x5D</span>, <span class="number">0x54</span>, <span class="number">0x4F</span>, <span class="number">0x46</span>, <span class="number">0x0</span>, <span class="number">0xB</span>, <span class="number">0x16</span>, <span class="number">0x1D</span>, <span class="number">0x2C</span>, <span class="number">0x27</span>, <span class="number">0x3A</span>, <span class="number">0x31</span>, <span class="number">0x58</span>, <span class="number">0x53</span>, <span class="number">0x4E</span>, <span class="number">0x45</span>, <span class="number">0x74</span>, <span class="number">0x7F</span>, <span class="number">0x62</span>, <span class="number">0x69</span>, <span class="number">0xB0</span>, <span class="number">0xBB</span>, <span class="number">0xA6</span>, <span class="number">0xAD</span>, <span class="number">0x9C</span>, <span class="number">0x97</span>, <span class="number">0x8A</span>, <span class="number">0x81</span>, <span class="number">0xE8</span>, <span class="number">0xE3</span>, <span class="number">0xFE</span>, <span class="number">0xF5</span>, <span class="number">0xC4</span>, <span class="number">0xCF</span>, <span class="number">0xD2</span>, <span class="number">0xD9</span>, <span class="number">0x7B</span>, <span class="number">0x70</span>, <span class="number">0x6D</span>, <span class="number">0x66</span>, <span class="number">0x57</span>, <span class="number">0x5C</span>, <span class="number">0x41</span>, <span class="number">0x4A</span>, <span class="number">0x23</span>, <span class="number">0x28</span>, <span class="number">0x35</span>, <span class="number">0x3E</span>, <span class="number">0xF</span>, <span class="number">0x4</span>, <span class="number">0x19</span>, <span class="number">0x12</span>, <span class="number">0xCB</span>, <span class="number">0xC0</span>, <span class="number">0xDD</span>, <span class="number">0xD6</span>, <span class="number">0xE7</span>, <span class="number">0xEC</span>, <span class="number">0xF1</span>, <span class="number">0xFA</span>, <span class="number">0x93</span>, <span class="number">0x98</span>, <span class="number">0x85</span>, <span class="number">0x8E</span>, <span class="number">0xBF</span>, <span class="number">0xB4</span>, <span class="number">0xA9</span>, <span class="number">0xA2</span>, <span class="number">0xF6</span>, <span class="number">0xFD</span>, <span class="number">0xE0</span>, <span class="number">0xEB</span>, <span class="number">0xDA</span>, <span class="number">0xD1</span>, <span class="number">0xCC</span>, <span class="number">0xC7</span>, <span class="number">0xAE</span>, <span class="number">0xA5</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x82</span>, <span class="number">0x89</span>, <span class="number">0x94</span>, <span class="number">0x9F</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x50</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0x61</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x1E</span>, <span class="number">0x15</span>, <span class="number">0x8</span>, <span class="number">0x3</span>, <span class="number">0x32</span>, <span class="number">0x39</span>, <span class="number">0x24</span>, <span class="number">0x2F</span>, <span class="number">0x8D</span>, <span class="number">0x86</span>, <span class="number">0x9B</span>, <span class="number">0x90</span>, <span class="number">0xA1</span>, <span class="number">0xAA</span>, <span class="number">0xB7</span>, <span class="number">0xBC</span>, <span class="number">0xD5</span>, <span class="number">0xDE</span>, <span class="number">0xC3</span>, <span class="number">0xC8</span>, <span class="number">0xF9</span>, <span class="number">0xF2</span>, <span class="number">0xEF</span>, <span class="number">0xE4</span>, <span class="number">0x3D</span>, <span class="number">0x36</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x11</span>, <span class="number">0x1A</span>, <span class="number">0x7</span>, <span class="number">0xC</span>, <span class="number">0x65</span>, <span class="number">0x6E</span>, <span class="number">0x73</span>, <span class="number">0x78</span>, <span class="number">0x49</span>, <span class="number">0x42</span>, <span class="number">0x5F</span>, <span class="number">0x54</span>, <span class="number">0xF7</span>, <span class="number">0xFC</span>, <span class="number">0xE1</span>, <span class="number">0xEA</span>, <span class="number">0xDB</span>, <span class="number">0xD0</span>, <span class="number">0xCD</span>, <span class="number">0xC6</span>, <span class="number">0xAF</span>, <span class="number">0xA4</span>, <span class="number">0xB9</span>, <span class="number">0xB2</span>, <span class="number">0x83</span>, <span class="number">0x88</span>, <span class="number">0x95</span>, <span class="number">0x9E</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x51</span>, <span class="number">0x5A</span>, <span class="number">0x6B</span>, <span class="number">0x60</span>, <span class="number">0x7D</span>, <span class="number">0x76</span>, <span class="number">0x1F</span>, <span class="number">0x14</span>, <span class="number">0x9</span>, <span class="number">0x2</span>, <span class="number">0x33</span>, <span class="number">0x38</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x8C</span>, <span class="number">0x87</span>, <span class="number">0x9A</span>, <span class="number">0x91</span>, <span class="number">0xA0</span>, <span class="number">0xAB</span>, <span class="number">0xB6</span>, <span class="number">0xBD</span>, <span class="number">0xD4</span>, <span class="number">0xDF</span>, <span class="number">0xC2</span>, <span class="number">0xC9</span>, <span class="number">0xF8</span>, <span class="number">0xF3</span>, <span class="number">0xEE</span>, <span class="number">0xE5</span>, <span class="number">0x3C</span>, <span class="number">0x37</span>, <span class="number">0x2A</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0x1B</span>, <span class="number">0x6</span>, <span class="number">0xD</span>, <span class="number">0x64</span>, <span class="number">0x6F</span>, <span class="number">0x72</span>, <span class="number">0x79</span>, <span class="number">0x48</span>, <span class="number">0x43</span>, <span class="number">0x5E</span>, <span class="number">0x55</span>, <span class="number">0x1</span>, <span class="number">0xA</span>, <span class="number">0x17</span>, <span class="number">0x1C</span>, <span class="number">0x2D</span>, <span class="number">0x26</span>, <span class="number">0x3B</span>, <span class="number">0x30</span>, <span class="number">0x59</span>, <span class="number">0x52</span>, <span class="number">0x4F</span>, <span class="number">0x44</span>, <span class="number">0x75</span>, <span class="number">0x7E</span>, <span class="number">0x63</span>, <span class="number">0x68</span>, <span class="number">0xB1</span>, <span class="number">0xBA</span>, <span class="number">0xA7</span>, <span class="number">0xAC</span>, <span class="number">0x9D</span>, <span class="number">0x96</span>, <span class="number">0x8B</span>, <span class="number">0x80</span>, <span class="number">0xE9</span>, <span class="number">0xE2</span>, <span class="number">0xFF</span>, <span class="number">0xF4</span>, <span class="number">0xC5</span>, <span class="number">0xCE</span>, <span class="number">0xD3</span>, <span class="number">0xD8</span>, <span class="number">0x7A</span>, <span class="number">0x71</span>, <span class="number">0x6C</span>, <span class="number">0x67</span>, <span class="number">0x56</span>, <span class="number">0x5D</span>, <span class="number">0x40</span>, <span class="number">0x4B</span>, <span class="number">0x22</span>, <span class="number">0x29</span>, <span class="number">0x34</span>, <span class="number">0x3F</span>, <span class="number">0xE</span>, <span class="number">0x5</span>, <span class="number">0x18</span>, <span class="number">0x13</span>, <span class="number">0xCA</span>, <span class="number">0xC1</span>, <span class="number">0xDC</span>, <span class="number">0xD7</span>, <span class="number">0xE6</span>, <span class="number">0xED</span>, <span class="number">0xF0</span>, <span class="number">0xFB</span>, <span class="number">0x92</span>, <span class="number">0x99</span>, <span class="number">0x84</span>, <span class="number">0x8F</span>, <span class="number">0xBE</span>, <span class="number">0xB5</span>, <span class="number">0xA8</span>, <span class="number">0xA3</span>]</span><br><span class="line">tblstate = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    tblstate.append(tbl[<span class="number">0x100</span> * i:<span class="number">0x100</span> * (i + <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes2state</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">int</span>]]:</span><br><span class="line">    <span class="keyword">return</span> [[data[i * <span class="number">4</span> + j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">state2bytes</span>(<span class="params">state: <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(state[i][j] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x68</span>, <span class="number">0x0</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x6E</span>, <span class="number">0x0</span>, <span class="number">0x65</span>, <span class="number">0x44</span>, <span class="number">0x64</span>, <span class="number">0x0</span>, <span class="number">0x79</span>, <span class="number">0x65</span>, <span class="number">0x4B</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x69</span>, <span class="number">0x0</span>, <span class="number">0x32</span>, <span class="number">0xA</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x57</span>, <span class="number">0x4E</span>, <span class="number">0x63</span>, <span class="number">0x0</span>, <span class="number">0x2E</span>, <span class="number">0x2B</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x68</span>, <span class="number">0x0</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x6F</span>, <span class="number">0x0</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0xC</span>, <span class="number">0x0</span>, <span class="number">0x38</span>, <span class="number">0x6</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x0</span>, <span class="number">0x32</span>, <span class="number">0xA</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x24</span>, <span class="number">0x27</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x1C</span>, <span class="number">0x21</span>, <span class="number">0x2D</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x6E</span>, <span class="number">0x0</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x6B</span>, <span class="number">0x0</span>, <span class="number">0x65</span>, <span class="number">0x44</span>, <span class="number">0x62</span>, <span class="number">0x0</span>, <span class="number">0x79</span>, <span class="number">0x65</span>, <span class="number">0x4F</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x66</span>, <span class="number">0x0</span>, <span class="number">0x32</span>, <span class="number">0xA</span>, <span class="number">0xD</span>, <span class="number">0x0</span>, <span class="number">0x57</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>, <span class="number">0x0</span>, <span class="number">0x2E</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x76</span>, <span class="number">0x0</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x7B</span>, <span class="number">0x0</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0x14</span>, <span class="number">0x0</span>, <span class="number">0x38</span>, <span class="number">0x6</span>, <span class="number">0x34</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x56</span>, <span class="number">0x0</span>, <span class="number">0x32</span>, <span class="number">0xA</span>, <span class="number">0x2D</span>, <span class="number">0x0</span>, <span class="number">0x24</span>, <span class="number">0x27</span>, <span class="number">0x39</span>, <span class="number">0x0</span>, <span class="number">0x1C</span>, <span class="number">0x21</span>, <span class="number">0xD</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x16</span>, <span class="number">0x0</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x3B</span>, <span class="number">0x0</span>, <span class="number">0x65</span>, <span class="number">0x44</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x79</span>, <span class="number">0x65</span>, <span class="number">0xF</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x96</span>, <span class="number">0x0</span>, <span class="number">0x32</span>, <span class="number">0xA</span>, <span class="number">0xAD</span>, <span class="number">0x0</span>, <span class="number">0x57</span>, <span class="number">0x4E</span>, <span class="number">0xAF</span>, <span class="number">0x0</span>, <span class="number">0x2E</span>, <span class="number">0x2B</span>, <span class="number">0xA0</span>, <span class="number">0x0</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x8D</span>, <span class="number">0x0</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x20</span>, <span class="number">0x0</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0x8F</span>, <span class="number">0x0</span>, <span class="number">0x38</span>, <span class="number">0x6</span>, <span class="number">0x2F</span>]</span><br><span class="line">key = [key[<span class="number">0x10</span> * i : <span class="number">0x10</span> * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key) // <span class="number">16</span>)]</span><br><span class="line">key = [bytes2state(k) <span class="keyword">for</span> k <span class="keyword">in</span> key]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_pair_maps</span>(<span class="params">tbl: <span class="type">List</span>[<span class="built_in">bytes</span>]</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(tbl) == <span class="number">5</span> <span class="keyword">and</span> <span class="built_in">all</span>(<span class="built_in">len</span>(t) == <span class="number">256</span> <span class="keyword">for</span> t <span class="keyword">in</span> tbl)</span><br><span class="line">    p_map = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">    q_map = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">    t1 = tbl[<span class="number">1</span>]</span><br><span class="line">    t4 = tbl[<span class="number">4</span>]</span><br><span class="line">    t0 = tbl[<span class="number">0</span>]</span><br><span class="line">    t3 = tbl[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># build p_map: p = t1[a0] ^ t4[a1]</span></span><br><span class="line">    <span class="keyword">for</span> a0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        v0 = t1[a0]</span><br><span class="line">        <span class="keyword">for</span> a1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            p = v0 ^ t4[a1]</span><br><span class="line">            p_map[p].append((a0, a1))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># build q_map: q = t0[a2] ^ t3[a3]</span></span><br><span class="line">    <span class="keyword">for</span> a2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        v2 = t0[a2]</span><br><span class="line">        <span class="keyword">for</span> a3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            q = v2 ^ t3[a3]</span><br><span class="line">            q_map[q].append((a2, a3))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p_map, q_map</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert_one_column</span>(<span class="params">b0: <span class="built_in">int</span>, b1: <span class="built_in">int</span>, b2: <span class="built_in">int</span>, b3: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">                      tbl: <span class="type">List</span>[<span class="built_in">bytes</span>],</span></span><br><span class="line"><span class="params">                      p_map, q_map</span>) -&gt; <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>]]:</span><br><span class="line">    t0, t1, t2, t3, t4 = tbl  <span class="comment"># t2 not used directly here but kept for clarity</span></span><br><span class="line">    solutions = []</span><br><span class="line">    <span class="comment"># p ^ q = b0 =&gt; q = p ^ b0</span></span><br><span class="line">    <span class="keyword">for</span> p, left_pairs <span class="keyword">in</span> p_map.items():</span><br><span class="line">        q = p ^ b0</span><br><span class="line">        right_pairs = q_map.get(q)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> right_pairs:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (a0, a1) <span class="keyword">in</span> left_pairs:</span><br><span class="line">            <span class="comment"># prepare some reused values to speed up</span></span><br><span class="line">            t1_a0 = t3[a0]  <span class="comment"># note: b1 uses tbl[3][a0]</span></span><br><span class="line">            t1_a1 = t1[a1]  <span class="comment"># tbl[1][a1] used in b1 (but careful indices below)</span></span><br><span class="line">            <span class="keyword">for</span> (a2, a3) <span class="keyword">in</span> right_pairs:</span><br><span class="line">                <span class="comment"># compute b1,b2,b3 according to formulas:</span></span><br><span class="line">                <span class="comment"># b1 = tbl[3][a0] ^ tbl[1][a1] ^ tbl[4][a2] ^ tbl[0][a3]</span></span><br><span class="line">                <span class="keyword">if</span> (t3[a0] ^ t1[a1] ^ t4[a2] ^ t0[a3]) != b1:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># b2 = tbl[0][a0] ^ tbl[3][a1] ^ tbl[1][a2] ^ tbl[4][a3]</span></span><br><span class="line">                <span class="keyword">if</span> (t0[a0] ^ t3[a1] ^ t1[a2] ^ t4[a3]) != b2:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># b3 = tbl[4][a0] ^ tbl[0][a1] ^ tbl[3][a2] ^ tbl[1][a3]</span></span><br><span class="line">                <span class="keyword">if</span> (t4[a0] ^ t0[a1] ^ t3[a2] ^ t1[a3]) != b3:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># all matched</span></span><br><span class="line">                solutions.append((a0, a1, a2, a3))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> solutions</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_col_mix</span>(<span class="params">state: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]], tbl: <span class="type">List</span>[<span class="built_in">bytes</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(state) == <span class="number">4</span> <span class="keyword">and</span> <span class="built_in">all</span>(<span class="built_in">len</span>(row) == <span class="number">4</span> <span class="keyword">for</span> row <span class="keyword">in</span> state)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(tbl) == <span class="number">5</span> <span class="keyword">and</span> <span class="built_in">all</span>(<span class="built_in">len</span>(t) == <span class="number">256</span> <span class="keyword">for</span> t <span class="keyword">in</span> tbl)</span><br><span class="line"></span><br><span class="line">    p_map, q_map = build_pair_maps(tbl)</span><br><span class="line"></span><br><span class="line">    out = [[<span class="number">0</span>]*<span class="number">4</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    solutions_per_col = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="comment"># read output bytes b0..b3 from rows 0..3 at this column</span></span><br><span class="line">        b0 = state[<span class="number">0</span>][col] &amp; <span class="number">0xFF</span></span><br><span class="line">        b1 = state[<span class="number">1</span>][col] &amp; <span class="number">0xFF</span></span><br><span class="line">        b2 = state[<span class="number">2</span>][col] &amp; <span class="number">0xFF</span></span><br><span class="line">        b3 = state[<span class="number">3</span>][col] &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">        sols = invert_one_column(b0, b1, b2, b3, tbl, p_map, q_map)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> sols:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;No inverse found for column <span class="subst">&#123;col&#125;</span> with bytes <span class="subst">&#123;(b0,b1,b2,b3)&#125;</span>&quot;</span>)</span><br><span class="line">        a0,a1,a2,a3 = sols[<span class="number">0</span>]</span><br><span class="line">        out[<span class="number">0</span>][col] = a0</span><br><span class="line">        out[<span class="number">1</span>][col] = a1</span><br><span class="line">        out[<span class="number">2</span>][col] = a2</span><br><span class="line">        out[<span class="number">3</span>][col] = a3</span><br><span class="line">        solutions_per_col.append(sols)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> out, solutions_per_col</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_addroundkey</span>(<span class="params">state : <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">int</span>]], round_key : <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">int</span>]]</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            state[i][j] ^= round_key[j][i]</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_SBOXswap</span>(<span class="params">state: <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">int</span>]]</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            state[i][j] = inv_sbox.index(state[i][j])</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_ShiftRows</span>(<span class="params">state: <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">int</span>]]</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        state[i] = state[i][i:] + state[i][:i]</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_AES</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">global</span> key, inv_sbox, tblstate</span><br><span class="line"></span><br><span class="line">    state = bytes2state(data)</span><br><span class="line">    real_state = [[<span class="number">0</span>] * <span class="number">4</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            real_state[i][j] = state[j][i]</span><br><span class="line">    real_state = inv_addroundkey(real_state, key[<span class="number">0</span>])</span><br><span class="line">    real_state = inv_ShiftRows(real_state)</span><br><span class="line">    real_state = inv_SBOXswap(real_state)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">        real_state, _ = inv_col_mix(real_state, tblstate)</span><br><span class="line">        real_state = inv_addroundkey(real_state, key[i])</span><br><span class="line">        real_state = inv_ShiftRows(real_state)</span><br><span class="line">        real_state = inv_SBOXswap(real_state)</span><br><span class="line">    real_state = inv_addroundkey(real_state, key[<span class="number">10</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            state[i][j] = real_state[j][i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> state2bytes(state)</span><br><span class="line"></span><br><span class="line">xor_key = [<span class="number">0xA0</span>, <span class="number">0x81</span>, <span class="number">0x3E</span>, <span class="number">0x4D</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xD4</span>, <span class="number">0xC2</span>, <span class="number">0x7B</span>, <span class="number">0xA5</span>, <span class="number">0x46</span>, <span class="number">0x20</span>, <span class="number">0x82</span>, <span class="number">0xB5</span>, <span class="number">0x1C</span>, <span class="number">0xEF</span>, <span class="number">0x43</span>, <span class="number">0x51</span>, <span class="number">0x8B</span>, <span class="number">0xC3</span>, <span class="number">0x5E</span>, <span class="number">0x57</span>, <span class="number">0xCC</span>, <span class="number">0x4</span>, <span class="number">0xF0</span>, <span class="number">0xBC</span>, <span class="number">0x43</span>, <span class="number">0x85</span>, <span class="number">0x1E</span>, <span class="number">0x9C</span>, <span class="number">0xBB</span>, <span class="number">0x51</span>, <span class="number">0xED</span>, <span class="number">0x59</span>, <span class="number">0x82</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x4</span>, <span class="number">0xAC</span>, <span class="number">0xB</span>, <span class="number">0xE4</span>, <span class="number">0xBA</span>, <span class="number">0xC2</span>, <span class="number">0xBA</span>, <span class="number">0x53</span>, <span class="number">0x27</span>, <span class="number">0xF0</span>, <span class="number">0x1B</span>, <span class="number">0xA1</span>, <span class="number">0x35</span>, <span class="number">0x1</span>, <span class="number">0xDF</span>, <span class="number">0xBB</span>, <span class="number">0x6F</span>, <span class="number">0xD2</span>, <span class="number">0x83</span>, <span class="number">0xEB</span>, <span class="number">0x49</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0xF7</span>, <span class="number">0xE5</span>, <span class="number">0x40</span>, <span class="number">0x4B</span>]</span><br><span class="line">xor_key = [xor_key[<span class="number">0x10</span> * i : <span class="number">0x10</span> * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(xor_key) // <span class="number">16</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc) // <span class="number">0x10</span>):</span><br><span class="line">    enc[<span class="number">0x10</span> * i : <span class="number">0x10</span> * (i + <span class="number">1</span>)] = <span class="built_in">map</span>(<span class="built_in">int</span>.__xor__, enc[<span class="number">0x10</span> * i : <span class="number">0x10</span> * (i + <span class="number">1</span>)], xor_key[i])</span><br><span class="line">    enc[<span class="number">0x10</span> * i : <span class="number">0x10</span> * (i + <span class="number">1</span>)] = <span class="built_in">bytearray</span>(inv_AES(enc[<span class="number">0x10</span> * i : <span class="number">0x10</span> * (i + <span class="number">1</span>)]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789+/&#x27;</span></span><br><span class="line"></span><br><span class="line">idx = <span class="number">0</span></span><br><span class="line">res = []</span><br><span class="line">eof = <span class="literal">False</span></span><br><span class="line">padding = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> idx &gt;= <span class="number">0x40</span> - <span class="number">3</span>:</span><br><span class="line">        p = enc[idx :]</span><br><span class="line">        padding = <span class="number">3</span> - <span class="built_in">len</span>(p)</span><br><span class="line">        eof = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = enc[idx : idx + <span class="number">3</span>]</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(p):</span><br><span class="line">        n |= b &lt;&lt; <span class="number">8</span>  * i</span><br><span class="line">    c = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span> - padding):</span><br><span class="line">        c += [table[n &amp; <span class="number">0x3f</span>]]</span><br><span class="line">        n &gt;&gt;= <span class="number">6</span></span><br><span class="line">    c += [<span class="string">&#x27;=&#x27;</span>] * (<span class="number">4</span> - <span class="built_in">len</span>(c))</span><br><span class="line">    res += c</span><br><span class="line">    <span class="keyword">if</span> eof:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    idx += <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(res))</span><br></pre></td></tr></table></figure>

<h2 id="沪赛毁了我的第五题-其实没有沪赛也做不出来"><a href="#沪赛毁了我的第五题-其实没有沪赛也做不出来" class="headerlink" title="沪赛毁了我的第五题(其实没有沪赛也做不出来)"></a>沪赛毁了我的第五题(其实没有沪赛也做不出来)</h2><h2 id="第六题"><a href="#第六题" class="headerlink" title="第六题"></a>第六题</h2><h3 id="简单整体分析"><a href="#简单整体分析" class="headerlink" title="简单整体分析"></a>简单整体分析</h3><p>先简单运行一下程序, 会发现是一个易语言写的GUI, 结合文件大小应该是静态编译的. 然后随意输入一些数据点击登录没有反应, 题目说明中提到验证失败没有弹窗或弹出错误提示, 再试了一下更长的输入发现有错误提示的图片了, 二分法可以快速定位到这个临界值是31字节, 说明要提交的答案大概率就是31字节长的.</p>
<p>接下来开始分析, 既然是WindowsGUI程序, 获取输入框内容大概率要用到<code>GetWindowTextW</code>, 刚好题目也导入了这个函数, 为了避开一些初始化时的反调试(如果有的话), 下面的调试都是启动程序后附加调试的.</p>
<p>在<code>GetWindowTextW</code>下好断点后点击登录成功断下, step out发现获取到了输入:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154844.png" alt="1"></p>
<p>硬件断点跟踪数据流到某个地方发现反汇编失败了:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154954.png" alt="QQ_1756216739186"></p>
<p>观察一下会发现一条陌生的指令<code>bextr</code>, 应该就是它导致了这个错误, 并且这个错误发生后IDA的反汇编器会直接摆烂不再可以进行反汇编.</p>
<p>继续跟踪数据流发现了输入长度和一个熟悉的立即数进行了比较:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154858.png" alt="QQ_1756217008845"></p>
<p>并且这个函数没有那条神必指令, 重启IDA来到这个函数进行反汇编, 若输入长度&gt;&#x3D; 0x1f就会把输入当参数进到<code>do_check(12351552)</code>, 从f5结果来看输入只进到了这几个函数里进行处理:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154902.png" alt="QQ_1756217486555"></p>
<p>调试可以发现前两个都是拷贝函数, 第三个函数真正进行了加密操作, 而为了确定加密的范围继续追踪这一步的密文, 下一次程序断下就来到了最后一个函数中, 并且和一段字节进行了比较:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154737.png" alt="QQ_1756217709357"></p>
<p>在内存中搜索和加密结果比较的字节串可以在数据段找到:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155043.png" alt="QQ_1756217788362"></p>
<p>修改比较结果发现可以弹出正确提示:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155032.png" alt="QQ_1756217833370"></p>
<h3 id="第一步加密"><a href="#第一步加密" class="headerlink" title="第一步加密"></a>第一步加密</h3><p>也就是说真正的加密逻辑只用看<code>encrypt(12352547)</code>, 继续硬断追踪数据流, 第一步加密是将输入零扩展成DWORD:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155126.png" alt="img"></p>
<p>再跟到下一步会发现在<code>123533C6</code>进行了写回:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155239.png" alt="img"></p>
<p>在上面两个调用上下断点, 实际上<code>callsm</code>就是一个跳板函数, 用于调用放在<code>EBX</code>中的函数, 第一个跳板在每<code>i</code>次调用时从未被零扩展的ser取出<code>ser[(4 - (i &amp; 3)) * (i &gt;&gt; 2) : (i &gt;&gt; 2) &lt;&lt; 2]</code>, 例如输入的是1234, 那么每次取出的就是:</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27;?234&#x27;</span><br><span class="line">&#x27;234&#x27;</span><br><span class="line">&#x27;34&#x27;</span><br><span class="line">&#x27;4&#x27;</span><br></pre></td></tr></table></figure>

<p>这里<code>1</code>替换成<code>?</code>是因为调试会发现每次取出一个DWORD时最高字节都会变化, 这个变化才是真正的第二步加密, 这里的两个跳板实际上执行的就是第二步加密完后再零扩展存入.</p>
<p>取出的DWORD来自<code>[ebp-30h]</code>, 向上溯源, 这个值来自:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155250.png" alt="QQ_1756219144134"></p>
<p>跳板执行的<code>do_xor</code>实际上是将第二个参数和第五个参数进行异或:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154738.png" alt="QQ_1756219390304"></p>
<p>再向上溯源, 这个异或的字节来自<code>[ebp-0x64]</code>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154738.png" alt="QQ_1756219495802"></p>
<p>是一个有意义的字节串, 应该就是异或的key, 到这里总结一下真正的第一步加密:</p>
<ul>
<li>对输入的下标<code>4 * i</code>的字节异或一个字节流</li>
</ul>
<h3 id="第二步加密"><a href="#第二步加密" class="headerlink" title="第二步加密"></a>第二步加密</h3><p>继续跟踪数据流, 第二个字节的处理先是加了0x100:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155254.png" alt="QQ_1756219843233"></p>
<p>这里用浮点数实现貌似是易语言特性, 接下来这个值被当作下标从一个表中取出一个字节存回.</p>
<h3 id="第三步加密"><a href="#第三步加密" class="headerlink" title="第三步加密"></a>第三步加密</h3><p>第三个字节的断点在<code>12353581</code>被触发, 准备通过跳板进行异或操作, 和它异或的字节就是上面加密完的第二个字节:</p>
<p><img src="F:/Learn/REprac/KCTF2025/6/assets/%7B6D7BEEB9-344B-4566-ABFE-14BFF6CE9FA4%7D" alt="img"></p>
<p>在这两个操作上下断点会发现它们是交替执行的, 总结一下这两步加密</p>
<ul>
<li>奇数下标的字节+0x100取表存回</li>
<li>偶数下标的字节异或前一个字节</li>
</ul>
<p>接下来要解决的问题就是执行轮次的问题, 从f5的结果来看大概是执行114514 * 0x20轮:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154738.png" alt="QQ_1756220363380"></p>
<p>在那两个操作上下条件断点分析轮次问题:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">last = <span class="built_in">open</span>(<span class="string">&#x27;log.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;log.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>).write(<span class="built_in">str</span>(<span class="built_in">int</span>(last) + <span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-154739.png" alt="QQ_1756220474464"></p>
<p>此时的大轮是0x1442次, 简单计算一下:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F09%2F20250909-155259.png" alt="QQ_1756220525035"></p>
<p>我的输入是0x20字节, 从子轮次次数和两次操作数量不同和计算结果来看, 有一个字节实际上没有参加2, 3步加密, 使得2, 3步加密的顺序是<code>2; 3; 2;...; 3; 2</code>导致取表的次数比异或的次数多了很多, 调试会发现是第1个字节没有参加这个过程.</p>
<p>然后就得到之前和密文对比的加密结果了.</p>
<p>至此可以写出keygen:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">table = [<span class="number">0xB5</span>, <span class="number">0xF4</span>, <span class="number">0x53</span>, <span class="number">0x8F</span>, <span class="number">0xC2</span>, <span class="number">0x9F</span>, <span class="number">0x17</span>, <span class="number">0x33</span>, <span class="number">0x47</span>, <span class="number">0x2</span>, <span class="number">0x5D</span>, <span class="number">0x55</span>, <span class="number">0x42</span>, <span class="number">0x2F</span>, <span class="number">0xBD</span>, <span class="number">0xC0</span>, <span class="number">0xA3</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0xCD</span>, <span class="number">0xB0</span>, <span class="number">0xE6</span>, <span class="number">0x11</span>, <span class="number">0xD6</span>, <span class="number">0xA8</span>, <span class="number">0x3</span>, <span class="number">0xED</span>, <span class="number">0xED</span>, <span class="number">0xA6</span>, <span class="number">0x79</span>, <span class="number">0x76</span>, <span class="number">0xCE</span>, <span class="number">0xC9</span>, <span class="number">0x0</span>, <span class="number">0x56</span>, <span class="number">0x13</span>, <span class="number">0x92</span>, <span class="number">0x21</span>, <span class="number">0xC2</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x47</span>, <span class="number">0x44</span>, <span class="number">0x7D</span>, <span class="number">0x34</span>, <span class="number">0x19</span>, <span class="number">0xBE</span>, <span class="number">0x82</span>, <span class="number">0x10</span>, <span class="number">0x7</span>, <span class="number">0xAC</span>, <span class="number">0xD0</span>, <span class="number">0x21</span>, <span class="number">0x23</span>, <span class="number">0xA9</span>, <span class="number">0x24</span>, <span class="number">0x80</span>, <span class="number">0x33</span>, <span class="number">0x35</span>, <span class="number">0x92</span>, <span class="number">0x43</span>, <span class="number">0x4</span>, <span class="number">0xB5</span>, <span class="number">0x77</span>, <span class="number">0xA1</span>, <span class="number">0x1</span>, <span class="number">0xBB</span>, <span class="number">0xB0</span>, <span class="number">0x57</span>, <span class="number">0x3</span>, <span class="number">0x88</span>, <span class="number">0x9</span>, <span class="number">0x49</span>, <span class="number">0x6B</span>, <span class="number">0xCF</span>, <span class="number">0xF8</span>, <span class="number">0x6D</span>, <span class="number">0x6F</span>, <span class="number">0xBC</span>, <span class="number">0x8C</span>, <span class="number">0xE5</span>, <span class="number">0xB1</span>, <span class="number">0x35</span>, <span class="number">0xA0</span>, <span class="number">0x6B</span>, <span class="number">0x16</span>, <span class="number">0x60</span>, <span class="number">0x54</span>, <span class="number">0xF2</span>, <span class="number">0xD5</span>, <span class="number">0x65</span>, <span class="number">0xBE</span>, <span class="number">0x8A</span>, <span class="number">0xCE</span>, <span class="number">0x75</span>, <span class="number">0xDC</span>, <span class="number">0x85</span>, <span class="number">0x1E</span>, <span class="number">0xB</span>, <span class="number">0xCD</span>, <span class="number">0xD8</span>, <span class="number">0xF0</span>, <span class="number">0x71</span>, <span class="number">0x41</span>, <span class="number">0xC4</span>, <span class="number">0x95</span>, <span class="number">0x87</span>, <span class="number">0x2F</span>, <span class="number">0xB5</span>, <span class="number">0xD8</span>, <span class="number">0xC0</span>, <span class="number">0xC6</span>, <span class="number">0x6A</span>, <span class="number">0x8B</span>, <span class="number">0x6D</span>, <span class="number">0xA5</span>, <span class="number">0x56</span>, <span class="number">0x66</span>, <span class="number">0x3E</span>, <span class="number">0x4E</span>, <span class="number">0x46</span>, <span class="number">0x12</span>, <span class="number">0x5</span>, <span class="number">0xD8</span>, <span class="number">0x45</span>, <span class="number">0x80</span>, <span class="number">0xBE</span>, <span class="number">0xE5</span>, <span class="number">0xBC</span>, <span class="number">0x7F</span>, <span class="number">0xCD</span>, <span class="number">0xD4</span>, <span class="number">0xDE</span>, <span class="number">0x8E</span>, <span class="number">0x86</span>, <span class="number">0x38</span>, <span class="number">0x43</span>, <span class="number">0xEE</span>, <span class="number">0xF2</span>, <span class="number">0x88</span>, <span class="number">0xD3</span>, <span class="number">0xFC</span>, <span class="number">0xD0</span>, <span class="number">0x18</span>, <span class="number">0xE6</span>, <span class="number">0xBE</span>, <span class="number">0xDB</span>, <span class="number">0x47</span>, <span class="number">0xAA</span>, <span class="number">0xBC</span>, <span class="number">0x4B</span>, <span class="number">0xFA</span>, <span class="number">0xC4</span>, <span class="number">0x11</span>, <span class="number">0x9E</span>, <span class="number">0x4A</span>, <span class="number">0x3A</span>, <span class="number">0xC1</span>, <span class="number">0x98</span>, <span class="number">0x7A</span>, <span class="number">0x90</span>, <span class="number">0x4D</span>, <span class="number">0x89</span>, <span class="number">0x2C</span>, <span class="number">0x31</span>, <span class="number">0x85</span>, <span class="number">0xCE</span>, <span class="number">0xD4</span>, <span class="number">0x11</span>, <span class="number">0x9E</span>, <span class="number">0x9A</span>, <span class="number">0x6C</span>, <span class="number">0x91</span>, <span class="number">0x84</span>, <span class="number">0xF7</span>, <span class="number">0x6A</span>, <span class="number">0xA3</span>, <span class="number">0x71</span>, <span class="number">0x7</span>, <span class="number">0xEF</span>, <span class="number">0x2E</span>, <span class="number">0xBF</span>, <span class="number">0x90</span>, <span class="number">0x41</span>, <span class="number">0xB4</span>, <span class="number">0xFB</span>, <span class="number">0xB7</span>, <span class="number">0x7B</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0xC</span>, <span class="number">0x83</span>, <span class="number">0x47</span>, <span class="number">0xB0</span>, <span class="number">0xC7</span>, <span class="number">0x3D</span>, <span class="number">0x99</span>, <span class="number">0x7E</span>, <span class="number">0x51</span>, <span class="number">0xFE</span>, <span class="number">0x75</span>, <span class="number">0xCC</span>, <span class="number">0x7</span>, <span class="number">0x44</span>, <span class="number">0xB5</span>, <span class="number">0x18</span>, <span class="number">0x3A</span>, <span class="number">0xA4</span>, <span class="number">0xE7</span>, <span class="number">0xCD</span>, <span class="number">0x7A</span>, <span class="number">0x3</span>, <span class="number">0xAB</span>, <span class="number">0x18</span>, <span class="number">0x14</span>, <span class="number">0x9</span>, <span class="number">0x5D</span>, <span class="number">0xF7</span>, <span class="number">0xD9</span>, <span class="number">0xD3</span>, <span class="number">0xF4</span>, <span class="number">0x93</span>, <span class="number">0x21</span>, <span class="number">0xE8</span>, <span class="number">0x2A</span>, <span class="number">0xCF</span>, <span class="number">0x10</span>, <span class="number">0x6F</span>, <span class="number">0xDE</span>, <span class="number">0x21</span>, <span class="number">0x18</span>, <span class="number">0x9F</span>, <span class="number">0xB6</span>, <span class="number">0xA1</span>, <span class="number">0xBF</span>, <span class="number">0x76</span>, <span class="number">0x8</span>, <span class="number">0x5F</span>, <span class="number">0xA3</span>, <span class="number">0xAE</span>, <span class="number">0xFB</span>, <span class="number">0xFA</span>, <span class="number">0xBB</span>, <span class="number">0xED</span>, <span class="number">0xE9</span>, <span class="number">0x6E</span>, <span class="number">0xDF</span>, <span class="number">0x3C</span>, <span class="number">0x8</span>, <span class="number">0x2E</span>, <span class="number">0x8B</span>, <span class="number">0xBA</span>, <span class="number">0x4A</span>, <span class="number">0x73</span>, <span class="number">0xE0</span>, <span class="number">0x91</span>, <span class="number">0x5E</span>, <span class="number">0x7C</span>, <span class="number">0x6D</span>, <span class="number">0xFF</span>, <span class="number">0xAE</span>, <span class="number">0xE2</span>, <span class="number">0xA7</span>, <span class="number">0x39</span>, <span class="number">0x5F</span>, <span class="number">0x99</span>, <span class="number">0xCE</span>, <span class="number">0x6E</span>, <span class="number">0xF1</span>, <span class="number">0x95</span>, <span class="number">0x19</span>, <span class="number">0x80</span>, <span class="number">0x87</span>, <span class="number">0xB1</span>, <span class="number">0x96</span>, <span class="number">0x58</span>, <span class="number">0xCD</span>, <span class="number">0x54</span>, <span class="number">0xFC</span>, <span class="number">0x4C</span>, <span class="number">0x6C</span>, <span class="number">0x9C</span>, <span class="number">0x1E</span>, <span class="number">0x1A</span>, <span class="number">0x40</span>, <span class="number">0x42</span>, <span class="number">0xE</span>, <span class="number">0x65</span>, <span class="number">0xBE</span>, <span class="number">0x13</span>, <span class="number">0x8D</span>, <span class="number">0x4D</span>, <span class="number">0x85</span>, <span class="number">0x66</span>, <span class="number">0xC3</span>, <span class="number">0xBC</span>, <span class="number">0x11</span>, <span class="number">0xDE</span>, <span class="number">0xFE</span>, <span class="number">0xA2</span>, <span class="number">0x2C</span>, <span class="number">0xDA</span>, <span class="number">0xC5</span>, <span class="number">0xC8</span>, <span class="number">0xD3</span>, <span class="number">0xB7</span>, <span class="number">0xB4</span>, <span class="number">0x48</span>, <span class="number">0x5A</span>, <span class="number">0x45</span>, <span class="number">0xEA</span>, <span class="number">0x18</span>, <span class="number">0x89</span>, <span class="number">0xE5</span>, <span class="number">0xE0</span>, <span class="number">0xF9</span>, <span class="number">0x52</span>, <span class="number">0x35</span>, <span class="number">0xEC</span>, <span class="number">0x1B</span>, <span class="number">0x47</span>, <span class="number">0xAF</span>, <span class="number">0xDB</span>, <span class="number">0xA0</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0xE9</span>, <span class="number">0xB3</span>, <span class="number">0x3F</span>, <span class="number">0xC7</span>, <span class="number">0x24</span>, <span class="number">0x33</span>, <span class="number">0xE6</span>, <span class="number">0xBD</span>, <span class="number">0x46</span>, <span class="number">0x2A</span>, <span class="number">0x88</span>, <span class="number">0x53</span>, <span class="number">0x76</span>, <span class="number">0x7A</span>, <span class="number">0x0</span>, <span class="number">0x6F</span>, <span class="number">0xD8</span>, <span class="number">0x3C</span>, <span class="number">0xD</span>, <span class="number">0x81</span>, <span class="number">0x59</span>, <span class="number">0xD0</span>, <span class="number">0xAA</span>, <span class="number">0xDD</span>, <span class="number">0x1</span>, <span class="number">0x75</span>, <span class="number">0xD1</span>, <span class="number">0x26</span>, <span class="number">0xAC</span>, <span class="number">0x77</span>, <span class="number">0x4A</span>, <span class="number">0x9</span>, <span class="number">0x5</span>, <span class="number">0x8B</span>, <span class="number">0xF</span>, <span class="number">0xF3</span>, <span class="number">0x2</span>, <span class="number">0x17</span>, <span class="number">0xED</span>, <span class="number">0x57</span>, <span class="number">0xF2</span>, <span class="number">0x5D</span>, <span class="number">0x70</span>, <span class="number">0x8</span>, <span class="number">0xB2</span>, <span class="number">0x3E</span>, <span class="number">0xEF</span>, <span class="number">0xC1</span>, <span class="number">0xA9</span>, <span class="number">0x2F</span>, <span class="number">0xF5</span>, <span class="number">0xA8</span>, <span class="number">0x6</span>, <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x9F</span>, <span class="number">0x1C</span>, <span class="number">0xCC</span>, <span class="number">0x72</span>, <span class="number">0x8C</span>, <span class="number">0x31</span>, <span class="number">0x98</span>, <span class="number">0x29</span>, <span class="number">0xEB</span>, <span class="number">0xAD</span>, <span class="number">0x64</span>, <span class="number">0x9E</span>, <span class="number">0xF8</span>, <span class="number">0xB0</span>, <span class="number">0x30</span>, <span class="number">0x78</span>, <span class="number">0xE4</span>, <span class="number">0x9A</span>, <span class="number">0x62</span>, <span class="number">0xE1</span>, <span class="number">0x9B</span>, <span class="number">0x1D</span>, <span class="number">0x63</span>, <span class="number">0x10</span>, <span class="number">0x84</span>, <span class="number">0x74</span>, <span class="number">0xC0</span>, <span class="number">0xDC</span>, <span class="number">0x15</span>, <span class="number">0x49</span>, <span class="number">0x7D</span>, <span class="number">0x4B</span>, <span class="number">0xCB</span>, <span class="number">0xFB</span>, <span class="number">0x16</span>, <span class="number">0xB</span>, <span class="number">0x56</span>, <span class="number">0x2D</span>, <span class="number">0xA1</span>, <span class="number">0xE7</span>, <span class="number">0x34</span>, <span class="number">0x27</span>, <span class="number">0x86</span>, <span class="number">0xEE</span>, <span class="number">0xA</span>, <span class="number">0xC2</span>, <span class="number">0xCF</span>, <span class="number">0x50</span>, <span class="number">0xC6</span>, <span class="number">0x55</span>, <span class="number">0x9D</span>, <span class="number">0xD4</span>, <span class="number">0x61</span>, <span class="number">0x8F</span>, <span class="number">0x41</span>, <span class="number">0xC9</span>, <span class="number">0xD5</span>, <span class="number">0x94</span>, <span class="number">0xBB</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0x8E</span>, <span class="number">0x92</span>, <span class="number">0xBA</span>, <span class="number">0x68</span>, <span class="number">0xE8</span>, <span class="number">0xA3</span>, <span class="number">0x25</span>, <span class="number">0x3A</span>, <span class="number">0x7F</span>, <span class="number">0xD9</span>, <span class="number">0xBF</span>, <span class="number">0xA5</span>, <span class="number">0x5B</span>, <span class="number">0x14</span>, <span class="number">0xDF</span>, <span class="number">0xFD</span>, <span class="number">0x37</span>, <span class="number">0x44</span>, <span class="number">0x23</span>, <span class="number">0xD6</span>, <span class="number">0x83</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xD7</span>, <span class="number">0x7E</span>, <span class="number">0x5C</span>, <span class="number">0x6A</span>, <span class="number">0x3D</span>, <span class="number">0xB8</span>, <span class="number">0xF0</span>, <span class="number">0xE3</span>, <span class="number">0x7B</span>, <span class="number">0x28</span>, <span class="number">0xC</span>, <span class="number">0xD2</span>, <span class="number">0xCA</span>, <span class="number">0xB6</span>, <span class="number">0xC4</span>, <span class="number">0x43</span>, <span class="number">0x22</span>, <span class="number">0x82</span>, <span class="number">0x3</span>, <span class="number">0xF6</span>, <span class="number">0x7</span>, <span class="number">0xFA</span>, <span class="number">0x97</span>, <span class="number">0x21</span>, <span class="number">0x90</span>, <span class="number">0x6B</span>, <span class="number">0x4E</span>, <span class="number">0xA4</span>, <span class="number">0xAB</span>, <span class="number">0x93</span>, <span class="number">0x67</span>, <span class="number">0xF4</span>, <span class="number">0x71</span>, <span class="number">0x38</span>, <span class="number">0xF7</span>, <span class="number">0x3B</span>, <span class="number">0x69</span>, <span class="number">0x2E</span>, <span class="number">0x4F</span>, <span class="number">0xB5</span>, <span class="number">0xB9</span>, <span class="number">0x2B</span>, <span class="number">0x8A</span>, <span class="number">0x36</span>, <span class="number">0x91</span>, <span class="number">0x73</span>, <span class="number">0x4</span>, <span class="number">0x42</span>, <span class="number">0xD5</span>, <span class="number">0x18</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0xEF</span>, <span class="number">0x12</span>, <span class="number">0x8B</span>, <span class="number">0x67</span>, <span class="number">0x29</span>, <span class="number">0x50</span>, <span class="number">0x46</span>, <span class="number">0x17</span>, <span class="number">0xB9</span>, <span class="number">0x9</span>, <span class="number">0x24</span>, <span class="number">0x9E</span>, <span class="number">0xFC</span>, <span class="number">0xF0</span>, <span class="number">0x9E</span>, <span class="number">0xE4</span>, <span class="number">0x52</span>, <span class="number">0xB7</span>, <span class="number">0x2E</span>, <span class="number">0xC7</span>, <span class="number">0x2F</span>, <span class="number">0xD1</span>, <span class="number">0x7</span>, <span class="number">0x2</span>, <span class="number">0x6F</span>, <span class="number">0x7D</span>, <span class="number">0x3</span>, <span class="number">0x53</span>, <span class="number">0xEA</span>, <span class="number">0x0</span>, <span class="number">0xDD</span>, <span class="number">0xDD</span>, <span class="number">0x49</span>, <span class="number">0x31</span>, <span class="number">0xA0</span>, <span class="number">0xCB</span>, <span class="number">0x18</span>, <span class="number">0x3B</span>, <span class="number">0x5F</span>, <span class="number">0x36</span>, <span class="number">0x1C</span>, <span class="number">0x9F</span>, <span class="number">0x27</span>, <span class="number">0x48</span>, <span class="number">0xE6</span>, <span class="number">0x78</span>, <span class="number">0x32</span>, <span class="number">0xA2</span>, <span class="number">0xA8</span>, <span class="number">0x3</span>, <span class="number">0x5D</span>, <span class="number">0xFC</span>, <span class="number">0x48</span>, <span class="number">0x5E</span>, <span class="number">0xDC</span>, <span class="number">0xB</span>, <span class="number">0xB3</span>, <span class="number">0x90</span>, <span class="number">0x2D</span>, <span class="number">0xA8</span>, <span class="number">0x74</span>, <span class="number">0xCA</span>, <span class="number">0x4A</span>, <span class="number">0x2E</span>, <span class="number">0x85</span>, <span class="number">0xED</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x64</span>, <span class="number">0x4B</span>, <span class="number">0x4B</span>, <span class="number">0x1C</span>, <span class="number">0x6A</span>, <span class="number">0xB2</span>, <span class="number">0xF2</span>, <span class="number">0xDA</span>, <span class="number">0x59</span>, <span class="number">0xA7</span>, <span class="number">0x13</span>, <span class="number">0xB9</span>, <span class="number">0x34</span>, <span class="number">0xEF</span>, <span class="number">0xEE</span>, <span class="number">0x4B</span>, <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0xB9</span>, <span class="number">0x40</span>, <span class="number">0xB6</span>, <span class="number">0xA5</span>, <span class="number">0x93</span>, <span class="number">0x89</span>, <span class="number">0x9A</span>, <span class="number">0xFF</span>, <span class="number">0xB9</span>, <span class="number">0xBD</span>, <span class="number">0x4A</span>, <span class="number">0x4B</span>, <span class="number">0xFC</span>, <span class="number">0xBB</span>, <span class="number">0x38</span>, <span class="number">0x8</span>, <span class="number">0x73</span>, <span class="number">0x91</span>, <span class="number">0x4C</span>, <span class="number">0x4B</span>, <span class="number">0x6D</span>, <span class="number">0x9C</span>, <span class="number">0x7C</span>, <span class="number">0x3</span>, <span class="number">0xA9</span>, <span class="number">0xF1</span>, <span class="number">0x9D</span>, <span class="number">0x82</span>, <span class="number">0xCA</span>, <span class="number">0xFC</span>, <span class="number">0x78</span>, <span class="number">0x39</span>, <span class="number">0x5</span>, <span class="number">0x67</span>, <span class="number">0x21</span>, <span class="number">0xC3</span>, <span class="number">0x1D</span>, <span class="number">0x3D</span>, <span class="number">0x84</span>, <span class="number">0x26</span>, <span class="number">0x91</span>, <span class="number">0x50</span>, <span class="number">0x41</span>, <span class="number">0x55</span>, <span class="number">0x14</span>, <span class="number">0xD8</span>, <span class="number">0xBA</span>, <span class="number">0xF9</span>, <span class="number">0x3D</span>, <span class="number">0x5C</span>, <span class="number">0x69</span>, <span class="number">0x70</span>, <span class="number">0x80</span>, <span class="number">0xD6</span>, <span class="number">0x78</span>, <span class="number">0x16</span>, <span class="number">0x5D</span>, <span class="number">0x12</span>, <span class="number">0x8B</span>, <span class="number">0xC4</span>, <span class="number">0xD7</span>, <span class="number">0x57</span>, <span class="number">0xE1</span>, <span class="number">0x97</span>, <span class="number">0x28</span>, <span class="number">0x49</span>, <span class="number">0x9B</span>, <span class="number">0xF3</span>, <span class="number">0xB3</span>, <span class="number">0xE</span>, <span class="number">0x5B</span>, <span class="number">0xC7</span>, <span class="number">0x3A</span>, <span class="number">0xB0</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x51</span>, <span class="number">0xC2</span>, <span class="number">0x12</span>, <span class="number">0xA6</span>, <span class="number">0x12</span>, <span class="number">0x47</span>, <span class="number">0x6B</span>, <span class="number">0x2C</span>, <span class="number">0x13</span>, <span class="number">0xCF</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x95</span>, <span class="number">0xE3</span>, <span class="number">0xA8</span>, <span class="number">0xBE</span>, <span class="number">0xFE</span>, <span class="number">0xA3</span>, <span class="number">0xB3</span>, <span class="number">0xF5</span>, <span class="number">0x8A</span>, <span class="number">0xAE</span>, <span class="number">0xCD</span>, <span class="number">0x3C</span>, <span class="number">0x3D</span>, <span class="number">0x42</span>, <span class="number">0x47</span>, <span class="number">0x6A</span>, <span class="number">0x1C</span>, <span class="number">0xA5</span>, <span class="number">0x63</span>, <span class="number">0x8A</span>, <span class="number">0x9C</span>, <span class="number">0xC3</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x5B</span>, <span class="number">0x18</span>, <span class="number">0xF7</span>, <span class="number">0x84</span>, <span class="number">0xE</span>, <span class="number">0xD0</span>, <span class="number">0x99</span>, <span class="number">0x7F</span>, <span class="number">0xBA</span>, <span class="number">0x2D</span>, <span class="number">0x99</span>, <span class="number">0x77</span>, <span class="number">0x28</span>, <span class="number">0x2A</span>, <span class="number">0x19</span>, <span class="number">0xDC</span>, <span class="number">0x93</span>, <span class="number">0x5E</span>, <span class="number">0x5E</span>, <span class="number">0xA6</span>, <span class="number">0xA3</span>, <span class="number">0x22</span>, <span class="number">0x6F</span>, <span class="number">0x98</span>, <span class="number">0x9F</span>, <span class="number">0xF6</span>, <span class="number">0xDF</span>, <span class="number">0xC6</span>, <span class="number">0xDE</span>, <span class="number">0x21</span>, <span class="number">0xE7</span>, <span class="number">0x55</span>, <span class="number">0x7E</span>, <span class="number">0x98</span>, <span class="number">0xB8</span>, <span class="number">0x82</span>, <span class="number">0x59</span>, <span class="number">0x21</span>, <span class="number">0xE</span>, <span class="number">0xE5</span>, <span class="number">0x35</span>, <span class="number">0xB8</span>, <span class="number">0x9</span>, <span class="number">0xF7</span>, <span class="number">0x3B</span>, <span class="number">0x32</span>, <span class="number">0x39</span>, <span class="number">0xD3</span>, <span class="number">0xAB</span>, <span class="number">0x20</span>, <span class="number">0xF7</span>, <span class="number">0x39</span>, <span class="number">0xCD</span>, <span class="number">0xF6</span>, <span class="number">0xFC</span>, <span class="number">0xD8</span>, <span class="number">0x2B</span>, <span class="number">0x6D</span>, <span class="number">0x2C</span>, <span class="number">0xCD</span>, <span class="number">0xFD</span>, <span class="number">0x25</span>, <span class="number">0xB3</span>, <span class="number">0x67</span>, <span class="number">0xE5</span>, <span class="number">0x8F</span>, <span class="number">0x53</span>, <span class="number">0x2D</span>, <span class="number">0xDC</span>, <span class="number">0xA</span>, <span class="number">0xFC</span>, <span class="number">0x22</span>, <span class="number">0x6C</span>, <span class="number">0x4C</span>, <span class="number">0x9E</span>, <span class="number">0x47</span>, <span class="number">0x21</span>, <span class="number">0x4</span>, <span class="number">0x3B</span>, <span class="number">0x62</span>, <span class="number">0x3A</span>, <span class="number">0xBD</span>, <span class="number">0x40</span>, <span class="number">0xFE</span>, <span class="number">0xA3</span>, <span class="number">0x6</span>, <span class="number">0x15</span>, <span class="number">0xB3</span>, <span class="number">0x28</span>, <span class="number">0xD0</span>, <span class="number">0xF3</span>, <span class="number">0xA7</span>, <span class="number">0xE3</span>, <span class="number">0x17</span>, <span class="number">0xF6</span>, <span class="number">0x55</span>, <span class="number">0xF6</span>, <span class="number">0xC5</span>, <span class="number">0x73</span>, <span class="number">0x8D</span>, <span class="number">0x80</span>, <span class="number">0xD3</span>, <span class="number">0x8B</span>, <span class="number">0xBC</span>, <span class="number">0xC9</span>, <span class="number">0xB1</span>, <span class="number">0x0</span>, <span class="number">0x6E</span>, <span class="number">0xC0</span>, <span class="number">0xE8</span>, <span class="number">0x48</span>, <span class="number">0x11</span>, <span class="number">0xA8</span>, <span class="number">0xFE</span>, <span class="number">0xE0</span>, <span class="number">0xFC</span>, <span class="number">0xE</span>, <span class="number">0x99</span>, <span class="number">0xE3</span>, <span class="number">0xB0</span>, <span class="number">0xFE</span>, <span class="number">0xE8</span>, <span class="number">0xDB</span>, <span class="number">0x5D</span>, <span class="number">0x76</span>, <span class="number">0x3F</span>, <span class="number">0xD7</span>, <span class="number">0xA8</span>, <span class="number">0x1B</span>, <span class="number">0x1</span>, <span class="number">0xBE</span>, <span class="number">0xAB</span>, <span class="number">0x2B</span>, <span class="number">0xC3</span>, <span class="number">0xE2</span>, <span class="number">0x3D</span>, <span class="number">0xB3</span>, <span class="number">0xAE</span>, <span class="number">0xD8</span>, <span class="number">0x74</span>, <span class="number">0x2</span>, <span class="number">0x25</span>, <span class="number">0x88</span>, <span class="number">0x69</span>, <span class="number">0x5D</span>, <span class="number">0xA8</span>, <span class="number">0x80</span>, <span class="number">0x3B</span>, <span class="number">0xF4</span>, <span class="number">0xF9</span>, <span class="number">0x8E</span>, <span class="number">0x57</span>, <span class="number">0x15</span>, <span class="number">0x7D</span>, <span class="number">0x8D</span>, <span class="number">0xF6</span>, <span class="number">0xA0</span>, <span class="number">0xE4</span>, <span class="number">0x7F</span>, <span class="number">0xE7</span>, <span class="number">0xBB</span>, <span class="number">0xD</span>, <span class="number">0xDC</span>, <span class="number">0x8E</span>, <span class="number">0xC6</span>, <span class="number">0x23</span>, <span class="number">0x2A</span>, <span class="number">0x2D</span>, <span class="number">0x92</span>, <span class="number">0xD</span>, <span class="number">0xCE</span>, <span class="number">0x62</span>, <span class="number">0xCD</span>, <span class="number">0x5</span>, <span class="number">0x22</span>, <span class="number">0xF1</span>, <span class="number">0xC1</span>, <span class="number">0x86</span>, <span class="number">0xC7</span>, <span class="number">0xC4</span>, <span class="number">0x3F</span>, <span class="number">0x6C</span>, <span class="number">0x3D</span>, <span class="number">0x30</span>, <span class="number">0xD5</span>, <span class="number">0x57</span>, <span class="number">0xB0</span>, <span class="number">0x7A</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x15</span>, <span class="number">0x9A</span>, <span class="number">0x3D</span>, <span class="number">0xAF</span>, <span class="number">0x76</span>, <span class="number">0x3E</span>, <span class="number">0x3A</span>, <span class="number">0x3B</span>, <span class="number">0x8A</span>, <span class="number">0x12</span>, <span class="number">0xCD</span>, <span class="number">0x94</span>, <span class="number">0x89</span>, <span class="number">0x3F</span>, <span class="number">0xB</span>, <span class="number">0xCE</span>, <span class="number">0x3E</span>, <span class="number">0x31</span>, <span class="number">0x3C</span>, <span class="number">0x5F</span>, <span class="number">0x5E</span>, <span class="number">0x9E</span>, <span class="number">0xD5</span>, <span class="number">0x3B</span>, <span class="number">0x18</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x3D</span>, <span class="number">0xED</span>, <span class="number">0xF2</span>, <span class="number">0x55</span>, <span class="number">0xC9</span>, <span class="number">0xC2</span>, <span class="number">0x49</span>, <span class="number">0xB</span>, <span class="number">0xB0</span>, <span class="number">0x34</span>, <span class="number">0xC4</span>, <span class="number">0x6D</span>, <span class="number">0x53</span>, <span class="number">0x2B</span>, <span class="number">0x76</span>, <span class="number">0xCE</span>, <span class="number">0xC</span>, <span class="number">0xB2</span>, <span class="number">0x13</span>, <span class="number">0xA3</span>, <span class="number">0xC9</span>, <span class="number">0x6</span>, <span class="number">0xB2</span>, <span class="number">0x37</span>, <span class="number">0xFA</span>, <span class="number">0xEC</span>, <span class="number">0xD1</span>, <span class="number">0xA0</span>, <span class="number">0xAE</span>, <span class="number">0x48</span>, <span class="number">0x9A</span>, <span class="number">0xF1</span>, <span class="number">0xF8</span>, <span class="number">0xEC</span>, <span class="number">0x65</span>, <span class="number">0xB1</span>, <span class="number">0x98</span>, <span class="number">0xAE</span>, <span class="number">0x7D</span>, <span class="number">0x8C</span>, <span class="number">0xD7</span>, <span class="number">0xBD</span>, <span class="number">0x27</span>, <span class="number">0x49</span>, <span class="number">0xB3</span>, <span class="number">0x35</span>, <span class="number">0xE0</span>, <span class="number">0xFC</span>, <span class="number">0x3C</span>, <span class="number">0xF0</span>, <span class="number">0xE7</span>, <span class="number">0x7D</span>, <span class="number">0x3E</span>, <span class="number">0xA0</span>, <span class="number">0xFB</span>, <span class="number">0x18</span>, <span class="number">0x20</span>, <span class="number">0x1A</span>, <span class="number">0x66</span>, <span class="number">0x86</span>, <span class="number">0xC</span>, <span class="number">0xF5</span>, <span class="number">0x3A</span>, <span class="number">0x1C</span>, <span class="number">0x51</span>, <span class="number">0x54</span>, <span class="number">0xDB</span>, <span class="number">0x43</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0xBD</span>, <span class="number">0x28</span>, <span class="number">0xEE</span>, <span class="number">0xBA</span>, <span class="number">0x6F</span>, <span class="number">0xB5</span>, <span class="number">0xA3</span>, <span class="number">0xCF</span>, <span class="number">0xD9</span>, <span class="number">0xBF</span>, <span class="number">0xEE</span>, <span class="number">0xEC</span>, <span class="number">0xC2</span>, <span class="number">0x81</span>, <span class="number">0x75</span>, <span class="number">0x34</span>, <span class="number">0x95</span>, <span class="number">0x49</span>, <span class="number">0x99</span>, <span class="number">0x90</span>, <span class="number">0x64</span>, <span class="number">0x71</span>][<span class="number">0x100</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(<span class="built_in">set</span>(table)) == <span class="number">256</span></span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0x0</span>, <span class="number">0x1D</span>, <span class="number">0x3B</span>, <span class="number">0x29</span>, <span class="number">0x70</span>, <span class="number">0x12</span>, <span class="number">0x69</span>, <span class="number">0xB7</span>, <span class="number">0x6C</span>, <span class="number">0xF</span>, <span class="number">0x4D</span>, <span class="number">0x5C</span>, <span class="number">0x9F</span>, <span class="number">0x5B</span>, <span class="number">0x6C</span>, <span class="number">0x1B</span>, <span class="number">0xB5</span>, <span class="number">0x47</span>, <span class="number">0xA2</span>, <span class="number">0x28</span>, <span class="number">0xC0</span>, <span class="number">0xF8</span>, <span class="number">0xDC</span>, <span class="number">0xE0</span>, <span class="number">0x7A</span>, <span class="number">0xF8</span>, <span class="number">0xD6</span>, <span class="number">0x28</span>, <span class="number">0xF6</span>, <span class="number">0xF8</span>, <span class="number">0x93</span>, <span class="number">0xb3</span>]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x4B</span>, <span class="number">0xC</span>, <span class="number">0x54</span>, <span class="number">0xF</span>, <span class="number">0x32</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x35</span>]</span><br><span class="line"></span><br><span class="line">enc[<span class="number">0</span>] ^= key[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(enc[<span class="number">0</span>]), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">enc = enc[<span class="number">1</span>:]</span><br><span class="line">key = key[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">114514</span>):</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc) - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> idx &amp; <span class="number">1</span>:</span><br><span class="line">            enc[idx] ^= enc[idx - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            enc[idx] = table.index(enc[idx])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(key):</span><br><span class="line">    enc[<span class="number">3</span> + <span class="number">4</span> * i] ^= b</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(enc).decode(<span class="string">&#x27;GBK&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>需要注意的是用<code>chr</code>输出最后的字符会发现有乱码, 但是密文的解密有互相依赖性, 不可能某一部分成功解密而其他不行, 结合这是易语言写的程序, 大概率是中文编码, 结果还真是.</p>
<h2 id="第七题"><a href="#第七题" class="headerlink" title="第七题"></a>第七题</h2><p>题目为了混淆用<code>string_to_code(buf)</code>替换了很多立即数, 实际上<code>string_to_code</code>就是一个map, 用以下patcher可以美化一下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span> GetDisasm, patch_byte</span><br><span class="line"><span class="keyword">from</span> ida_ua <span class="keyword">import</span> insn_t, decode_insn</span><br><span class="line"><span class="keyword">from</span> keystone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ks = Ks(KS_ARCH_X86, KS_MODE_32)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">patch_bytes</span>(<span class="params">address, new_bytes</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Patch the bytes at the given address with the new bytes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(new_bytes):</span><br><span class="line">        patch_byte(address + i, byte)</span><br><span class="line"></span><br><span class="line">start = <span class="number">0x0804888F</span></span><br><span class="line">end   = <span class="number">0x08049461</span></span><br><span class="line"></span><br><span class="line">mapping = &#123;</span><br><span class="line">        <span class="string">&quot;act&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;abort&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;con&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;cancel&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;enable&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;reset&quot;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&quot;start&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;stop&quot;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;run&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;reboot&quot;</span>: <span class="number">4</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">_       = insn_t()</span><br><span class="line"><span class="keyword">while</span> start &lt;= end:</span><br><span class="line">    disasm = GetDisasm(start)</span><br><span class="line">    length = decode_insn(_, start)</span><br><span class="line">    <span class="keyword">if</span> disasm == <span class="string">&#x27;call    string_to_code&#x27;</span>:</span><br><span class="line">        key = GetDisasm(start - <span class="number">7</span>).split()[-<span class="number">1</span>].strip().strip(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(f&quot;Found &#123;key&#125; at &#123;hex(start - 7)&#125;&quot;)</span></span><br><span class="line">        new_code = <span class="string">f&quot;mov eax, <span class="subst">&#123;mapping[key]&#125;</span>&quot;</span></span><br><span class="line">        asm_code = <span class="built_in">bytes</span>(ks.asm(new_code)[<span class="number">0</span>]).ljust(<span class="number">12</span>, <span class="string">b&#x27;\x90&#x27;</span>)</span><br><span class="line">        patch_bytes(start - <span class="number">7</span>, asm_code)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Patched <span class="subst">&#123;<span class="built_in">hex</span>(start)&#125;</span> with <span class="subst">&#123;asm_code&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    start += length</span><br></pre></td></tr></table></figure>

<p>程序第一步是将输入的前10字节从十六进制字符转成数字, 然后通过这些<code>hexnum</code>初始化了两个矩阵:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">idx1 = <span class="number">0</span>;</span><br><span class="line">idx2 = <span class="number">0</span>;</span><br><span class="line">idx3 = <span class="number">0</span>;</span><br><span class="line">idx4 = <span class="number">0</span>;</span><br><span class="line">idx5 = <span class="number">0</span>;</span><br><span class="line">idx6 = <span class="number">0</span>;</span><br><span class="line">cns2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">4</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i || j != <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( i != <span class="number">1</span> || j )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( i == <span class="number">1</span> &amp;&amp; j == <span class="number">2</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          m1[i][<span class="number">2</span>] = hexnum[idx1++];</span><br><span class="line">          m2[<span class="number">0</span>][idx2++] = m1[i][j];</span><br><span class="line">          m2[<span class="number">2</span>][idx4++] = m1[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( i == <span class="number">2</span> &amp;&amp; j == <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          m1[i][<span class="number">1</span>] = hexnum[idx1++];</span><br><span class="line">          m2[<span class="number">0</span>][idx2++] = m1[i][j];</span><br><span class="line">          m2[<span class="number">1</span>][idx3++] = m1[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( i == <span class="number">2</span> &amp;&amp; j == <span class="number">3</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          m1[i][<span class="number">3</span>] = hexnum[idx1++];</span><br><span class="line">          m2[<span class="number">2</span>][idx4++] = m1[i][j];</span><br><span class="line">          m2[<span class="number">3</span>][idx5++] = m1[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( i != <span class="number">3</span> || j )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( i == <span class="number">3</span> &amp;&amp; j == <span class="number">2</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            m1[i][<span class="number">2</span>] = hexnum[idx1++];</span><br><span class="line">            m2[<span class="number">1</span>][idx3++] = m1[i][j];</span><br><span class="line">            m2[<span class="number">4</span>][idx6++] = m1[i][j];</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> ( i == <span class="number">3</span> &amp;&amp; j == <span class="number">3</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            m1[i][<span class="number">3</span>] = hexnum[idx1++];</span><br><span class="line">            m2[<span class="number">3</span>][idx5++] = m1[i][j];</span><br><span class="line">            m2[<span class="number">4</span>][idx6++] = m1[i][j];</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> ( i == <span class="number">3</span> &amp;&amp; j == <span class="number">4</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            m1[i][<span class="number">4</span>] = hexnum[idx1++];</span><br><span class="line">            m2[<span class="number">2</span>][idx4++] = m1[i][j];</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> ( i == <span class="number">4</span> &amp;&amp; j == <span class="number">2</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            m1[i][<span class="number">2</span>] = hexnum[idx1++];</span><br><span class="line">            m2[<span class="number">3</span>][idx5++] = m1[i][j];</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            m1[i][j] = i + j;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          m1[i][<span class="number">0</span>] = hexnum[idx1++];</span><br><span class="line">          m2[<span class="number">4</span>][idx6++] = m1[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        m1[i][<span class="number">0</span>] = hexnum[idx1++];</span><br><span class="line">        m2[<span class="number">1</span>][idx3++] = m1[i][j];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      m1[i][<span class="number">3</span>] = hexnum[idx1++];</span><br><span class="line">      m2[<span class="number">0</span>][idx2++] = m1[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( i == <span class="number">4</span> )</span><br><span class="line">      cns2 += m1[<span class="number">4</span>][j];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( stat(<span class="string">&quot;/etc/rc.d&quot;</span>, (<span class="keyword">struct</span> stat *)buf) )</span><br><span class="line">    cns2 += m2[i][j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后判断了一些条件后检验输入的11~14字节是否满足某些条件, 一眼丁真出<code>asas</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">cns1 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  n19 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">2</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    n19 += m2[i][j];</span><br><span class="line">    n19 -= <span class="number">5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( n19 != <span class="number">19</span> )</span><br><span class="line">    cns1 = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">v22 = open(<span class="string">&quot;/proc/self/as&quot;</span>, (<span class="type">int</span>)<span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v22 == <span class="number">-1</span> )</span><br><span class="line">  ++cns2;</span><br><span class="line"><span class="keyword">if</span> ( devctl(v22, <span class="number">0x41100801</span>, s, <span class="number">272</span>, <span class="number">0</span>) )</span><br><span class="line">  ++cns2;</span><br><span class="line"><span class="keyword">if</span> ( cns2 != m1[<span class="number">0</span>][<span class="number">0</span>] + m1[<span class="number">0</span>][<span class="number">3</span>] * m1[<span class="number">0</span>][<span class="number">2</span>] * m1[<span class="number">0</span>][<span class="number">1</span>] * m1[<span class="number">0</span>][<span class="number">4</span>] + (s[<span class="number">8</span>] &amp; <span class="number">0x80</span>) - <span class="number">34</span> )</span><br><span class="line">  cns1 = <span class="number">0</span>;</span><br><span class="line">sm = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">10</span>] == <span class="number">97</span> )                      <span class="comment">// asas</span></span><br><span class="line">  sm += <span class="number">45</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">10</span>] == <span class="number">115</span> )</span><br><span class="line">  sm -= <span class="number">45</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">11</span>] == <span class="number">97</span> )</span><br><span class="line">  sm += <span class="number">67</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">11</span>] == <span class="number">115</span> )</span><br><span class="line">  sm -= <span class="number">67</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">12</span>] == <span class="number">97</span> )</span><br><span class="line">  sm += <span class="number">8</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">12</span>] == <span class="number">115</span> )</span><br><span class="line">  sm -= <span class="number">8</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">13</span>] == <span class="number">97</span> )</span><br><span class="line">  sm += <span class="number">9</span>;</span><br><span class="line"><span class="keyword">if</span> ( input[<span class="number">13</span>] == <span class="number">115</span> )</span><br><span class="line">  sm -= <span class="number">9</span>;</span><br><span class="line"><span class="keyword">if</span> ( sm != <span class="number">100</span> )</span><br><span class="line">  cns1 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( cns1 == <span class="number">1</span> &amp;&amp; <span class="built_in">strlen</span>(input) &lt;= <span class="number">0xE</span> )</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>写个z3就能解出符合条件的14字节输入了:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ans = [BitVec(<span class="string">&#x27;ans_%d&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    s.add(And(ans[i] &gt;= <span class="number">0</span>, ans[i] &lt;= <span class="number">0xf</span>))</span><br><span class="line"></span><br><span class="line">idx1 = <span class="number">0</span></span><br><span class="line">idx2 = <span class="number">0</span></span><br><span class="line">idx3 = <span class="number">0</span></span><br><span class="line">idx4 = <span class="number">0</span></span><br><span class="line">idx5 = <span class="number">0</span></span><br><span class="line">idx6 = <span class="number">0</span></span><br><span class="line">cns2 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">m1 = [[<span class="number">0</span>] * <span class="number">5</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">m2 = [[<span class="number">0</span>] * <span class="number">3</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">emulate:</span></span><br><span class="line"><span class="string">    for ( i = 0; i &lt;= 4; ++i )</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      for ( j = 0; j &lt;= 4; ++j )</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        if ( i || j != 3 )</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          if ( i != 1 || j )</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            if ( i == 1 &amp;&amp; j == 2 )</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              m1[i][2] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">              m2[0][idx2++] = m1[i][j];</span></span><br><span class="line"><span class="string">              m2[2][idx4++] = m1[i][j];</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            else if ( i == 2 &amp;&amp; j == 1 )</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              m1[i][1] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">              m2[0][idx2++] = m1[i][j];</span></span><br><span class="line"><span class="string">              m2[1][idx3++] = m1[i][j];</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            else if ( i == 2 &amp;&amp; j == 3 )</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              m1[i][3] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">              m2[2][idx4++] = m1[i][j];</span></span><br><span class="line"><span class="string">              m2[3][idx5++] = m1[i][j];</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            else if ( i != 3 || j )</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              if ( i == 3 &amp;&amp; j == 2 )</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                m1[i][2] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">                m2[1][idx3++] = m1[i][j];</span></span><br><span class="line"><span class="string">                m2[4][idx6++] = m1[i][j];</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">              else if ( i == 3 &amp;&amp; j == 3 )</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                m1[i][3] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">                m2[3][idx5++] = m1[i][j];</span></span><br><span class="line"><span class="string">                m2[4][idx6++] = m1[i][j];</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">              else if ( i == 3 &amp;&amp; j == 4 )</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                m1[i][4] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">                m2[2][idx4++] = m1[i][j];</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">              else if ( i == 4 &amp;&amp; j == 2 )</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                m1[i][2] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">                m2[3][idx5++] = m1[i][j];</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">              else</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                m1[i][j] = i + j;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            else</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              m1[i][0] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">              m2[4][idx6++] = m1[i][j];</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          else</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            m1[i][0] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">            m2[1][idx3++] = m1[i][j];</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          m1[i][3] = hexnum[idx1++];</span></span><br><span class="line"><span class="string">          m2[0][idx2++] = m1[i][j];</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        if ( i == 4 )</span></span><br><span class="line"><span class="string">          cns2 += m1[4][j];</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if ( stat(&quot;/etc/rc.d&quot;, (struct stat *)buf) )</span></span><br><span class="line"><span class="string">        cns2 += m2[i][j];</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">or</span> j != <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">1</span> <span class="keyword">or</span> j:</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">1</span> <span class="keyword">and</span> j == <span class="number">2</span>:</span><br><span class="line">                    m1[i][<span class="number">2</span>] = ans[idx1]</span><br><span class="line">                    m2[<span class="number">0</span>][idx2] = m1[i][j]</span><br><span class="line">                    m2[<span class="number">2</span>][idx4] = m1[i][j]</span><br><span class="line">                    idx1 += <span class="number">1</span></span><br><span class="line">                    idx2 += <span class="number">1</span></span><br><span class="line">                    idx4 += <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> i == <span class="number">2</span> <span class="keyword">and</span> j == <span class="number">1</span>:</span><br><span class="line">                    m1[i][<span class="number">1</span>] = ans[idx1]</span><br><span class="line">                    m2[<span class="number">0</span>][idx2] = m1[i][j]</span><br><span class="line">                    m2[<span class="number">1</span>][idx3] = m1[i][j]</span><br><span class="line">                    idx1 += <span class="number">1</span></span><br><span class="line">                    idx2 += <span class="number">1</span></span><br><span class="line">                    idx3 += <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> i == <span class="number">2</span> <span class="keyword">and</span> j == <span class="number">3</span>:</span><br><span class="line">                    m1[i][<span class="number">3</span>] = ans[idx1]</span><br><span class="line">                    m2[<span class="number">2</span>][idx4] = m1[i][j]</span><br><span class="line">                    m2[<span class="number">3</span>][idx5] = m1[i][j]</span><br><span class="line">                    idx1 += <span class="number">1</span></span><br><span class="line">                    idx4 += <span class="number">1</span></span><br><span class="line">                    idx5 += <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> i != <span class="number">3</span> <span class="keyword">or</span> j:</span><br><span class="line">                    <span class="keyword">if</span> i == <span class="number">3</span> <span class="keyword">and</span> j == <span class="number">2</span>:</span><br><span class="line">                        m1[i][<span class="number">2</span>] = ans[idx1]</span><br><span class="line">                        m2[<span class="number">1</span>][idx3] = m1[i][j]</span><br><span class="line">                        m2[<span class="number">4</span>][idx6] = m1[i][j]</span><br><span class="line">                        idx1 += <span class="number">1</span></span><br><span class="line">                        idx3 += <span class="number">1</span></span><br><span class="line">                        idx6 += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">elif</span> i == <span class="number">3</span> <span class="keyword">and</span> j == <span class="number">3</span>:</span><br><span class="line">                        m1[i][<span class="number">3</span>] = ans[idx1]</span><br><span class="line">                        m2[<span class="number">3</span>][idx5] = m1[i][j]</span><br><span class="line">                        m2[<span class="number">4</span>][idx6] = m1[i][j]</span><br><span class="line">                        idx1 += <span class="number">1</span></span><br><span class="line">                        idx5 += <span class="number">1</span></span><br><span class="line">                        idx6 += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">elif</span> i == <span class="number">3</span> <span class="keyword">and</span> j == <span class="number">4</span>:</span><br><span class="line">                        m1[i][<span class="number">4</span>] = ans[idx1]</span><br><span class="line">                        m2[<span class="number">2</span>][idx4] = m1[i][j]</span><br><span class="line">                        idx1 += <span class="number">1</span></span><br><span class="line">                        idx4 += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">elif</span> i == <span class="number">4</span> <span class="keyword">and</span> j == <span class="number">2</span>:</span><br><span class="line">                        m1[i][<span class="number">2</span>] = ans[idx1]</span><br><span class="line">                        m2[<span class="number">3</span>][idx5] = m1[i][j]</span><br><span class="line">                        idx1 += <span class="number">1</span></span><br><span class="line">                        idx5 += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        m1[i][j] = i + j</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    m1[i][<span class="number">0</span>] = ans[idx1]</span><br><span class="line">                    m2[<span class="number">4</span>][idx6] = m1[i][j]</span><br><span class="line">                    idx1 += <span class="number">1</span></span><br><span class="line">                    idx6 += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                m1[i][<span class="number">0</span>] = ans[idx1]</span><br><span class="line">                m2[<span class="number">1</span>][idx3] = m1[i][j]</span><br><span class="line">                idx1 += <span class="number">1</span></span><br><span class="line">                idx3 += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m1[i][<span class="number">3</span>] = ans[idx1]</span><br><span class="line">            m2[<span class="number">0</span>][idx2] = m1[i][j]</span><br><span class="line">            idx1 += <span class="number">1</span></span><br><span class="line">            idx2 += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">            cns2 += m1[<span class="number">4</span>][j]</span><br><span class="line">    <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">        cns2 += m2[i][j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    sm = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        sm += m2[i][j]</span><br><span class="line">        sm -= <span class="number">5</span></span><br><span class="line">    s.add(sm == <span class="number">19</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">    cns2 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">    cns2 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">s.add(cns2 == m1[<span class="number">0</span>][<span class="number">0</span>] + m1[<span class="number">0</span>][<span class="number">3</span>] * m1[<span class="number">0</span>][<span class="number">2</span>] * m1[<span class="number">0</span>][<span class="number">1</span>] * m1[<span class="number">0</span>][<span class="number">4</span>] + <span class="number">0</span> - <span class="number">34</span>)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="built_in">print</span>(count, <span class="string">&quot;&quot;</span>.join([<span class="string">f&quot;<span class="subst">&#123;m[a].as_long():1x&#125;</span>&quot;</span> <span class="keyword">for</span> a <span class="keyword">in</span> ans]) + <span class="string">&quot;asas&quot;</span>)</span><br><span class="line">    s.add(Or([a != m[a] <span class="keyword">for</span> a <span class="keyword">in</span> ans]))</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>坏消息是总共有400多个可行解, 这时候观察一血会发现他在一小时二十分左右提交了正确序列号, 如果他的python, z3版本和我相同并且是从头试到尾那么他应该是20分左右解出题目, 花了1个小时交序列号, 在第30~39个内大概率有正确序列号, 找到正确序列号在第31个:</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">30 9acdcfb8aeasas</span><br><span class="line">31 86bfd6dfa6asas</span><br><span class="line">32 8ebfde5fa6asas</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>下次出题的自己能不能验证一下有没有多解</p>
<h2 id="第八题"><a href="#第八题" class="headerlink" title="第八题"></a>第八题</h2><p><a target="_blank" rel="noopener" href="https://1k0ct.github.io/2025/09/09/%E8%AE%B0%E4%B8%80%E6%AC%A1VMPWN%E5%88%86%E6%9E%90/">记一次VMPWN分析</a></p>
<h2 id="第九题"><a href="#第九题" class="headerlink" title="第九题"></a>第九题</h2><p>DIE查出来一个Enigma Virtual Box壳, 直接放弃静态分析, 通过附加调试的方式进行动态分析</p>
<h3 id="定位主函数"><a href="#定位主函数" class="headerlink" title="定位主函数"></a>定位主函数</h3><p>输入SN前在IDA挂起线程, 然后输入后步出到用户领空为止:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-092530.png" alt="QQ_1756776323922"></p>
<p>查看RAX可以看到刚刚输入的SN字符串, 同时可以观察出程序使用的库底层储存字符串的逻辑:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-092820.png" alt="QQ_1756776499071"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">str</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">void</span> *nop;</span><br><span class="line">  _DWORD len;</span><br><span class="line">  _WORD s[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="对Name的处理"><a href="#对Name的处理" class="headerlink" title="对Name的处理"></a>对Name的处理</h3><p>程序先对Name进行了简单的hash, 最终结果存放在v8:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-093050.png" alt="QQ_1756776603933"></p>
<p>当输入的是公开序列号对应的Name时v8为55, 输入KCTF时v8为27</p>
<h3 id="对SN的处理"><a href="#对SN的处理" class="headerlink" title="对SN的处理"></a>对SN的处理</h3><h4 id="展开SN"><a href="#展开SN" class="headerlink" title="展开SN"></a>展开SN</h4><p>第一次用到SN在<code>main+12B</code>, 观察处理完的结果, 看到了大量重复的9, 结合序列号的格式, 大概率是<code>&#123;digit&#125;&#123;count&#125;l</code>的格式, 只是最后的<code>l</code>被省略, 而这里处理完的字符串因为太长是用类似链表的方式储存的, 偏移8, 10h, 18h的成员分别代表当前段, 上一段, 当前段的长度:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-093954.png" alt="QQ_1756777070979"></p>
<h4 id="除法运算"><a href="#除法运算" class="headerlink" title="除法运算"></a>除法运算</h4><p>下一次对SN的处理在<code>main+276</code>, 同时还用到了上面Name的hash, 它被以十进制字符串的形式储存起来了:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-094511.png" alt="QQ_1756777504285"></p>
<p>通过硬件断点跟踪数据流发现它和SN用空格拼接起来了:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-094740.png" alt="QQ_1756777620479"></p>
<p>步出至用户领空, 发现这个拼接的字符串上面还有一个路径字符串:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-094937.png" alt="QQ_1756777745414"></p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-095143.png" alt="QQ_1756777886003"></p>
<p>结合上面用空格拼接的字符串, 很有可能是当作命令行参数传给了这个释放出来的PE</p>
<p>找到这个PE, 发现是一个python打包程序, 解包反编译后得到以下py代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reciprocal</span>(<span class="params">m, n, prec</span>):</span><br><span class="line">    getcontext().prec = <span class="built_in">int</span>(prec)</span><br><span class="line">    result = Decimal(m) / Decimal(n)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">arg1, arg2, arg3</span>):</span><br><span class="line">    sys.set_int_max_str_digits(<span class="built_in">int</span>(arg3))</span><br><span class="line">    reciprocal_value = reciprocal(arg1, arg2, arg3)</span><br><span class="line">    <span class="built_in">print</span>(reciprocal_value)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    arg1 = sys.argv[<span class="number">1</span>]</span><br><span class="line">    arg2 = sys.argv[<span class="number">2</span>]</span><br><span class="line">    arg3 = sys.argv[<span class="number">3</span>]</span><br><span class="line">    main(arg1, arg2, arg3)</span><br></pre></td></tr></table></figure>

<p>和上面的想法差不多, 通过命令行参数进行了一个除法, 得到的是十进制字符串, 但是有3个命令行参数, 找到最后拼接的作为精度的参数:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F02%2F20250902-095539.png" alt="QQ_1756778121548"></p>
<p>实际上到这一步就不用分析下面的程序的, 因为程序给出了能通过校验的<code>55 / N1</code>的N1, 对应到KCTF的<code>27</code>, 只需要算出<code>27 / N2 = 27 / (N1 * 27 / 55) = 55 / N1</code>的N2即为正确答案:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line">prec = <span class="number">0x400000</span></span><br><span class="line">getcontext().prec = prec</span><br><span class="line">ser = <span class="string">&#x27;51l41l92022l51l01l41l92022l52l92023l71l21l51l&#x27;</span></span><br><span class="line">length = <span class="number">0</span></span><br><span class="line">num = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> seg <span class="keyword">in</span> ser.split(<span class="string">&#x27;l&#x27;</span>)[:-<span class="number">1</span>]:</span><br><span class="line">    digit = seg[<span class="number">0</span>]</span><br><span class="line">    count = <span class="built_in">int</span>(seg[<span class="number">1</span>:])</span><br><span class="line">    num += digit * count</span><br><span class="line">    length += count</span><br><span class="line"></span><br><span class="line">N2 = Decimal(<span class="string">&#x27;27&#x27;</span>) * Decimal(num) / Decimal(<span class="string">&#x27;55&#x27;</span>)</span><br><span class="line">getcontext().prec = length</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_repeat_format</span>(<span class="params">s</span>):</span><br><span class="line">    result = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">        digit = s[i]</span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i + count &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> s[i+count] == digit:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">        result.append(<span class="string">f&#x27;<span class="subst">&#123;digit&#125;</span><span class="subst">&#123;count&#125;</span>l&#x27;</span>)</span><br><span class="line">        i += count</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(to_repeat_format(<span class="built_in">str</span>(N2))[:-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h2 id="第十题"><a href="#第十题" class="headerlink" title="第十题"></a>第十题</h2><p>没有任何技巧, 只有数据流追踪</p>
<p>输入的数据第一步处理在<code>0000000140044310</code>, 大概可以看出来是一个将数据转化为二进制串的函数, 第一个参数是结果, 第二个参数为要转化的数据, 最后是要转化成的长度, 只是把0换成2, 1换成3然后拼接每一次转化的结果, 以16字节为一块:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F03%2F20250903-164202.png" alt="img"></p>
<p>然后就是不停下硬件断点跟踪, 直到进到<code>000000014000E5A0</code>进行了第二步处理, 第一步处理得到的binstr的每一位作为一级索引, 配合一个同样由<code>2</code>和<code>3</code>组成的key在一张9 * 9的表(<code>00000001400C10C0</code>)中取值:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F09%2F03%2F20250903-164237.png" alt="QQ_1756888952753"></p>
<p>再继续跟这一步得到的密文, 在<code>sub_14000CB50</code>进行了最终校验.</p>
<p>然后在拼接完二进制字符串后的<code>00000001400587A6</code>下断点进行加密轮次分析, 一共断下3次, 说明密文长度应该为0x30, 然后就是跟踪每一块的二进制字符串到加密和校验部分分别获取key和密文, 其中加密函数在程序运行中大概要被调用30000多次, 所以还是使用数据追踪的方式获取key, keygen如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bin2long</span>(<span class="params">bs</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bs, <span class="built_in">list</span>):</span><br><span class="line">        bs = <span class="built_in">bytes</span>(bs)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(bs.replace(<span class="string">b&#x27;\x02&#x27;</span>, <span class="string">b&#x27;0&#x27;</span>).replace(<span class="string">b&#x27;\x03&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>).decode()), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>]</span><br><span class="line">key = [key[<span class="number">0x80</span> * i : <span class="number">0x80</span> * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key) // <span class="number">0x80</span>)]</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x3</span>]</span><br><span class="line"></span><br><span class="line">table = [<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>]</span><br><span class="line"></span><br><span class="line">enc = [enc[<span class="number">0x80</span> * i : <span class="number">0x80</span> * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc) // <span class="number">0x80</span>)]</span><br><span class="line"></span><br><span class="line">ans = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> idx, e <span class="keyword">in</span> <span class="built_in">enumerate</span>(enc):</span><br><span class="line">    pans = []</span><br><span class="line">    <span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(e):</span><br><span class="line">        <span class="keyword">if</span> b == table[key[idx][i] + <span class="number">9</span> * <span class="number">2</span>]:</span><br><span class="line">            pans.append(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pans.append(<span class="number">3</span>)</span><br><span class="line">    ans += long_to_bytes(bin2long(pans))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>题目质量配不上比赛名气</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>1K0CT B14s
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://ikoct.com/2025/09/09/KCTF2025-Writeups/" title="KCTF2025 Writeups">https://ikoct.com/2025/09/09/KCTF2025-Writeups/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Reverse/" rel="tag"># Reverse</a>
              <a href="/tags/Writeups/" rel="tag"># Writeups</a>
              <a href="/tags/Pwn/" rel="tag"># Pwn</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/09/09/%E8%AE%B0%E4%B8%80%E6%AC%A1VMPWN%E5%88%86%E6%9E%90/" rel="prev" title="记一次VMPWN分析">
      <i class="fa fa-chevron-left"></i> 记一次VMPWN分析
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/10/30/%E5%9F%BA%E4%BA%8Ehvpp%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E5%A4%9AEPT-hooks/" rel="next" title="基于hvpp框架实现多EPT hooks">
      基于hvpp框架实现多EPT hooks <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">第一题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%A2%98"><span class="nav-number">2.</span> <span class="nav-text">第二题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%A2%98"><span class="nav-number">3.</span> <span class="nav-text">第三题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E9%A2%98"><span class="nav-number">4.</span> <span class="nav-text">第四题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B2%AA%E8%B5%9B%E6%AF%81%E4%BA%86%E6%88%91%E7%9A%84%E7%AC%AC%E4%BA%94%E9%A2%98-%E5%85%B6%E5%AE%9E%E6%B2%A1%E6%9C%89%E6%B2%AA%E8%B5%9B%E4%B9%9F%E5%81%9A%E4%B8%8D%E5%87%BA%E6%9D%A5"><span class="nav-number">5.</span> <span class="nav-text">沪赛毁了我的第五题(其实没有沪赛也做不出来)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E9%A2%98"><span class="nav-number">6.</span> <span class="nav-text">第六题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E6%95%B4%E4%BD%93%E5%88%86%E6%9E%90"><span class="nav-number">6.1.</span> <span class="nav-text">简单整体分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%8A%A0%E5%AF%86"><span class="nav-number">6.2.</span> <span class="nav-text">第一步加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%8A%A0%E5%AF%86"><span class="nav-number">6.3.</span> <span class="nav-text">第二步加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E5%8A%A0%E5%AF%86"><span class="nav-number">6.4.</span> <span class="nav-text">第三步加密</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E9%A2%98"><span class="nav-number">7.</span> <span class="nav-text">第七题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E9%A2%98"><span class="nav-number">8.</span> <span class="nav-text">第八题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B9%9D%E9%A2%98"><span class="nav-number">9.</span> <span class="nav-text">第九题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%BD%8D%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="nav-number">9.1.</span> <span class="nav-text">定位主函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9Name%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">9.2.</span> <span class="nav-text">对Name的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9SN%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">9.3.</span> <span class="nav-text">对SN的处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%95%E5%BC%80SN"><span class="nav-number">9.3.1.</span> <span class="nav-text">展开SN</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%A4%E6%B3%95%E8%BF%90%E7%AE%97"><span class="nav-number">9.3.2.</span> <span class="nav-text">除法运算</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E9%A2%98"><span class="nav-number">10.</span> <span class="nav-text">第十题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">11.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="1K0CT B14s"
      src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2025%2F10%2F28%2F20251028-101335.gif">
  <p class="site-author-name" itemprop="name">1K0CT B14s</p>
  <div class="site-description" itemprop="description">残りの人生、私にくれませんか？</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        <!--
-->

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">1K0CT B14s</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">698k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:35</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
