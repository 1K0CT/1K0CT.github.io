<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/manifest.json">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flat-top.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ikoct.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="参赛ID:1K0CT">
<meta property="og:type" content="article">
<meta property="og:title" content="BeginCTF2024逆向方向wp">
<meta property="og:url" content="https://ikoct.com/2024/02/23/BeginCTF2024%E9%80%86%E5%90%91%E6%96%B9%E5%90%91wp/">
<meta property="og:site_name" content="Ikoct的饮冰室">
<meta property="og:description" content="参赛ID:1K0CT">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110630.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-1.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-2.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-3.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-4.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-5.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-145028.png">
<meta property="article:published_time" content="2024-02-23T02:24:19.000Z">
<meta property="article:modified_time" content="2024-10-23T07:09:15.087Z">
<meta property="article:author" content="1K0CT B14s">
<meta property="article:tag" content="Reverse">
<meta property="article:tag" content="Writeups">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110630.png">

<link rel="canonical" href="https://ikoct.com/2024/02/23/BeginCTF2024%E9%80%86%E5%90%91%E6%96%B9%E5%90%91wp/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>BeginCTF2024逆向方向wp | Ikoct的饮冰室</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ikoct的饮冰室</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ikoct.com/2024/02/23/BeginCTF2024%E9%80%86%E5%90%91%E6%96%B9%E5%90%91wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.gif">
      <meta itemprop="name" content="1K0CT B14s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ikoct的饮冰室">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BeginCTF2024逆向方向wp
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-02-23 10:24:19" itemprop="dateCreated datePublished" datetime="2024-02-23T10:24:19+08:00">2024-02-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-10-23 15:09:15" itemprop="dateModified" datetime="2024-10-23T15:09:15+08:00">2024-10-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/" itemprop="url" rel="index"><span itemprop="name">二进制</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/Reverse/" itemprop="url" rel="index"><span itemprop="name">Reverse</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>49k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>45 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>参赛ID:1K0CT</p>
<span id="more"></span>

<h2 id="superguesser-动态调试"><a href="#superguesser-动态调试" class="headerlink" title="superguesser | 动态调试"></a>superguesser | 动态调试</h2><p>静态分析发现函数全部被混淆 在入口下断点步过函数直到进入被还原的函数 找到核心加密逻辑:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line">__int64 __fastcall <span class="title function_">sub_401530</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 <span class="built_in">stack</span>; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// zf</span></span><br><span class="line">  __int64 (*v2)(<span class="type">void</span>); <span class="comment">// rax</span></span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// rsp</span></span><br><span class="line">  __int64 v4; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// of</span></span><br><span class="line"></span><br><span class="line">  (loc_46EB33)();</span><br><span class="line">  _disable();</span><br><span class="line">  (loc_46EB77)();</span><br><span class="line">  (loc_46EBB4)();</span><br><span class="line">  <span class="keyword">if</span> ( v1 )</span><br><span class="line">    JUMPOUT(<span class="number">0x401548</span>i64);</span><br><span class="line">  (loc_46EBF7)();</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">96</span>) = <span class="number">81</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">95</span>) = <span class="number">81</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">94</span>) = <span class="number">82</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">93</span>) = <span class="number">95</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">92</span>) = <span class="number">89</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">91</span>) = <span class="number">67</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">90</span>) = <span class="number">93</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">89</span>) = <span class="number">95</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">88</span>) = <span class="number">89</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">87</span>) = <span class="number">73</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">86</span>) = <span class="number">90</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">85</span>) = <span class="number">89</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">84</span>) = <span class="number">86</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">83</span>) = <span class="number">46</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">82</span>) = <span class="number">38</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">81</span>) = <span class="number">29</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">80</span>) = <span class="number">42</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">79</span>) = <span class="number">55</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">78</span>) = <span class="number">26</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">77</span>) = <span class="number">39</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">76</span>) = <span class="number">41</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">75</span>) = <span class="number">23</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">74</span>) = <span class="number">40</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">73</span>) = <span class="number">36</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">72</span>) = <span class="number">42</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">71</span>) = <span class="number">56</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">70</span>) = <span class="number">37</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">69</span>) = <span class="number">33</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">68</span>) = <span class="number">61</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">67</span>) = <span class="number">15</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">66</span>) = <span class="number">50</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">65</span>) = <span class="number">58</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">64</span>) = <span class="number">60</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">63</span>) = <span class="number">61</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">62</span>) = <span class="number">54</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">61</span>) = <span class="number">51</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">60</span>) = <span class="number">42</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">59</span>) = <span class="number">0</span>;</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">24</span>) = (loc_46EC76)(<span class="built_in">stack</span> - <span class="number">96</span>);</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">25</span>) = <span class="number">51</span>;</span><br><span class="line">  v2 = (loc_46ECB3)();</span><br><span class="line">  __outbyte(<span class="number">0x2F</span>u, v2);</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">26</span>) = v2();</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">40</span>) = *(<span class="built_in">stack</span> - <span class="number">24</span>) - <span class="number">1</span>i64;</span><br><span class="line">  (loc_46ECF6)();</span><br><span class="line">  (loc_46ED38)();</span><br><span class="line">  v3 = alloca((loc_46ED75)());</span><br><span class="line">  *(<span class="built_in">stack</span> - <span class="number">48</span>) = alloc();</span><br><span class="line">  (scanf_0)(v4, *(<span class="built_in">stack</span> - <span class="number">48</span>));</span><br><span class="line">  (loc_46EE32)();</span><br><span class="line">  (loc_46EEB1)();</span><br><span class="line">  <span class="keyword">if</span> ( !v5 )</span><br><span class="line">    JUMPOUT(<span class="number">0x401651</span>i64);</span><br><span class="line">  <span class="keyword">while</span> ( *(<span class="built_in">stack</span> - <span class="number">20</span>) &lt; *(<span class="built_in">stack</span> - <span class="number">24</span>) )</span><br><span class="line">    *(*(<span class="built_in">stack</span> - <span class="number">48</span>) + (*(<span class="built_in">stack</span> - <span class="number">20</span>))++) ^= *(<span class="built_in">stack</span> - <span class="number">20</span>) + *(<span class="built_in">stack</span> - <span class="number">25</span>) + <span class="number">17</span> * *(<span class="built_in">stack</span> - <span class="number">26</span>);<span class="comment">// i + ? + 17 * ??</span></span><br><span class="line">  <span class="keyword">if</span> ( !(cmp)(*(<span class="built_in">stack</span> - <span class="number">48</span>), <span class="built_in">stack</span> - <span class="number">96</span>, *(<span class="built_in">stack</span> - <span class="number">24</span>)) )</span><br><span class="line">  &#123;</span><br><span class="line">    (loc_46F030)();</span><br><span class="line">    JUMPOUT(<span class="number">0x4016E8</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  (loc_46EF73)();</span><br><span class="line">  <span class="keyword">return</span> (loc_46EFF3)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动调发现<code>stack-48</code>处存放的就是输入的flag 而只有这一处加密 由于不确定<code>*(stack - 26)</code>的值是否因为反调试手段被修改 故用爆破方法解flag:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">81</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">95</span>, <span class="number">89</span>, <span class="number">67</span>, <span class="number">93</span>, <span class="number">95</span>, <span class="number">89</span>, <span class="number">73</span>, <span class="number">90</span>, <span class="number">89</span>, <span class="number">86</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">29</span>, <span class="number">42</span>, <span class="number">55</span>, <span class="number">26</span>, <span class="number">39</span>, <span class="number">41</span>, <span class="number">23</span>, <span class="number">40</span>, <span class="number">36</span>, <span class="number">42</span>, <span class="number">56</span>, <span class="number">37</span>, <span class="number">33</span>, <span class="number">61</span>, <span class="number">15</span>, <span class="number">50</span>, <span class="number">58</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">54</span>, <span class="number">51</span>, <span class="number">42</span>]</span><br><span class="line"><span class="keyword">for</span> ran <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        flag += <span class="built_in">chr</span>((enc[i] ^ (i + <span class="number">0x33</span> + <span class="number">17</span> * ran)) &amp; <span class="number">0xff</span>)</span><br><span class="line">    <span class="keyword">if</span> flag[:<span class="number">5</span>] == <span class="string">&quot;begin&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="comment"># begin&#123;debugging_is_an_anathor_choice&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="ezpython-注入解法"><a href="#ezpython-注入解法" class="headerlink" title="ezpython | 注入解法"></a>ezpython | 注入解法</h2><p>用pyinstxtractor解包出的key和enc无法通过sm4解密得到flag 故使用原程序的环境进行解密 原程序反编译后主要逻辑:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm4</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> key, enc</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad_pkcs7</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;PKCS#7填充&quot;&quot;&quot;</span></span><br><span class="line">    padding_len = <span class="number">16</span> - <span class="built_in">len</span>(data) % <span class="number">16</span></span><br><span class="line">    padding = <span class="built_in">bytes</span>([padding_len] * padding_len)</span><br><span class="line">    <span class="keyword">return</span> data + padding</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpad_pkcs7</span>(<span class="params">padded_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;PKCS#7去填充&quot;&quot;&quot;</span></span><br><span class="line">    padding_len = padded_data[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> padded_data[:-padding_len]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SM4</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.gmsm4 = sm4.CryptSM4()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encryptSM4</span>(<span class="params">self, encrypt_key, value</span>):</span><br><span class="line">        gmsm4 = self.gmsm4</span><br><span class="line">        gmsm4.set_key(encrypt_key.encode(), sm4.SM4_ENCRYPT)</span><br><span class="line">        padded_value = pad_pkcs7(value.encode())</span><br><span class="line">        encrypt_value = gmsm4.crypt_ecb(padded_value)</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(encrypt_value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    flag = <span class="built_in">input</span>(<span class="string">&quot;...&quot;</span>)</span><br><span class="line">    sm4_instance = SM4()</span><br><span class="line">    flag_1 = sm4_instance.encryptSM4(key, flag)</span><br><span class="line">    <span class="keyword">if</span> flag_1 == enc:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Failed&quot;</span>)</span><br></pre></td></tr></table></figure>



<p> 在powershell启动题目程序(用cmd或者直接启动貌似不行) 找到该程序的pid 使用de4py的PyShell功能将以下解密代码注入到程序:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decryptSM4</span>(<span class="params">self, encrypt_key, enc</span>):</span><br><span class="line">    gmsm4 = self.gmsm4</span><br><span class="line">    gmsm4.set_key(encrypt_key.encode(), sm4.SM4_DECRYPT)</span><br><span class="line">    encrypt_value = base64.b64decode(enc)</span><br><span class="line">    decrypt_value = gmsm4.crypt_ecb(encrypt_value)</span><br><span class="line">    <span class="keyword">return</span> unpad_pkcs7(decrypt_value).decode()</span><br><span class="line"></span><br><span class="line">SM4.decrypt = decryptSM4</span><br><span class="line">sm4_new = SM4()</span><br><span class="line"><span class="built_in">print</span>(sm4_new.decrypt(key, enc))</span><br></pre></td></tr></table></figure>

<p>效果:<img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110630.png"></p>
<h3 id="24-3-23更新正常解"><a href="#24-3-23更新正常解" class="headerlink" title="24&#x2F;3&#x2F;23更新正常解"></a>24&#x2F;3&#x2F;23更新正常解</h3><p>​	–原题魔改了国密库</p>
<h2 id="goforfun-go语言逆向"><a href="#goforfun-go语言逆向" class="headerlink" title="goforfun | go语言逆向"></a>goforfun | go语言逆向</h2><p>第一个加密的核心特征:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">255</span>; i &gt;= <span class="number">0</span>; --i )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( i &gt;= <span class="number">0x100</span> )</span><br><span class="line">    runtime_panicIndex();</span><br><span class="line">  *(box + i) = <span class="number">-1</span> - i;</span><br><span class="line">&#125;</span><br><span class="line">count = <span class="number">0</span>;</span><br><span class="line">v7 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ( count &lt; <span class="number">256</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v8 = *(box + count);</span><br><span class="line">  v9 = count;</span><br><span class="line">  v10 = count - <span class="number">12</span> * (((<span class="number">2863311531LL</span> * count) &gt;&gt; <span class="number">32</span>) &gt;&gt; <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v10 &gt;= <span class="number">0xC</span> )</span><br><span class="line">    runtime_panicIndex();</span><br><span class="line">  v7 += v35[v10] + v8;</span><br><span class="line">  *(box + v9) = *(box + v7);</span><br><span class="line">  *(box + v7) = v8;</span><br><span class="line">  count = v9 + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">sub_462C00(&amp;PRGA_result, box);</span><br><span class="line">flag_context = v4;</span><br><span class="line">lenth_of_context = v34;</span><br><span class="line">v26 = v11;</span><br><span class="line">main_PRGA(PRGA_result);</span><br></pre></td></tr></table></figure>

<p>Sbox初始化 PRGA 但是不是普通的RC4加密 进入PRGA函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __usercall main_PRGA@&lt;eax&gt;(<span class="type">char</span> table)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v2; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// bp</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [esp+12h] [ebp-2h]</span></span><br><span class="line">  <span class="type">void</span> *retaddr; <span class="comment">// [esp+14h] [ebp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( &amp;retaddr &lt;= *(*__readfsdword(runtime_tls_g) + <span class="number">8</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  result = runtime_makeslice(&amp;uint8, STACK[<span class="number">0x11C</span>], STACK[<span class="number">0x11C</span>]);</span><br><span class="line">  v2 = STACK[<span class="number">0x11C</span>];</span><br><span class="line">  v3 = STACK[<span class="number">0x118</span>];</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v2 &gt; v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = *(&amp;table + (v5 + <span class="number">1</span>));</span><br><span class="line">    v8 = v7 + v6;</span><br><span class="line">    *(&amp;table + (v5 + <span class="number">1</span>)) = *(&amp;table + (v7 + v6));</span><br><span class="line">    *(&amp;table + (v7 + v6)) = v7;</span><br><span class="line">    *(result + v4) = *(&amp;table + (v7 + *(&amp;table + (v5 + <span class="number">1</span>)))) ^ *(v3 + v4) ^ <span class="number">0x2F</span>;</span><br><span class="line">    ++v4;</span><br><span class="line">    v2 = STACK[<span class="number">0x11C</span>];</span><br><span class="line">    ++v5;</span><br><span class="line">    v6 = v8;</span><br><span class="line">  &#125;</span><br><span class="line">  STACK[<span class="number">0x124</span>] = result;</span><br><span class="line">  STACK[<span class="number">0x128</span>] = v2;</span><br><span class="line">  STACK[<span class="number">0x12C</span>] = v2;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动调发现<code>v3</code>存放的就是输入的flag去除begin{}包裹的内容 所以加密只关心和其异或的东西 在最后异或步骤下状况断点 输出存放异或的数字的寄存器:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639.png" alt="image-20240206140321081"></p>
<p>得到异或内容:</p>
<p><code>xor_key = [i ^ 0x2f for i in [132, 14, 121, 193, 41, 61, 231, 134, 147, 244, 180, 102, 100, 175, 25, 151, 133, 7, 230, 74, 200, 3, 55]]</code></p>
<p>最后一处加密的核心特征:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-1.png" alt="image-20240206140631616"></p>
<p>从64长度的表中按第二处加密得到的结果为下标取元素 最后和密文比较 猜测是换表base64</p>
<p>第二处加密:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v20 = main_byteArrayToBigInt(result, lenth_2);</span><br><span class="line">v22 = main_bigIntModToArray(str_head);</span><br></pre></td></tr></table></figure>

<p>动调发现第一个函数的作用就是将第一处加密得到的结果按小端序储存为Go中的一种大整型数据(没有位数上限 能储存多大取决于计算机)</p>
<p>第二个函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">__int128 __golang <span class="title function_">main_bigIntModToArray</span><span class="params">(<span class="type">int</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> *mod_result_instanc; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">int</span> now_result; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> origin_data; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> count_1; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> add_; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> *final_procees; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> *result_; <span class="comment">// [esp+Ch] [ebp-6Ch]</span></span><br><span class="line">  <span class="type">int</span> *v12; <span class="comment">// [esp+14h] [ebp-64h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v13; <span class="comment">// [esp+18h] [ebp-60h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+1Ch] [ebp-5Ch]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [esp+20h] [ebp-58h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v16; <span class="comment">// [esp+24h] [ebp-54h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v17; <span class="comment">// [esp+28h] [ebp-50h]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [esp+28h] [ebp-50h]</span></span><br><span class="line">  <span class="type">int</span> mod_num_2; <span class="comment">// [esp+2Ch] [ebp-4Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> mod_num; <span class="comment">// [esp+30h] [ebp-48h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// [esp+44h] [ebp-34h]</span></span><br><span class="line">  <span class="type">int</span> v22[<span class="number">4</span>]; <span class="comment">// [esp+48h] [ebp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> mod_n[<span class="number">4</span>]; <span class="comment">// [esp+58h] [ebp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> be_moded_instanc[<span class="number">4</span>]; <span class="comment">// [esp+68h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *retaddr; <span class="comment">// [esp+78h] [ebp+0h] BYREF</span></span><br><span class="line">  __int128 result; <span class="comment">// [esp+80h] [ebp+8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( &amp;retaddr &lt;= *(*__readfsdword(runtime_tls_g) + <span class="number">8</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  mod_result_instanc = a1;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; i = v16 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( mod_result_instanc[<span class="number">2</span>] )</span><br><span class="line">      v5 = *mod_result_instanc ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v5 &lt;= <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v17 = v2;</span><br><span class="line">    v21 = v3;</span><br><span class="line">    LOBYTE(be_moded_instanc[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;be_moded_instanc[<span class="number">1</span>], <span class="number">0</span>, <span class="number">12</span>);</span><br><span class="line">    mod_num = <span class="number">64</span>;</span><br><span class="line">    LOBYTE(mod_n[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">    mod_n[<span class="number">1</span>] = &amp;mod_num;</span><br><span class="line">    mod_n[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    mod_n[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">    result_ = math_big__Int_Mod(be_moded_instanc, mod_result_instanc, mod_n);</span><br><span class="line">    <span class="keyword">if</span> ( result_[<span class="number">2</span>] )</span><br><span class="line">      now_result = *result_[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      now_result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *result_ )</span><br><span class="line">      origin_data = -now_result;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      origin_data = now_result;</span><br><span class="line">    count_1 = i + <span class="number">1</span>;</span><br><span class="line">    add_ = v17;</span><br><span class="line">    <span class="keyword">if</span> ( v17 &lt; i + <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v15 = origin_data;</span><br><span class="line">      v12 = runtime_growslice(v21, i + <span class="number">1</span>, v17, <span class="number">1</span>, &amp;<span class="type">int</span>);</span><br><span class="line">      count_1 = v13;</span><br><span class="line">      final_procees = v12;</span><br><span class="line">      add_ = v14;</span><br><span class="line">      origin_data = v15;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      final_procees = v21;</span><br><span class="line">    &#125;</span><br><span class="line">    v21 = final_procees;</span><br><span class="line">    v16 = count_1;</span><br><span class="line">    v18 = add_;</span><br><span class="line">    final_procees[count_1 - <span class="number">1</span>] = origin_data;</span><br><span class="line">    mod_num_2 = <span class="number">0x40</span>;</span><br><span class="line">    LOBYTE(v22[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">    v22[<span class="number">1</span>] = &amp;mod_num_2;</span><br><span class="line">    v22[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    v22[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">    math_big__Int_Div(a1, a1, v22);</span><br><span class="line">    mod_result_instanc = a1;</span><br><span class="line">    v3 = v21;</span><br><span class="line">    v2 = v18;</span><br><span class="line">  &#125;</span><br><span class="line">  *&amp;result = __PAIR64__(i, v3);</span><br><span class="line">  DWORD2(result) = v2;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>核心是其中的大整型取模和大整型除法 动调发现取模和除法都是对第一个函数得到的大整型进行 另一个操作数是<code>0x40</code>也就是<code>result = big_int &amp; 0xFFFFFF, big_int &gt;&gt; 6</code>符合之前base64的猜测(但是直接用base64解出来不对 所以自己写解密脚本):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">xor_key = [i ^ <span class="number">0x2f</span> <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">132</span>, <span class="number">14</span>, <span class="number">121</span>, <span class="number">193</span>, <span class="number">41</span>, <span class="number">61</span>, <span class="number">231</span>, <span class="number">134</span>, <span class="number">147</span>, <span class="number">244</span>, <span class="number">180</span>, <span class="number">102</span>, <span class="number">100</span>, <span class="number">175</span>, <span class="number">25</span>, <span class="number">151</span>, <span class="number">133</span>, <span class="number">7</span>, <span class="number">230</span>, <span class="number">74</span>, <span class="number">200</span>, <span class="number">3</span>, <span class="number">55</span>]]</span><br><span class="line">enc = [<span class="string">&quot;8G+cazk2jqb7w01CtoKH4FsrgR3vVmQ9pPhXLAleOd/nB6DfIxMWYiUZ5SEJyNuT&quot;</span>.index(i) <span class="keyword">for</span> i <span class="keyword">in</span><span class="string">&quot;HZ0sMJXqxHgUb2b9RNg+1xw&quot;</span>]</span><br><span class="line">enc = [<span class="built_in">bin</span>(i).replace(<span class="string">&quot;0b&quot;</span>, <span class="string">&quot;&quot;</span>).zfill(<span class="number">6</span>) <span class="keyword">for</span> i <span class="keyword">in</span> enc][::-<span class="number">1</span>]</span><br><span class="line">big_int = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join(enc), <span class="number">2</span>)</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">while</span> big_int &gt; <span class="number">0</span>:</span><br><span class="line">    flag.append(big_int &amp; <span class="number">0xff</span>)</span><br><span class="line">    big_int &gt;&gt;= <span class="number">8</span></span><br><span class="line">flag = flag[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(flag[i] ^ xor_key[i]), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># go_a_nice_journey</span></span><br></pre></td></tr></table></figure>



<h2 id="not-main-反调试"><a href="#not-main-反调试" class="headerlink" title="not main | 反调试"></a>not main | 反调试</h2><p>IDA识别出的主函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  __int32 *pt_input1; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">unsigned</span> __int32 now; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> sum; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int32 next; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// edi</span></span><br><span class="line">  __int32 *pt_input3; <span class="comment">// ecx</span></span><br><span class="line">  __int32 *v10; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">bool</span> v12; <span class="comment">// cf</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v13; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [esp-4h] [ebp-2Ch]</span></span><br><span class="line">  __int32 *pt_input2; <span class="comment">// [esp+Ch] [ebp-1Ch]</span></span><br><span class="line">  __int128 v18; <span class="comment">// [esp+10h] [ebp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [esp+20h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  sub_141930(<span class="built_in">std</span>::<span class="built_in">cin</span>);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(enc);</span><br><span class="line">  <span class="keyword">if</span> ( v3 == <span class="number">0x1A</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    pt_input1 = enc;</span><br><span class="line">    pt_input2 = enc;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      now = *pt_input1;</span><br><span class="line">      sum = <span class="number">0</span>;                                  <span class="comment">// TEA</span></span><br><span class="line">      next = pt_input1[<span class="number">1</span>];</span><br><span class="line">      v8 = <span class="number">32</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        sum -= <span class="number">0x61C88647</span>;</span><br><span class="line">        now += ((next &gt;&gt; <span class="number">5</span>) + <span class="number">97</span>) ^ (<span class="number">16</span> * next + <span class="number">102</span>) ^ (sum + next);</span><br><span class="line">        next += ((now &gt;&gt; <span class="number">5</span>) + <span class="number">101</span>) ^ (<span class="number">16</span> * now + <span class="number">107</span>) ^ (sum + now);</span><br><span class="line">        --v8;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v8 );</span><br><span class="line">      *pt_input2 = now;</span><br><span class="line">      pt_input2[<span class="number">1</span>] = next;</span><br><span class="line">      pt_input1 = pt_input2 + <span class="number">2</span>;</span><br><span class="line">      pt_input2 = pt_input1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( pt_input1 &lt; &amp;debug_flag_1 );</span><br><span class="line">    pt_input3 = enc;</span><br><span class="line">    v10 = to_cmp;</span><br><span class="line">    v11 = <span class="number">28</span>;</span><br><span class="line">    <span class="keyword">while</span> ( *pt_input3 == *v10 )</span><br><span class="line">    &#123;</span><br><span class="line">      ++pt_input3;</span><br><span class="line">      ++v10;</span><br><span class="line">      v12 = v11 &lt; <span class="number">4</span>;</span><br><span class="line">      v11 -= <span class="number">4</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v12 )</span><br><span class="line">      &#123;</span><br><span class="line">        v18 = xmmword_143220;</span><br><span class="line">        LOBYTE(v19) = <span class="number">19</span>;</span><br><span class="line">        v13 = <span class="number">0</span>;</span><br><span class="line">        v3 = <span class="built_in">strlen</span>(&amp;v18);</span><br><span class="line">        <span class="keyword">if</span> ( v3 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">            *(&amp;v18 + v13++) ^= <span class="number">0x13</span>u;</span><br><span class="line">          <span class="keyword">while</span> ( v13 &lt; &amp;v18 + <span class="built_in">strlen</span>(&amp;v18) + <span class="number">1</span> - (&amp;v18 + <span class="number">1</span>) );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_11;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_11:                                       <span class="comment">// fail</span></span><br><span class="line">    v14 = sub_141600(v3, sub_141830);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v14, v16);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>包含一个TEA 但是解出来是假flag <code>while ( pt_input1 &lt; &amp;debug_flag_1 );</code>这一行对flag交叉引用到达一个异常处理函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_141010</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint8_t</span> BeingDebugged; <span class="comment">// al</span></span><br><span class="line"></span><br><span class="line">  BeingDebugged = NtCurrentPeb()-&gt;BeingDebugged;</span><br><span class="line">  debug_flag_1 = BeingDebugged != <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( BeingDebugged )</span><br><span class="line">    AddVectoredExceptionHandler(<span class="number">1u</span>, Handler);</span><br><span class="line">  <span class="keyword">return</span> atexit(sub_142AE0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Handler</code>应该就是程序正常运行过程中主函数触发异常后执行的处理函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">LONG __userpurge Handler@&lt;eax&gt;(<span class="type">int</span> a1@&lt;edi&gt;, <span class="keyword">struct</span> _EXCEPTION_POINTERS *ExceptionInfo)</span><br><span class="line">&#123;</span><br><span class="line">  DWORD ExceptionCode; <span class="comment">// eax</span></span><br><span class="line">  PCONTEXT ContextRecord; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> sum; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> __int32 temp; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">bool</span> v9; <span class="comment">// zf</span></span><br><span class="line">  _DWORD *real_enc; <span class="comment">// edx</span></span><br><span class="line">  __int32 *v11; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v12; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">bool</span> v13; <span class="comment">// cf</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [esp-10h] [ebp-44h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> addr_13503C; <span class="comment">// [esp+4h] [ebp-30h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [esp+8h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// [esp+Ch] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> temp_2; <span class="comment">// [esp+10h] [ebp-24h]</span></span><br><span class="line">  <span class="type">int</span> key[<span class="number">4</span>]; <span class="comment">// [esp+14h] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v23[<span class="number">3</span>]; <span class="comment">// [esp+24h] [ebp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  ExceptionCode = ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode;</span><br><span class="line">  <span class="keyword">if</span> ( ExceptionCode == <span class="number">-2147483645</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    ContextRecord = ExceptionInfo-&gt;ContextRecord;</span><br><span class="line">    dword_145038 = <span class="number">0</span>;</span><br><span class="line">    ++ContextRecord-&gt;Eip;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( ExceptionCode == <span class="number">0xC0000094</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    key[<span class="number">0</span>] = <span class="number">116</span>;</span><br><span class="line">    addr_13503C = to_cmp ^ ::addr_13503C;</span><br><span class="line">    sum = <span class="number">0</span>;</span><br><span class="line">    ::addr_13503C ^= to_cmp;</span><br><span class="line">    temp = enc_7_;</span><br><span class="line">    key[<span class="number">1</span>] = <span class="number">114</span>;</span><br><span class="line">    key[<span class="number">2</span>] = <span class="number">117</span>;</span><br><span class="line">    key[<span class="number">3</span>] = <span class="number">101</span>;</span><br><span class="line">    v19 = <span class="number">12</span>;</span><br><span class="line">    temp_2 = enc_7_;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v20 = sum - <span class="number">0x61C88647</span>;</span><br><span class="line">      v7 = ((sum - <span class="number">0x61C88647</span>) &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i )</span><br><span class="line">      &#123;</span><br><span class="line">        enc[i] += ((v20 ^ enc_1_[i]) + (temp_2 ^ key[v7 ^ i &amp; <span class="number">3</span>])) ^ (((<span class="number">16</span> * temp_2) ^ (enc_1_[i] &gt;&gt; <span class="number">3</span>))</span><br><span class="line">                                                                    + ((temp &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * enc_1_[i])));</span><br><span class="line">        temp = enc[i];</span><br><span class="line">        temp_2 = temp;</span><br><span class="line">      &#125;</span><br><span class="line">      sum -= <span class="number">0x61C88647</span>;</span><br><span class="line">      temp = (((v20 ^ enc[<span class="number">0</span>]) + (temp ^ key[v7 ^ i &amp; <span class="number">3</span>])) ^ (((<span class="number">16</span> * temp) ^ (enc[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>)) + ((temp &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * enc[<span class="number">0</span>]))))</span><br><span class="line">           + enc_7_;</span><br><span class="line">      v9 = v19-- == <span class="number">1</span>;</span><br><span class="line">      temp_2 = temp;</span><br><span class="line">      enc_7_ = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( !v9 );</span><br><span class="line">    real_enc = addr_13503C;</span><br><span class="line">    v11 = enc;</span><br><span class="line">    v12 = <span class="number">28</span>;</span><br><span class="line">    <span class="keyword">while</span> ( *v11 == *real_enc )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v11;</span><br><span class="line">      ++real_enc;</span><br><span class="line">      v13 = v12 &lt; <span class="number">4</span>;</span><br><span class="line">      v12 -= <span class="number">4</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v13 )</span><br><span class="line">      &#123;</span><br><span class="line">        v23[<span class="number">0</span>] = <span class="number">862354538</span>;</span><br><span class="line">        v23[<span class="number">1</span>] = <span class="number">862418548</span>;</span><br><span class="line">        v23[<span class="number">2</span>] = <span class="number">322070394</span>;</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(v23); ++j )</span><br><span class="line">          *(v23 + j) ^= <span class="number">0x13</span>u;</span><br><span class="line">        v15 = sub_141600(sub_141830, a1);</span><br><span class="line">        <span class="built_in">std</span>::ostream::operator&lt;&lt;(v15, v16);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ExceptionInfo-&gt;ContextRecord-&gt;Ecx = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>包含一个XXTEA加密 keygen:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> delta = <span class="number">0x61C88647</span>;</span><br><span class="line"><span class="type">unsigned</span> __int32 enc[] = &#123;</span><br><span class="line">    <span class="number">0xCFBE0F1B</span>, <span class="number">0x5F3083F</span>, <span class="number">0x4220E43B</span>, <span class="number">0x3383AFEE</span>, <span class="number">0xFA3237CE</span>, <span class="number">0xECADA66E</span>, <span class="number">0xA8D47CA7</span>, <span class="number">0xEFC51077</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> key[<span class="number">4</span>] = &#123;<span class="number">116</span>, <span class="number">114</span>, <span class="number">117</span>, <span class="number">101</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TEA decrypt</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">11</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> sum = <span class="number">-12</span> * <span class="number">0x61C88647</span>;</span><br><span class="line">    <span class="type">int</span> delta = <span class="number">0x61C88647</span>;</span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="type">int</span> j = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        enc[<span class="number">7</span>] -= (((sum ^ enc[<span class="number">0</span>]) + (enc[<span class="number">6</span>] ^ key[j ^ <span class="number">7</span> &amp; <span class="number">3</span>])) ^ (((<span class="number">16</span> * enc[<span class="number">6</span>]) ^ (enc[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>)) + ((enc[<span class="number">6</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * enc[<span class="number">0</span>]))));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">6</span>; i &gt;= <span class="number">1</span>; i--)&#123;</span><br><span class="line">            enc[i] -= (((sum ^ enc[i + <span class="number">1</span>]) + (enc[i - <span class="number">1</span>] ^ key[j ^ i &amp; <span class="number">3</span>])) ^ (((<span class="number">16</span> * enc[i - <span class="number">1</span>]) ^ (enc[i + <span class="number">1</span>] &gt;&gt; <span class="number">3</span>)) + ((enc[i - <span class="number">1</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * enc[i + <span class="number">1</span>]))));</span><br><span class="line">        &#125;</span><br><span class="line">        enc[<span class="number">0</span>] -= (((sum ^ enc[<span class="number">1</span>]) + (enc[<span class="number">7</span>] ^ key[j ^ <span class="number">0</span> &amp; <span class="number">3</span>])) ^ (((<span class="number">16</span> * enc[<span class="number">7</span>]) ^ (enc[<span class="number">1</span>] &gt;&gt; <span class="number">3</span>)) + ((enc[<span class="number">7</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * enc[<span class="number">1</span>]))));</span><br><span class="line">        sum += delta;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">while</span>(count--);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">2</span>)&#123;</span><br><span class="line">        sum = <span class="number">-32</span> * <span class="number">0x61C88647</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> _ = <span class="number">0</span>; _ &lt; <span class="number">32</span>; _++)&#123;</span><br><span class="line">            enc[i + <span class="number">1</span>] -= ((enc[i] &gt;&gt; <span class="number">5</span>) + <span class="number">101</span>) ^ (<span class="number">16</span> * enc[i] + <span class="number">107</span>) ^ (sum + enc[i]);</span><br><span class="line">            enc[i] -= ((enc[i + <span class="number">1</span>] &gt;&gt; <span class="number">5</span>) + <span class="number">97</span>) ^ (<span class="number">16</span> * enc[i + <span class="number">1</span>] + <span class="number">102</span>) ^ (sum + enc[i + <span class="number">1</span>]);</span><br><span class="line">            sum += delta;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, (enc[i] &gt;&gt; (<span class="number">8</span> * j)) &amp; <span class="number">0xff</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// begin&#123;not_main_is_matter!&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="出题人的密码是什么-不知道什么加密-混淆"><a href="#出题人的密码是什么-不知道什么加密-混淆" class="headerlink" title="出题人的密码是什么 | 不知道什么加密 | 混淆"></a>出题人的密码是什么 | 不知道什么加密 | 混淆</h2><p>最后的比较函数:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-2.png" alt="image-20240206142249939"></p>
<p>看起来是对控制流进行了混淆 先猜测就是按顺序一个一个对比 主函数开头就加了反调试:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:00AC8540 8B F4                         mov     esi, esp</span><br><span class="line">.text:00AC8542 FF 15 00 C0 B3 00             call    ds:IsDebuggerPresent</span><br><span class="line">.text:00AC8542</span><br><span class="line">.text:00AC8548 3B F4                         cmp     esi, esp</span><br><span class="line">.text:00AC854A E8 6E AA FF FF                call    j___RTC_CheckEsp</span><br><span class="line">.text:00AC854A</span><br><span class="line">.text:00AC854F 85 C0                         test    eax, eax</span><br><span class="line">.text:00AC8551 75 11                         jnz     short loc_AC8564                ; Keypatch modified this from:</span><br><span class="line">.text:00AC8551                                                                       ;   jz short loc_438564</span><br><span class="line">.text:00AC8551                                                                       ; Keypatch modified this from:</span><br><span class="line">.text:00AC8551                                                                       ;   jz short loc_D38564</span><br><span class="line">.text:00AC8551</span><br><span class="line">.text:00AC8553 8B F4                         mov     esi, esp</span><br><span class="line">.text:00AC8555 6A 00                         push    0                               ; uExitCode</span><br><span class="line">.text:00AC8557 FF 15 08 C0 B3 00             call    ds:ExitProcess</span><br></pre></td></tr></table></figure>

<p>这里patch掉 接下来输入完flag后有很多无用函数干扰分析 没用的函数标记一下 在唯一一个有用的分支找到两个加密函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">j__gets_s(passw, <span class="number">0x64</span>u);</span><br><span class="line">fzwufunc();</span><br><span class="line">fzwufunc2();</span><br><span class="line">j_fzwu();</span><br><span class="line">fzwufunc();</span><br><span class="line">sub_AC125D();</span><br><span class="line">j_fzwu__();</span><br><span class="line">...</span><br><span class="line"><span class="type">int</span> <span class="title function_">sub_D78120</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __CheckForDebuggerJustMyCode(byte_B3D0F4);</span><br><span class="line">  j_procees_func1();</span><br><span class="line">  j_procees_func2();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二个加密函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">procees_func2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  result = __CheckForDebuggerJustMyCode(&amp;byte_B3D0F4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">48</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    final_[i] = (passw[i] + <span class="number">5</span>) ^ <span class="number">0x25</span>;</span><br><span class="line">    result = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对第一个函数加密后的数据进行加法和异或</p>
<p>第一个加密函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">procees_func1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  __int64 v2; <span class="comment">// [esp+D0h] [ebp-58h]</span></span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// [esp+ECh] [ebp-3Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+F8h] [ebp-30h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+104h] [ebp-24h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [esp+110h] [ebp-18h]</span></span><br><span class="line">  <span class="type">char</span> *v7; <span class="comment">// [esp+120h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(byte_B3D0F4);</span><br><span class="line">  v3 = j__strlen(user);</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">    j__srand(byte_B39FD7[v3]);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    j__srand(<span class="number">0x123456</span>u);</span><br><span class="line">  v0 = j__rand() % <span class="number">7</span>;                           <span class="comment">// v0 = 7</span></span><br><span class="line">  result = dword_B39000[<span class="number">2</span> * v0];</span><br><span class="line">  LODWORD(v2) = result;</span><br><span class="line">  HIDWORD(v2) = dword_B39004[<span class="number">2</span> * v0];           <span class="comment">// v2 = 0x33077D</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = &amp;passw[<span class="number">8</span> * i];</span><br><span class="line">    v6 = *v7;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v6 &lt; <span class="number">0</span> )</span><br><span class="line">        v6 = v2 ^ (<span class="number">2</span> * v6);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v6 *= <span class="number">2</span>i64;</span><br><span class="line">    &#125;</span><br><span class="line">    *v7 = v6;</span><br><span class="line">    result = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对输入的flag进行32位小端序储存 然后根据当前数据块的正负(最高位)选择进行左移1位还是左移后再异或 这个异或会使左移后最后一位由0变成1 由此储存因左移丢失的数据 据此写出keygen 发现那个控制流混淆确实就是一位一位对比:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> __int8 enc[] = &#123;<span class="number">0xB4</span>, <span class="number">0xBB</span>, <span class="number">0xD8</span>, <span class="number">0xEB</span>, <span class="number">0xD0</span>, <span class="number">0x6E</span>, <span class="number">0xAB</span>, <span class="number">0xCA</span>, <span class="number">0x65</span>, <span class="number">0x8E</span>, </span><br><span class="line">  <span class="number">0x4B</span>, <span class="number">0xE9</span>, <span class="number">0x4D</span>, <span class="number">0xD4</span>, <span class="number">0x4A</span>, <span class="number">0xF3</span>, <span class="number">0x7D</span>, <span class="number">0x29</span>, <span class="number">0xC2</span>, <span class="number">0xF9</span>, </span><br><span class="line">  <span class="number">0x95</span>, <span class="number">0x89</span>, <span class="number">0xA4</span>, <span class="number">0x85</span>, <span class="number">0x9D</span>, <span class="number">0xCD</span>, <span class="number">0xDF</span>, <span class="number">0x77</span>, <span class="number">0xFD</span>, <span class="number">0x45</span>, </span><br><span class="line">  <span class="number">0xCB</span>, <span class="number">0x5D</span>, <span class="number">0x7D</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x4B</span>, <span class="number">0xBC</span>, <span class="number">0xF6</span>, <span class="number">0x7C</span>, <span class="number">0xF3</span>, </span><br><span class="line">  <span class="number">0x24</span>, <span class="number">0x42</span>, <span class="number">0xF5</span>, <span class="number">0xD2</span>, <span class="number">0xDD</span>, <span class="number">0xE3</span>, <span class="number">0x56</span>, <span class="number">0xAE</span>&#125;;</span><br><span class="line">    __int64 d = <span class="number">0x000000000033077D</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)&#123;</span><br><span class="line">        enc[i] ^= <span class="number">0x25</span>;</span><br><span class="line">        enc[i] -= <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">unsigned</span> __int64 enc_[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)&#123;</span><br><span class="line">        enc_[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++)&#123;</span><br><span class="line">            enc_[i] |= (__int64)enc[<span class="number">8</span> * i + j] &lt;&lt; (j * <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(enc_[i] &amp; <span class="number">1</span>)&#123;</span><br><span class="line">                enc_[i] ^= d;</span><br><span class="line">                enc_[i] &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">                enc_[i] |= (__int64)(<span class="number">0x8000000000000000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                enc_[i] &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// save the data back to enc with big-ending</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++)&#123;</span><br><span class="line">            enc[i * <span class="number">8</span> + j] = (enc_[i] &gt;&gt; (j * <span class="number">8</span>)) &amp; <span class="number">0xFF</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, enc[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// begin&#123;Th1s_reverse_pr0blem_may_t@ke_some_time#!&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="俄语学习-防静态分析"><a href="#俄语学习-防静态分析" class="headerlink" title="俄语学习 | 防静态分析"></a>俄语学习 | 防静态分析</h2><p>主要加密:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_1A1F80</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+D0h] [ebp-54h]</span></span><br><span class="line">  <span class="type">size_t</span> j; <span class="comment">// [esp+DCh] [ebp-48h]</span></span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// [esp+E8h] [ebp-3Ch]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">44</span>]; <span class="comment">// [esp+F4h] [ebp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_22F0F4);</span><br><span class="line">  qmemcpy(Str, cource, <span class="number">0x25</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= j__strlen(Str); ++i )</span><br><span class="line">    sourc_key[i] = Str[i] - <span class="number">0x72</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= j__strlen(sourc_key); ++j )</span><br><span class="line">    key[j] = sourc_key[j];</span><br><span class="line">  v0 = j__strlen(sourc_key);</span><br><span class="line">  result = sub_19B6D0(table, sourc_key, v0);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">256</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    copy_table[k] = table[k];</span><br><span class="line">    result = k + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中table初始化是干扰分析的 后面并不会用到 主要加密方式就是根据key对flag进行加减运算 以下是keygen:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> sub_1A1F80()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> v0; // eax</span><br><span class="line">  <span class="built_in">int</span> result; // eax</span><br><span class="line">  <span class="built_in">int</span> k; // [esp+D0h] [ebp-54h]</span><br><span class="line">  size_t j; // [esp+DCh] [ebp-48h]</span><br><span class="line">  size_t i; // [esp+E8h] [ebp-3Ch]</span><br><span class="line">  char Str[<span class="number">44</span>]; // [esp+F4h] [ebp-30h] BYREF</span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_22F0F4);</span><br><span class="line">  qmemcpy(Str, cource, 0x25u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= j__strlen(Str); ++i )</span><br><span class="line">    sourc_key[i] = Str[i] - <span class="number">0x72</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= j__strlen(sourc_key); ++j )</span><br><span class="line">    key[j] = sourc_key[j];</span><br><span class="line">  v0 = j__strlen(sourc_key);</span><br><span class="line">  result = sub_19B6D0(table, sourc_key, v0);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">256</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    copy_table[k] = table[k];</span><br><span class="line">    result = k + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># flag&#123;Russian_is_so_easy&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="红白机-简单虚拟机"><a href="#红白机-简单虚拟机" class="headerlink" title="红白机 | 简单虚拟机"></a>红白机 | 简单虚拟机</h2><p>使用的是6502虚拟机 直接模拟其运行(或者分析后手画也行) 这里已经用文本编辑器替换过原来的6502指令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">flag = np.array(Image.<span class="built_in">open</span>(<span class="string">&#x27;flag.png&#x27;</span>))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;6502.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    now_color = <span class="number">255</span></span><br><span class="line">    offset = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> offset &lt;= <span class="number">0x3FF</span>:</span><br><span class="line">        flag[<span class="built_in">int</span>(offset / <span class="number">32</span>), offset % <span class="number">32</span>] = now_color</span><br><span class="line">        offset += <span class="number">1</span></span><br><span class="line">    offset = <span class="number">1</span></span><br><span class="line">    lines = f.readlines()</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(lines)):</span><br><span class="line">        lines[i] = lines[i].replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines[<span class="number">36</span>:]:</span><br><span class="line">        <span class="keyword">if</span> line[:<span class="number">8</span>] == <span class="string">&quot;color = &quot;</span>:</span><br><span class="line">            now_color = <span class="built_in">int</span>(line[<span class="number">8</span>:], <span class="number">16</span>) * <span class="number">255</span></span><br><span class="line">        <span class="keyword">if</span> line[:<span class="number">10</span>] == <span class="string">&quot;load color&quot;</span>:</span><br><span class="line">            flag[<span class="built_in">int</span>((offset + <span class="built_in">int</span>(line[<span class="number">15</span>:<span class="number">18</span>], <span class="number">16</span>) - <span class="number">0x200</span>) / <span class="number">32</span>), offset % <span class="number">32</span>] = now_color</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(now_color, offset, <span class="built_in">int</span>(offset / <span class="number">32</span>), offset % <span class="number">32</span>, count)</span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">&quot;offset += 1&quot;</span>:</span><br><span class="line">            offset += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> line[:<span class="number">8</span>] == <span class="string">&quot;offset =&quot;</span>:</span><br><span class="line">            offset = <span class="built_in">int</span>(line[<span class="number">8</span>:], <span class="number">16</span>)</span><br><span class="line">plt.figure(<span class="string">&quot;flag&quot;</span>)</span><br><span class="line">plt.imshow(flag)</span><br><span class="line">plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-3.png" alt="image-20240206144338244"></p>
<h2 id="stick-game-js混淆"><a href="#stick-game-js混淆" class="headerlink" title="stick game | js混淆"></a>stick game | js混淆</h2><p>js中游戏的主要逻辑被混淆:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-4.png" alt="image-20240206144537026"></p>
<p>用网站反混淆:</p>
<p><img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-110639-5.png" alt="image-20240206144616490"></p>
<p>直接找到flag<img src="https://cdn.jsdelivr.net/gh/1K0CT/BlogImage@main/img/2024/02/23/20240223-145028.png" alt="image-20240206144649583"></p>
<h2 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h2><p>主要逻辑就是将flag分前后两半加密 用key正着异或一遍再倒着抑或一遍 再交换前后使用的key再重复上述过程 keygen:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">key = [<span class="number">52</span>,  <span class="number">49</span>,  <span class="number">56</span>,  <span class="number">48</span>,  <span class="number">51</span>,  <span class="number">56</span>,  <span class="number">55</span>,  <span class="number">51</span>,  <span class="number">54</span>,  <span class="number">50</span>, </span><br><span class="line">   <span class="number">53</span>,  <span class="number">57</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">51</span>,  <span class="number">54</span>,  <span class="number">51</span>,  <span class="number">48</span>,  <span class="number">57</span>,  <span class="number">50</span>, </span><br><span class="line">   <span class="number">54</span>,  <span class="number">48</span>,  <span class="number">54</span>,  <span class="number">54</span>,  <span class="number">51</span>,  <span class="number">50</span>,  <span class="number">55</span>,  <span class="number">56</span>,  <span class="number">55</span>,  <span class="number">57</span>, </span><br><span class="line">   <span class="number">52</span>,  <span class="number">55</span>]</span><br><span class="line">key1 = [<span class="number">54</span>,  <span class="number">51</span>,  <span class="number">50</span>,  <span class="number">57</span>,  <span class="number">48</span>,  <span class="number">55</span>,  <span class="number">57</span>,  <span class="number">52</span>,  <span class="number">50</span>,  <span class="number">48</span>, </span><br><span class="line">   <span class="number">55</span>,  <span class="number">55</span>,  <span class="number">49</span>,  <span class="number">53</span>,  <span class="number">53</span>,  <span class="number">56</span>,  <span class="number">55</span>,  <span class="number">54</span>,  <span class="number">55</span>,  <span class="number">57</span>, </span><br><span class="line">   <span class="number">54</span>,  <span class="number">50</span>,  <span class="number">49</span>,  <span class="number">51</span>,  <span class="number">56</span>,  <span class="number">54</span>,  <span class="number">55</span>,  <span class="number">51</span>,  <span class="number">53</span>,  <span class="number">48</span>, </span><br><span class="line">   <span class="number">48</span>,  <span class="number">48</span>]</span><br><span class="line">hbkey = key[<span class="number">0</span>:<span class="number">16</span>] + [<span class="number">0</span>]</span><br><span class="line">qmkey = key[<span class="number">16</span>:<span class="number">32</span>] + [<span class="number">0</span>]</span><br><span class="line">enc = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;`agh&#123;^bvuwTooahlYocPtmyiijj|ek&#x27;p&quot;</span>]</span><br><span class="line">qm = enc[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line">hb = enc[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    qm[i] ^= qmkey[<span class="number">16</span> - i]</span><br><span class="line">    qm[i] ^= hbkey[<span class="number">16</span> - i]</span><br><span class="line">    hb[i] ^= hbkey[<span class="number">16</span> - i]</span><br><span class="line">    hb[i] ^= qmkey[<span class="number">16</span> - i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    qm[i] ^= qmkey[i]</span><br><span class="line">    qm[i] ^= hbkey[i]</span><br><span class="line">    hb[i] ^= hbkey[i]</span><br><span class="line">    hb[i] ^= qmkey[i]</span><br><span class="line">hbkey = key1[<span class="number">0</span>:<span class="number">16</span>] + [<span class="number">0</span>]</span><br><span class="line">qmkey = key1[<span class="number">16</span>:<span class="number">32</span>] + [<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    qm[i] ^= qmkey[<span class="number">16</span> - i]</span><br><span class="line">    qm[i] ^= hbkey[<span class="number">16</span> - i]</span><br><span class="line">    hb[i] ^= hbkey[<span class="number">16</span> - i]</span><br><span class="line">    hb[i] ^= qmkey[<span class="number">16</span> - i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    qm[i] ^= qmkey[i]</span><br><span class="line">    qm[i] ^= hbkey[i]</span><br><span class="line">    hb[i] ^= hbkey[i]</span><br><span class="line">    hb[i] ^= qmkey[i]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> qm + hb])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;Virus_gonna_be_terminated!&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="babyvm-vmre"><a href="#babyvm-vmre" class="headerlink" title="babyvm | vmre"></a>babyvm | vmre</h2><p>模拟虚拟机运行过程 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># emulate the procees of vm</span></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;opcode.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> opcode:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;opcode.vm&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> opcode_file:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;memory.vm&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> memory:</span><br><span class="line">            all_memory = []</span><br><span class="line">            input_text = []</span><br><span class="line">            output_text = []</span><br><span class="line">            data = memory.read(<span class="number">4</span>)</span><br><span class="line">            <span class="keyword">while</span>(data):</span><br><span class="line">                all_memory.append(unpack(<span class="string">&quot;&lt;I&quot;</span>, data)[<span class="number">0</span>])</span><br><span class="line">                data = memory.read(<span class="number">4</span>)</span><br><span class="line">            now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">            in_pointer = <span class="number">0</span></span><br><span class="line">            out_pointer = <span class="number">0</span></span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            count_sum = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span>(now_op):</span><br><span class="line">                <span class="built_in">print</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">1</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">3</span> * <span class="number">4</span>)</span><br><span class="line">                    all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]] = all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]] + all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">2</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">3</span> * <span class="number">4</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;sum[&quot;</span> + <span class="built_in">str</span>(count_sum - <span class="number">8</span>) + <span class="string">&quot;] == &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                    count_sum += <span class="number">1</span></span><br><span class="line">                    all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]] = all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]] - all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">3</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">3</span> * <span class="number">4</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;key[&quot;</span> + <span class="built_in">str</span>(<span class="built_in">int</span>(count / <span class="number">20</span>)) +<span class="string">&quot;][&quot;</span> + <span class="built_in">str</span>(count % <span class="number">20</span>) + <span class="string">&quot;] == &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]) + <span class="string">&quot;, &quot;</span>)</span><br><span class="line">                    count += <span class="number">1</span></span><br><span class="line">                    all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]] = all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]] * all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">4</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">3</span> * <span class="number">4</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, (now_op[<span class="number">0</span>:<span class="number">4</span>]))[<span class="number">0</span>]) + <span class="string">&quot;] = mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]) + <span class="string">&quot;] / mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, (now_op[<span class="number">0</span>:<span class="number">4</span>]))[<span class="number">0</span>]) + <span class="string">&quot;] = mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]) + <span class="string">&quot;] / mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]) + <span class="string">&quot;]\n&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]) + <span class="string">&quot;] = &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]]), end = <span class="string">&quot;, &quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]) + <span class="string">&quot;] = &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]) + <span class="string">&quot;] = &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]]), end = <span class="string">&quot;, &quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]) + <span class="string">&quot;] = &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]) + <span class="string">&quot;] = &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]))</span><br><span class="line">                    opcode.write(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]) + <span class="string">&quot;] = &quot;</span> + <span class="built_in">str</span>(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                    all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">0</span>:<span class="number">4</span>])[<span class="number">0</span>]] = all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">4</span>:<span class="number">8</span>])[<span class="number">0</span>]] / all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op[<span class="number">8</span>:<span class="number">12</span>])[<span class="number">0</span>]]</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#reset the in pointer</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">5</span>:</span><br><span class="line">                    in_pointer = <span class="number">0</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;in_pointer = 0&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;in_pointer = 0\n&quot;</span>)</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#reset the out pointer</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">6</span>:</span><br><span class="line">                    out_pointer = <span class="number">0</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;out_pointer = 0&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;out_pointer = 0\n&quot;</span>)</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#pop-in</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">7</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    arg = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;from input[&quot;</span> + <span class="built_in">hex</span>(in_pointer) + <span class="string">&quot;] copy &quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]) + <span class="string">&quot; bytes to mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>]) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;from input[&quot;</span> + <span class="built_in">hex</span>(in_pointer) + <span class="string">&quot;] copy &quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]) + <span class="string">&quot; bytes to mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>]) + <span class="string">&quot;]\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]):</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] + i] = input_text[in_pointer]</span><br><span class="line">                            in_pointer += <span class="number">1</span></span><br><span class="line">                        <span class="keyword">except</span>:</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#pop-out</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">8</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    arg = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;from mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>]) + <span class="string">&quot;] copy &quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]) + <span class="string">&quot; bytes to output[&quot;</span> + <span class="built_in">hex</span>(out_pointer) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;from mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>]) + <span class="string">&quot;] copy &quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]) + <span class="string">&quot; bytes to output[&quot;</span> + <span class="built_in">hex</span>(out_pointer) + <span class="string">&quot;]\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]):</span><br><span class="line">                        output_text.append(all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] + i])</span><br><span class="line">                        out_pointer += <span class="number">1</span></span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#read_buffer</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">9</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;get_user_input and write in&quot;</span>, unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>])</span><br><span class="line">                    opcode.write(<span class="string">&quot;get_user_input and write in &quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                    input_text = [<span class="built_in">ord</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">input</span>()]</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(input_text)):</span><br><span class="line">                        all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] + i] = input_text[i]</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#write_buffer</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">10</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;print signal(correct or not)&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;print signal(correct or not)\n&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> output_text]))</span><br><span class="line">                    opcode.write(<span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> output_text]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#jump</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">11</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    arg = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    now_mem = all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]]</span><br><span class="line">                    <span class="comment"># if (arg and not(now_mem)):</span></span><br><span class="line">                    <span class="comment">#     print(&quot;goto &quot; + hex(unpack(&quot;&lt;I&quot;, now_op)[0]))</span></span><br><span class="line">                    <span class="comment">#     opcode_file.seek(unpack(&quot;&lt;I&quot;, now_op)[0])</span></span><br><span class="line">                    <span class="comment">#     now_op = opcode_file.read(4)</span></span><br><span class="line">                    <span class="comment">#     continue</span></span><br><span class="line">                    <span class="comment"># else:</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;not jump&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;not jump\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] - <span class="number">1</span>):</span><br><span class="line">                        now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#not-jump</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">12</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    arg = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    now_mem = all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]]</span><br><span class="line">                    <span class="comment"># if (arg and (now_mem)):</span></span><br><span class="line">                    <span class="comment">#     print(&quot;goto &quot; + hex(unpack(&quot;&lt;I&quot;, now_op)[0]))</span></span><br><span class="line">                    <span class="comment">#     opcode_file.seek(unpack(&quot;&lt;I&quot;, now_op)[0])</span></span><br><span class="line">                    <span class="comment">#     now_op = opcode_file.read(4)</span></span><br><span class="line">                    <span class="comment">#     continue</span></span><br><span class="line">                    <span class="comment"># else:</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;not jump&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;not jump\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] - <span class="number">2</span>):</span><br><span class="line">                        now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment">#get-lenth-of-input</span></span><br><span class="line">                <span class="keyword">if</span> unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>] == <span class="number">13</span>:</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    arg = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]) + <span class="string">&quot;] = len(mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>]) +<span class="string">&quot;])&quot;</span>)</span><br><span class="line">                    opcode.write(<span class="string">&quot;mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]) + <span class="string">&quot;] = len(mem[&quot;</span> + <span class="built_in">str</span>(unpack(<span class="string">&quot;&lt;I&quot;</span>, now_op)[<span class="number">0</span>]) +<span class="string">&quot;])\n&quot;</span>)</span><br><span class="line">                    all_memory[unpack(<span class="string">&quot;&lt;I&quot;</span>, arg)[<span class="number">0</span>]] = <span class="built_in">len</span>(input_text)</span><br><span class="line">                    now_op = opcode_file.read(<span class="number">4</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;error&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                        </span><br></pre></td></tr></table></figure>

<p>这里对所有flag错误导致的跳转进行剪枝 让虚拟机一直跑到结束以获得完整的运行过程 发现是用输入的20个字节构造20元方程组(所以这里的输出op的脚本进行了简化 只输出每一项的系数和0次项) 得到增广矩阵:</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">key[0][0] == 115, key[0][1] == 26, key[0][2] == 128, key[0][3] == 200, key[0][4] == 21, key[0][5] == 234, key[0][6] == 172, key[0][7] == 152, key[0][8] == 39, key[0][9] == 71, key[0][10] == 55, key[0][11] == 28, key[0][12] == 105, key[0][13] == 42, key[0][14] == 75, key[0][15] == 63, key[0][16] == 114, key[0][17] == 205, key[0][18] == 2, key[0][19] == 222, sum[0] == 217114</span><br><span class="line">not jump</span><br><span class="line">key[1][0] == 212, key[1][1] == 148, key[1][2] == 17, key[1][3] == 74, key[1][4] == 87, key[1][5] == 253, key[1][6] == 250, key[1][7] == 136, key[1][8] == 89, key[1][9] == 211, key[1][10] == 49, key[1][11] == 26, key[1][12] == 115, key[1][13] == 88, key[1][14] == 181, key[1][15] == 195, key[1][16] == 237, key[1][17] == 10, key[1][18] == 119, key[1][19] == 121, sum[1] == 270581</span><br><span class="line">not jump</span><br><span class="line">key[2][0] == 229, key[2][1] == 172, key[2][2] == 230, key[2][3] == 123, key[2][4] == 245, key[2][5] == 127, key[2][6] == 119, key[2][7] == 157, key[2][8] == 208, key[2][9] == 159, key[2][10] == 37, key[2][11] == 32, key[2][12] == 5, key[2][13] == 207, key[2][14] == 145, key[2][15] == 75, key[2][16] == 251, key[2][17] == 60, key[2][18] == 135, key[2][19] == 125, sum[2] == 291585</span><br><span class="line">not jump</span><br><span class="line">key[3][0] == 181, key[3][1] == 83, key[3][2] == 66, key[3][3] == 43, key[3][4] == 85, key[3][5] == 198, key[3][6] == 89, key[3][7] == 205, key[3][8] == 114, key[3][9] == 221, key[3][10] == 105, key[3][11] == 145, key[3][12] == 155, key[3][13] == 91, key[3][14] == 123, key[3][15] == 48, key[3][16] == 76, key[3][17] == 64, key[3][18] == 141, key[3][19] == 22, sum[3] == 234325</span><br><span class="line">not jump</span><br><span class="line">key[4][0] == 211, key[4][1] == 225, key[4][2] == 204, key[4][3] == 55, key[4][4] == 107, key[4][5] == 76, key[4][6] == 7, key[4][7] == 39, key[4][8] == 199, key[4][9] == 84, key[4][10] == 167, key[4][11] == 62, key[4][12] == 219, key[4][13] == 54, key[4][14] == 6, key[4][15] == 144, key[4][16] == 55, key[4][17] == 98, key[4][18] == 186, key[4][19] == 116, sum[4] == 240502</span><br><span class="line">not jump</span><br><span class="line">key[5][0] == 149, key[5][1] == 163, key[5][2] == 127, key[5][3] == 186, key[5][4] == 46, key[5][5] == 118, key[5][6] == 247, key[5][7] == 194, key[5][8] == 9, key[5][9] == 165, key[5][10] == 169, key[5][11] == 224, key[5][12] == 68, key[5][13] == 129, key[5][14] == 54, key[5][15] == 15, key[5][16] == 134, key[5][17] == 39, key[5][18] == 185, key[5][19] == 248, sum[5] == 277604</span><br><span class="line">not jump</span><br><span class="line">key[6][0] == 245, key[6][1] == 159, key[6][2] == 64, key[6][3] == 241, key[6][4] == 163, key[6][5] == 116, key[6][6] == 4, key[6][7] == 15, key[6][8] == 126, key[6][9] == 170, key[6][10] == 10, key[6][11] == 110, key[6][12] == 251, key[6][13] == 169, key[6][14] == 252, key[6][15] == 99, key[6][16] == 199, key[6][17] == 188, key[6][18] == 149, key[6][19] == 72, sum[6] == 286168</span><br><span class="line">not jump</span><br><span class="line">key[7][0] == 233, key[7][1] == 38, key[7][2] == 197, key[7][3] == 105, key[7][4] == 202, key[7][5] == 2, key[7][6] == 22, key[7][7] == 225, key[7][8] == 189, key[7][9] == 166, key[7][10] == 239, key[7][11] == 220, key[7][12] == 70, key[7][13] == 98, key[7][14] == 194, key[7][15] == 129, key[7][16] == 27, key[7][17] == 236, key[7][18] == 159, key[7][19] == 62, sum[7] == 290450</span><br><span class="line">not jump</span><br><span class="line">key[8][0] == 152, key[8][1] == 67, key[8][2] == 72, key[8][3] == 35, key[8][4] == 12, key[8][5] == 55, key[8][6] == 139, key[8][7] == 4, key[8][8] == 169, key[8][9] == 142, key[8][10] == 135, key[8][11] == 122, key[8][12] == 3, key[8][13] == 166, key[8][14] == 139, key[8][15] == 62, key[8][16] == 23, key[8][17] == 92, key[8][18] == 11, key[8][19] == 136, sum[8] == 179355</span><br><span class="line">not jump</span><br><span class="line">key[9][0] == 96, key[9][1] == 141, key[9][2] == 38, key[9][3] == 124, key[9][4] == 139, key[9][5] == 43, key[9][6] == 15, key[9][7] == 119, key[9][8] == 30, key[9][9] == 252, key[9][10] == 255, key[9][11] == 123, key[9][12] == 223, key[9][13] == 200, key[9][14] == 21, key[9][15] == 117, key[9][16] == 231, key[9][17] == 9, key[9][18] == 239, key[9][19] == 222, sum[9] == 272487</span><br><span class="line">not jump</span><br><span class="line">key[10][0] == 249, key[10][1] == 91, key[10][2] == 66, key[10][3] == 21, key[10][4] == 121, key[10][5] == 146, key[10][6] == 5, key[10][7] == 180, key[10][8] == 6, key[10][9] == 80, key[10][10] == 112, key[10][11] == 255, key[10][12] == 239, key[10][13] == 17, key[10][14] == 39, key[10][15] == 254, key[10][16] == 153, key[10][17] == 118, key[10][18] == 47, key[10][19] == 217, sum[10] == 249816</span><br><span class="line">not jump</span><br><span class="line">key[11][0] == 84, key[11][1] == 96, key[11][2] == 190, key[11][3] == 188, key[11][4] == 255, key[11][5] == 181, key[11][6] == 188, key[11][7] == 124, key[11][8] == 47, key[11][9] == 70, key[11][10] == 201, key[11][11] == 160, key[11][12] == 126, key[11][13] == 210, key[11][14] == 236, key[11][15] == 22, key[11][16] == 120, key[11][17] == 181, key[11][18] == 197, key[11][19] == 69, sum[11] == 305636</span><br><span class="line">not jump</span><br><span class="line">key[12][0] == 51, key[12][1] == 173, key[12][2] == 216, key[12][3] == 143, key[12][4] == 41, key[12][5] == 174, key[12][6] == 184, key[12][7] == 189, key[12][8] == 111, key[12][9] == 133, key[12][10] == 79, key[12][11] == 36, key[12][12] == 99, key[12][13] == 140, key[12][14] == 120, key[12][15] == 144, key[12][16] == 80, key[12][17] == 231, key[12][18] == 187, key[12][19] == 107, sum[12] == 276217</span><br><span class="line">not jump</span><br><span class="line">key[13][0] == 173, key[13][1] == 39, key[13][2] == 151, key[13][3] == 161, key[13][4] == 139, key[13][5] == 233, key[13][6] == 143, key[13][7] == 205, key[13][8] == 170, key[13][9] == 125, key[13][10] == 209, key[13][11] == 54, key[13][12] == 128, key[13][13] == 134, key[13][14] == 55, key[13][15] == 246, key[13][16] == 157, key[13][17] == 57, key[13][18] == 42, key[13][19] == 195, sum[13] == 294166</span><br><span class="line">not jump</span><br><span class="line">key[14][0] == 5, key[14][1] == 49, key[14][2] == 235, key[14][3] == 8, key[14][4] == 84, key[14][5] == 9, key[14][6] == 219, key[14][7] == 90, key[14][8] == 109, key[14][9] == 164, key[14][10] == 38, key[14][11] == 159, key[14][12] == 218, key[14][13] == 214, key[14][14] == 22, key[14][15] == 205, key[14][16] == 7, key[14][17] == 57, key[14][18] == 210, key[14][19] == 131, sum[14] == 237236</span><br><span class="line">not jump</span><br><span class="line">key[15][0] == 107, key[15][1] == 67, key[15][2] == 107, key[15][3] == 141, key[15][4] == 129, key[15][5] == 250, key[15][6] == 97, key[15][7] == 3, key[15][8] == 26, key[15][9] == 215, key[15][10] == 119, key[15][11] == 213, key[15][12] == 255, key[15][13] == 183, key[15][14] == 229, key[15][15] == 1, key[15][16] == 27, key[15][17] == 9, key[15][18] == 88, key[15][19] == 59, sum[15] == 242008</span><br><span class="line">not jump</span><br><span class="line">key[16][0] == 57, key[16][1] == 72, key[16][2] == 91, key[16][3] == 96, key[16][4] == 125, key[16][5] == 105, key[16][6] == 94, key[16][7] == 235, key[16][8] == 138, key[16][9] == 39, key[16][10] == 145, key[16][11] == 130, key[16][12] == 126, key[16][13] == 147, key[16][14] == 254, key[16][15] == 179, key[16][16] == 181, key[16][17] == 183, key[16][18] == 216, key[16][19] == 211, sum[16] == 289929</span><br><span class="line">not jump</span><br><span class="line">key[17][0] == 164, key[17][1] == 205, key[17][2] == 28, key[17][3] == 160, key[17][4] == 233, key[17][5] == 70, key[17][6] == 109, key[17][7] == 51, key[17][8] == 0, key[17][9] == 71, key[17][10] == 99, key[17][11] == 163, key[17][12] == 37, key[17][13] == 98, key[17][14] == 46, key[17][15] == 44, key[17][16] == 138, key[17][17] == 135, key[17][18] == 191, key[17][19] == 144, sum[17] == 221788</span><br><span class="line">not jump</span><br><span class="line">key[18][0] == 13, key[18][1] == 240, key[18][2] == 143, key[18][3] == 53, key[18][4] == 75, key[18][5] == 23, key[18][6] == 26, key[18][7] == 224, key[18][8] == 31, key[18][9] == 199, key[18][10] == 182, key[18][11] == 220, key[18][12] == 130, key[18][13] == 61, key[18][14] == 170, key[18][15] == 130, key[18][16] == 253, key[18][17] == 240, key[18][18] == 182, key[18][19] == 9, sum[18] == 268459</span><br><span class="line">not jump</span><br><span class="line">key[19][0] == 245, key[19][1] == 96, key[19][2] == 170, key[19][3] == 79, key[19][4] == 249, key[19][5] == 16, key[19][6] == 121, key[19][7] == 6, key[19][8] == 7, key[19][9] == 69, key[19][10] == 212, key[19][11] == 133, key[19][12] == 52, key[19][13] == 20, key[19][14] == 225, key[19][15] == 102, key[19][16] == 228, key[19][17] == 121, key[19][18] == 56, key[19][19] == 208, sum[19] == 247407</span><br></pre></td></tr></table></figure>

<p>用z3解该方程组(建议使用z3++ python效率太低<del>但是谁让我不会呢</del>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = [Int(<span class="string">&quot;flag_%s&quot;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)]</span><br><span class="line">key = [[Int(<span class="string">&quot;key_%d_%d&quot;</span> % (i, j)) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)]</span><br><span class="line"><span class="built_in">sum</span> = [Int(<span class="string">&#x27;sum_%d&#x27;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    s.add(<span class="built_in">sum</span>[i] == <span class="number">0</span>)</span><br><span class="line">s.add(key[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">115</span>, key[<span class="number">0</span>][<span class="number">1</span>] == <span class="number">26</span>, key[<span class="number">0</span>][<span class="number">2</span>] == <span class="number">128</span>, key[<span class="number">0</span>][<span class="number">3</span>] == <span class="number">200</span>, key[<span class="number">0</span>][<span class="number">4</span>] == <span class="number">21</span>, key[<span class="number">0</span>][<span class="number">5</span>] == <span class="number">234</span>, key[<span class="number">0</span>][<span class="number">6</span>] == <span class="number">172</span>, key[<span class="number">0</span>][<span class="number">7</span>] == <span class="number">152</span>, key[<span class="number">0</span>][<span class="number">8</span>] == <span class="number">39</span>, key[<span class="number">0</span>][<span class="number">9</span>] == <span class="number">71</span>, key[<span class="number">0</span>][<span class="number">10</span>] == <span class="number">55</span>, key[<span class="number">0</span>][<span class="number">11</span>] == <span class="number">28</span>, key[<span class="number">0</span>][<span class="number">12</span>] == <span class="number">105</span>, key[<span class="number">0</span>][<span class="number">13</span>] == <span class="number">42</span>, key[<span class="number">0</span>][<span class="number">14</span>] == <span class="number">75</span>, key[<span class="number">0</span>][<span class="number">15</span>] == <span class="number">63</span>, key[<span class="number">0</span>][<span class="number">16</span>] == <span class="number">114</span>, key[<span class="number">0</span>][<span class="number">17</span>] == <span class="number">205</span>, key[<span class="number">0</span>][<span class="number">18</span>] == <span class="number">2</span>, key[<span class="number">0</span>][<span class="number">19</span>] == <span class="number">222</span>, </span><br><span class="line">key[<span class="number">1</span>][<span class="number">0</span>] == <span class="number">212</span>, key[<span class="number">1</span>][<span class="number">1</span>] == <span class="number">148</span>, key[<span class="number">1</span>][<span class="number">2</span>] == <span class="number">17</span>, key[<span class="number">1</span>][<span class="number">3</span>] == <span class="number">74</span>, key[<span class="number">1</span>][<span class="number">4</span>] == <span class="number">87</span>, key[<span class="number">1</span>][<span class="number">5</span>] == <span class="number">253</span>, key[<span class="number">1</span>][<span class="number">6</span>] == <span class="number">250</span>, key[<span class="number">1</span>][<span class="number">7</span>] == <span class="number">136</span>, key[<span class="number">1</span>][<span class="number">8</span>] == <span class="number">89</span>, key[<span class="number">1</span>][<span class="number">9</span>] == <span class="number">211</span>, key[<span class="number">1</span>][<span class="number">10</span>] == <span class="number">49</span>, key[<span class="number">1</span>][<span class="number">11</span>] == <span class="number">26</span>, key[<span class="number">1</span>][<span class="number">12</span>] == <span class="number">115</span>, key[<span class="number">1</span>][<span class="number">13</span>] == <span class="number">88</span>, key[<span class="number">1</span>][<span class="number">14</span>] == <span class="number">181</span>, key[<span class="number">1</span>][<span class="number">15</span>] == <span class="number">195</span>, key[<span class="number">1</span>][<span class="number">16</span>] == <span class="number">237</span>, key[<span class="number">1</span>][<span class="number">17</span>] == <span class="number">10</span>, key[<span class="number">1</span>][<span class="number">18</span>] == <span class="number">119</span>, key[<span class="number">1</span>][<span class="number">19</span>] == <span class="number">121</span>, </span><br><span class="line">key[<span class="number">2</span>][<span class="number">0</span>] == <span class="number">229</span>, key[<span class="number">2</span>][<span class="number">1</span>] == <span class="number">172</span>, key[<span class="number">2</span>][<span class="number">2</span>] == <span class="number">230</span>, key[<span class="number">2</span>][<span class="number">3</span>] == <span class="number">123</span>, key[<span class="number">2</span>][<span class="number">4</span>] == <span class="number">245</span>, key[<span class="number">2</span>][<span class="number">5</span>] == <span class="number">127</span>, key[<span class="number">2</span>][<span class="number">6</span>] == <span class="number">119</span>, key[<span class="number">2</span>][<span class="number">7</span>] == <span class="number">157</span>, key[<span class="number">2</span>][<span class="number">8</span>] == <span class="number">208</span>, key[<span class="number">2</span>][<span class="number">9</span>] == <span class="number">159</span>, key[<span class="number">2</span>][<span class="number">10</span>] == <span class="number">37</span>, key[<span class="number">2</span>][<span class="number">11</span>] == <span class="number">32</span>, key[<span class="number">2</span>][<span class="number">12</span>] == <span class="number">5</span>, key[<span class="number">2</span>][<span class="number">13</span>] == <span class="number">207</span>, key[<span class="number">2</span>][<span class="number">14</span>] == <span class="number">145</span>, key[<span class="number">2</span>][<span class="number">15</span>] == <span class="number">75</span>, key[<span class="number">2</span>][<span class="number">16</span>] == <span class="number">251</span>, key[<span class="number">2</span>][<span class="number">17</span>] == <span class="number">60</span>, key[<span class="number">2</span>][<span class="number">18</span>] == <span class="number">135</span>, key[<span class="number">2</span>][<span class="number">19</span>] == <span class="number">125</span>, </span><br><span class="line">key[<span class="number">3</span>][<span class="number">0</span>] == <span class="number">181</span>, key[<span class="number">3</span>][<span class="number">1</span>] == <span class="number">83</span>, key[<span class="number">3</span>][<span class="number">2</span>] == <span class="number">66</span>, key[<span class="number">3</span>][<span class="number">3</span>] == <span class="number">43</span>, key[<span class="number">3</span>][<span class="number">4</span>] == <span class="number">85</span>, key[<span class="number">3</span>][<span class="number">5</span>] == <span class="number">198</span>, key[<span class="number">3</span>][<span class="number">6</span>] == <span class="number">89</span>, key[<span class="number">3</span>][<span class="number">7</span>] == <span class="number">205</span>, key[<span class="number">3</span>][<span class="number">8</span>] == <span class="number">114</span>, key[<span class="number">3</span>][<span class="number">9</span>] == <span class="number">221</span>, key[<span class="number">3</span>][<span class="number">10</span>] == <span class="number">105</span>, key[<span class="number">3</span>][<span class="number">11</span>] == <span class="number">145</span>, key[<span class="number">3</span>][<span class="number">12</span>] == <span class="number">155</span>, key[<span class="number">3</span>][<span class="number">13</span>] == <span class="number">91</span>, key[<span class="number">3</span>][<span class="number">14</span>] == <span class="number">123</span>, key[<span class="number">3</span>][<span class="number">15</span>] == <span class="number">48</span>, key[<span class="number">3</span>][<span class="number">16</span>] == <span class="number">76</span>, key[<span class="number">3</span>][<span class="number">17</span>] == <span class="number">64</span>, key[<span class="number">3</span>][<span class="number">18</span>] == <span class="number">141</span>, key[<span class="number">3</span>][<span class="number">19</span>] == <span class="number">22</span>, </span><br><span class="line">key[<span class="number">4</span>][<span class="number">0</span>] == <span class="number">211</span>, key[<span class="number">4</span>][<span class="number">1</span>] == <span class="number">225</span>, key[<span class="number">4</span>][<span class="number">2</span>] == <span class="number">204</span>, key[<span class="number">4</span>][<span class="number">3</span>] == <span class="number">55</span>, key[<span class="number">4</span>][<span class="number">4</span>] == <span class="number">107</span>, key[<span class="number">4</span>][<span class="number">5</span>] == <span class="number">76</span>, key[<span class="number">4</span>][<span class="number">6</span>] == <span class="number">7</span>, key[<span class="number">4</span>][<span class="number">7</span>] == <span class="number">39</span>, key[<span class="number">4</span>][<span class="number">8</span>] == <span class="number">199</span>, key[<span class="number">4</span>][<span class="number">9</span>] == <span class="number">84</span>, key[<span class="number">4</span>][<span class="number">10</span>] == <span class="number">167</span>, key[<span class="number">4</span>][<span class="number">11</span>] == <span class="number">62</span>, key[<span class="number">4</span>][<span class="number">12</span>] == <span class="number">219</span>, key[<span class="number">4</span>][<span class="number">13</span>] == <span class="number">54</span>, key[<span class="number">4</span>][<span class="number">14</span>] == <span class="number">6</span>, key[<span class="number">4</span>][<span class="number">15</span>] == <span class="number">144</span>, key[<span class="number">4</span>][<span class="number">16</span>] == <span class="number">55</span>, key[<span class="number">4</span>][<span class="number">17</span>] == <span class="number">98</span>, key[<span class="number">4</span>][<span class="number">18</span>] == <span class="number">186</span>, key[<span class="number">4</span>][<span class="number">19</span>] == <span class="number">116</span>, </span><br><span class="line">key[<span class="number">5</span>][<span class="number">0</span>] == <span class="number">149</span>, key[<span class="number">5</span>][<span class="number">1</span>] == <span class="number">163</span>, key[<span class="number">5</span>][<span class="number">2</span>] == <span class="number">127</span>, key[<span class="number">5</span>][<span class="number">3</span>] == <span class="number">186</span>, key[<span class="number">5</span>][<span class="number">4</span>] == <span class="number">46</span>, key[<span class="number">5</span>][<span class="number">5</span>] == <span class="number">118</span>, key[<span class="number">5</span>][<span class="number">6</span>] == <span class="number">247</span>, key[<span class="number">5</span>][<span class="number">7</span>] == <span class="number">194</span>, key[<span class="number">5</span>][<span class="number">8</span>] == <span class="number">9</span>, key[<span class="number">5</span>][<span class="number">9</span>] == <span class="number">165</span>, key[<span class="number">5</span>][<span class="number">10</span>] == <span class="number">169</span>, key[<span class="number">5</span>][<span class="number">11</span>] == <span class="number">224</span>, key[<span class="number">5</span>][<span class="number">12</span>] == <span class="number">68</span>, key[<span class="number">5</span>][<span class="number">13</span>] == <span class="number">129</span>, key[<span class="number">5</span>][<span class="number">14</span>] == <span class="number">54</span>, key[<span class="number">5</span>][<span class="number">15</span>] == <span class="number">15</span>, key[<span class="number">5</span>][<span class="number">16</span>] == <span class="number">134</span>, key[<span class="number">5</span>][<span class="number">17</span>] == <span class="number">39</span>, key[<span class="number">5</span>][<span class="number">18</span>] == <span class="number">185</span>, key[<span class="number">5</span>][<span class="number">19</span>] == <span class="number">248</span>, </span><br><span class="line">key[<span class="number">6</span>][<span class="number">0</span>] == <span class="number">245</span>, key[<span class="number">6</span>][<span class="number">1</span>] == <span class="number">159</span>, key[<span class="number">6</span>][<span class="number">2</span>] == <span class="number">64</span>, key[<span class="number">6</span>][<span class="number">3</span>] == <span class="number">241</span>, key[<span class="number">6</span>][<span class="number">4</span>] == <span class="number">163</span>, key[<span class="number">6</span>][<span class="number">5</span>] == <span class="number">116</span>, key[<span class="number">6</span>][<span class="number">6</span>] == <span class="number">4</span>, key[<span class="number">6</span>][<span class="number">7</span>] == <span class="number">15</span>, key[<span class="number">6</span>][<span class="number">8</span>] == <span class="number">126</span>, key[<span class="number">6</span>][<span class="number">9</span>] == <span class="number">170</span>, key[<span class="number">6</span>][<span class="number">10</span>] == <span class="number">10</span>, key[<span class="number">6</span>][<span class="number">11</span>] == <span class="number">110</span>, key[<span class="number">6</span>][<span class="number">12</span>] == <span class="number">251</span>, key[<span class="number">6</span>][<span class="number">13</span>] == <span class="number">169</span>, key[<span class="number">6</span>][<span class="number">14</span>] == <span class="number">252</span>, key[<span class="number">6</span>][<span class="number">15</span>] == <span class="number">99</span>, key[<span class="number">6</span>][<span class="number">16</span>] == <span class="number">199</span>, key[<span class="number">6</span>][<span class="number">17</span>] == <span class="number">188</span>, key[<span class="number">6</span>][<span class="number">18</span>] == <span class="number">149</span>, key[<span class="number">6</span>][<span class="number">19</span>] == <span class="number">72</span>, </span><br><span class="line">key[<span class="number">7</span>][<span class="number">0</span>] == <span class="number">233</span>, key[<span class="number">7</span>][<span class="number">1</span>] == <span class="number">38</span>, key[<span class="number">7</span>][<span class="number">2</span>] == <span class="number">197</span>, key[<span class="number">7</span>][<span class="number">3</span>] == <span class="number">105</span>, key[<span class="number">7</span>][<span class="number">4</span>] == <span class="number">202</span>, key[<span class="number">7</span>][<span class="number">5</span>] == <span class="number">2</span>, key[<span class="number">7</span>][<span class="number">6</span>] == <span class="number">22</span>, key[<span class="number">7</span>][<span class="number">7</span>] == <span class="number">225</span>, key[<span class="number">7</span>][<span class="number">8</span>] == <span class="number">189</span>, key[<span class="number">7</span>][<span class="number">9</span>] == <span class="number">166</span>, key[<span class="number">7</span>][<span class="number">10</span>] == <span class="number">239</span>, key[<span class="number">7</span>][<span class="number">11</span>] == <span class="number">220</span>, key[<span class="number">7</span>][<span class="number">12</span>] == <span class="number">70</span>, key[<span class="number">7</span>][<span class="number">13</span>] == <span class="number">98</span>, key[<span class="number">7</span>][<span class="number">14</span>] == <span class="number">194</span>, key[<span class="number">7</span>][<span class="number">15</span>] == <span class="number">129</span>, key[<span class="number">7</span>][<span class="number">16</span>] == <span class="number">27</span>, key[<span class="number">7</span>][<span class="number">17</span>] == <span class="number">236</span>, key[<span class="number">7</span>][<span class="number">18</span>] == <span class="number">159</span>, key[<span class="number">7</span>][<span class="number">19</span>] == <span class="number">62</span>, </span><br><span class="line">key[<span class="number">8</span>][<span class="number">0</span>] == <span class="number">152</span>, key[<span class="number">8</span>][<span class="number">1</span>] == <span class="number">67</span>, key[<span class="number">8</span>][<span class="number">2</span>] == <span class="number">72</span>, key[<span class="number">8</span>][<span class="number">3</span>] == <span class="number">35</span>, key[<span class="number">8</span>][<span class="number">4</span>] == <span class="number">12</span>, key[<span class="number">8</span>][<span class="number">5</span>] == <span class="number">55</span>, key[<span class="number">8</span>][<span class="number">6</span>] == <span class="number">139</span>, key[<span class="number">8</span>][<span class="number">7</span>] == <span class="number">4</span>, key[<span class="number">8</span>][<span class="number">8</span>] == <span class="number">169</span>, key[<span class="number">8</span>][<span class="number">9</span>] == <span class="number">142</span>, key[<span class="number">8</span>][<span class="number">10</span>] == <span class="number">135</span>, key[<span class="number">8</span>][<span class="number">11</span>] == <span class="number">122</span>, key[<span class="number">8</span>][<span class="number">12</span>] == <span class="number">3</span>, key[<span class="number">8</span>][<span class="number">13</span>] == <span class="number">166</span>, key[<span class="number">8</span>][<span class="number">14</span>] == <span class="number">139</span>, key[<span class="number">8</span>][<span class="number">15</span>] == <span class="number">62</span>, key[<span class="number">8</span>][<span class="number">16</span>] == <span class="number">23</span>, key[<span class="number">8</span>][<span class="number">17</span>] == <span class="number">92</span>, key[<span class="number">8</span>][<span class="number">18</span>] == <span class="number">11</span>, key[<span class="number">8</span>][<span class="number">19</span>] == <span class="number">136</span>, </span><br><span class="line">key[<span class="number">9</span>][<span class="number">0</span>] == <span class="number">96</span>, key[<span class="number">9</span>][<span class="number">1</span>] == <span class="number">141</span>, key[<span class="number">9</span>][<span class="number">2</span>] == <span class="number">38</span>, key[<span class="number">9</span>][<span class="number">3</span>] == <span class="number">124</span>, key[<span class="number">9</span>][<span class="number">4</span>] == <span class="number">139</span>, key[<span class="number">9</span>][<span class="number">5</span>] == <span class="number">43</span>, key[<span class="number">9</span>][<span class="number">6</span>] == <span class="number">15</span>, key[<span class="number">9</span>][<span class="number">7</span>] == <span class="number">119</span>, key[<span class="number">9</span>][<span class="number">8</span>] == <span class="number">30</span>, key[<span class="number">9</span>][<span class="number">9</span>] == <span class="number">252</span>, key[<span class="number">9</span>][<span class="number">10</span>] == <span class="number">255</span>, key[<span class="number">9</span>][<span class="number">11</span>] == <span class="number">123</span>, key[<span class="number">9</span>][<span class="number">12</span>] == <span class="number">223</span>, key[<span class="number">9</span>][<span class="number">13</span>] == <span class="number">200</span>, key[<span class="number">9</span>][<span class="number">14</span>] == <span class="number">21</span>, key[<span class="number">9</span>][<span class="number">15</span>] == <span class="number">117</span>, key[<span class="number">9</span>][<span class="number">16</span>] == <span class="number">231</span>, key[<span class="number">9</span>][<span class="number">17</span>] == <span class="number">9</span>, key[<span class="number">9</span>][<span class="number">18</span>] == <span class="number">239</span>, key[<span class="number">9</span>][<span class="number">19</span>] == <span class="number">222</span>, </span><br><span class="line">key[<span class="number">10</span>][<span class="number">0</span>] == <span class="number">249</span>, key[<span class="number">10</span>][<span class="number">1</span>] == <span class="number">91</span>, key[<span class="number">10</span>][<span class="number">2</span>] == <span class="number">66</span>, key[<span class="number">10</span>][<span class="number">3</span>] == <span class="number">21</span>, key[<span class="number">10</span>][<span class="number">4</span>] == <span class="number">121</span>, key[<span class="number">10</span>][<span class="number">5</span>] == <span class="number">146</span>, key[<span class="number">10</span>][<span class="number">6</span>] == <span class="number">5</span>, key[<span class="number">10</span>][<span class="number">7</span>] == <span class="number">180</span>, key[<span class="number">10</span>][<span class="number">8</span>] == <span class="number">6</span>, key[<span class="number">10</span>][<span class="number">9</span>] == <span class="number">80</span>, key[<span class="number">10</span>][<span class="number">10</span>] == <span class="number">112</span>, key[<span class="number">10</span>][<span class="number">11</span>] == <span class="number">255</span>, key[<span class="number">10</span>][<span class="number">12</span>] == <span class="number">239</span>, key[<span class="number">10</span>][<span class="number">13</span>] == <span class="number">17</span>, key[<span class="number">10</span>][<span class="number">14</span>] == <span class="number">39</span>, key[<span class="number">10</span>][<span class="number">15</span>] == <span class="number">254</span>, key[<span class="number">10</span>][<span class="number">16</span>] == <span class="number">153</span>, key[<span class="number">10</span>][<span class="number">17</span>] == <span class="number">118</span>, key[<span class="number">10</span>][<span class="number">18</span>] == <span class="number">47</span>, key[<span class="number">10</span>][<span class="number">19</span>] == <span class="number">217</span>, </span><br><span class="line">key[<span class="number">11</span>][<span class="number">0</span>] == <span class="number">84</span>, key[<span class="number">11</span>][<span class="number">1</span>] == <span class="number">96</span>, key[<span class="number">11</span>][<span class="number">2</span>] == <span class="number">190</span>, key[<span class="number">11</span>][<span class="number">3</span>] == <span class="number">188</span>, key[<span class="number">11</span>][<span class="number">4</span>] == <span class="number">255</span>, key[<span class="number">11</span>][<span class="number">5</span>] == <span class="number">181</span>, key[<span class="number">11</span>][<span class="number">6</span>] == <span class="number">188</span>, key[<span class="number">11</span>][<span class="number">7</span>] == <span class="number">124</span>, key[<span class="number">11</span>][<span class="number">8</span>] == <span class="number">47</span>, key[<span class="number">11</span>][<span class="number">9</span>] == <span class="number">70</span>, key[<span class="number">11</span>][<span class="number">10</span>] == <span class="number">201</span>, key[<span class="number">11</span>][<span class="number">11</span>] == <span class="number">160</span>, key[<span class="number">11</span>][<span class="number">12</span>] == <span class="number">126</span>, key[<span class="number">11</span>][<span class="number">13</span>] == <span class="number">210</span>, key[<span class="number">11</span>][<span class="number">14</span>] == <span class="number">236</span>, key[<span class="number">11</span>][<span class="number">15</span>] == <span class="number">22</span>, key[<span class="number">11</span>][<span class="number">16</span>] == <span class="number">120</span>, key[<span class="number">11</span>][<span class="number">17</span>] == <span class="number">181</span>, key[<span class="number">11</span>][<span class="number">18</span>] == <span class="number">197</span>, key[<span class="number">11</span>][<span class="number">19</span>] == <span class="number">69</span>, </span><br><span class="line">key[<span class="number">12</span>][<span class="number">0</span>] == <span class="number">51</span>, key[<span class="number">12</span>][<span class="number">1</span>] == <span class="number">173</span>, key[<span class="number">12</span>][<span class="number">2</span>] == <span class="number">216</span>, key[<span class="number">12</span>][<span class="number">3</span>] == <span class="number">143</span>, key[<span class="number">12</span>][<span class="number">4</span>] == <span class="number">41</span>, key[<span class="number">12</span>][<span class="number">5</span>] == <span class="number">174</span>, key[<span class="number">12</span>][<span class="number">6</span>] == <span class="number">184</span>, key[<span class="number">12</span>][<span class="number">7</span>] == <span class="number">189</span>, key[<span class="number">12</span>][<span class="number">8</span>] == <span class="number">111</span>, key[<span class="number">12</span>][<span class="number">9</span>] == <span class="number">133</span>, key[<span class="number">12</span>][<span class="number">10</span>] == <span class="number">79</span>, key[<span class="number">12</span>][<span class="number">11</span>] == <span class="number">36</span>, key[<span class="number">12</span>][<span class="number">12</span>] == <span class="number">99</span>, key[<span class="number">12</span>][<span class="number">13</span>] == <span class="number">140</span>, key[<span class="number">12</span>][<span class="number">14</span>] == <span class="number">120</span>, key[<span class="number">12</span>][<span class="number">15</span>] == <span class="number">144</span>, key[<span class="number">12</span>][<span class="number">16</span>] == <span class="number">80</span>, key[<span class="number">12</span>][<span class="number">17</span>] == <span class="number">231</span>, key[<span class="number">12</span>][<span class="number">18</span>] == <span class="number">187</span>, key[<span class="number">12</span>][<span class="number">19</span>] == <span class="number">107</span>, </span><br><span class="line">key[<span class="number">13</span>][<span class="number">0</span>] == <span class="number">173</span>, key[<span class="number">13</span>][<span class="number">1</span>] == <span class="number">39</span>, key[<span class="number">13</span>][<span class="number">2</span>] == <span class="number">151</span>, key[<span class="number">13</span>][<span class="number">3</span>] == <span class="number">161</span>, key[<span class="number">13</span>][<span class="number">4</span>] == <span class="number">139</span>, key[<span class="number">13</span>][<span class="number">5</span>] == <span class="number">233</span>, key[<span class="number">13</span>][<span class="number">6</span>] == <span class="number">143</span>, key[<span class="number">13</span>][<span class="number">7</span>] == <span class="number">205</span>, key[<span class="number">13</span>][<span class="number">8</span>] == <span class="number">170</span>, key[<span class="number">13</span>][<span class="number">9</span>] == <span class="number">125</span>, key[<span class="number">13</span>][<span class="number">10</span>] == <span class="number">209</span>, key[<span class="number">13</span>][<span class="number">11</span>] == <span class="number">54</span>, key[<span class="number">13</span>][<span class="number">12</span>] == <span class="number">128</span>, key[<span class="number">13</span>][<span class="number">13</span>] == <span class="number">134</span>, key[<span class="number">13</span>][<span class="number">14</span>] == <span class="number">55</span>, key[<span class="number">13</span>][<span class="number">15</span>] == <span class="number">246</span>, key[<span class="number">13</span>][<span class="number">16</span>] == <span class="number">157</span>, key[<span class="number">13</span>][<span class="number">17</span>] == <span class="number">57</span>, key[<span class="number">13</span>][<span class="number">18</span>] == <span class="number">42</span>, key[<span class="number">13</span>][<span class="number">19</span>] == <span class="number">195</span>, </span><br><span class="line">key[<span class="number">14</span>][<span class="number">0</span>] == <span class="number">5</span>, key[<span class="number">14</span>][<span class="number">1</span>] == <span class="number">49</span>, key[<span class="number">14</span>][<span class="number">2</span>] == <span class="number">235</span>, key[<span class="number">14</span>][<span class="number">3</span>] == <span class="number">8</span>, key[<span class="number">14</span>][<span class="number">4</span>] == <span class="number">84</span>, key[<span class="number">14</span>][<span class="number">5</span>] == <span class="number">9</span>, key[<span class="number">14</span>][<span class="number">6</span>] == <span class="number">219</span>, key[<span class="number">14</span>][<span class="number">7</span>] == <span class="number">90</span>, key[<span class="number">14</span>][<span class="number">8</span>] == <span class="number">109</span>, key[<span class="number">14</span>][<span class="number">9</span>] == <span class="number">164</span>, key[<span class="number">14</span>][<span class="number">10</span>] == <span class="number">38</span>, key[<span class="number">14</span>][<span class="number">11</span>] == <span class="number">159</span>, key[<span class="number">14</span>][<span class="number">12</span>] == <span class="number">218</span>, key[<span class="number">14</span>][<span class="number">13</span>] == <span class="number">214</span>, key[<span class="number">14</span>][<span class="number">14</span>] == <span class="number">22</span>, key[<span class="number">14</span>][<span class="number">15</span>] == <span class="number">205</span>, key[<span class="number">14</span>][<span class="number">16</span>] == <span class="number">7</span>, key[<span class="number">14</span>][<span class="number">17</span>] == <span class="number">57</span>, key[<span class="number">14</span>][<span class="number">18</span>] == <span class="number">210</span>, key[<span class="number">14</span>][<span class="number">19</span>] == <span class="number">131</span>, </span><br><span class="line">key[<span class="number">15</span>][<span class="number">0</span>] == <span class="number">107</span>, key[<span class="number">15</span>][<span class="number">1</span>] == <span class="number">67</span>, key[<span class="number">15</span>][<span class="number">2</span>] == <span class="number">107</span>, key[<span class="number">15</span>][<span class="number">3</span>] == <span class="number">141</span>, key[<span class="number">15</span>][<span class="number">4</span>] == <span class="number">129</span>, key[<span class="number">15</span>][<span class="number">5</span>] == <span class="number">250</span>, key[<span class="number">15</span>][<span class="number">6</span>] == <span class="number">97</span>, key[<span class="number">15</span>][<span class="number">7</span>] == <span class="number">3</span>, key[<span class="number">15</span>][<span class="number">8</span>] == <span class="number">26</span>, key[<span class="number">15</span>][<span class="number">9</span>] == <span class="number">215</span>, key[<span class="number">15</span>][<span class="number">10</span>] == <span class="number">119</span>, key[<span class="number">15</span>][<span class="number">11</span>] == <span class="number">213</span>, key[<span class="number">15</span>][<span class="number">12</span>] == <span class="number">255</span>, key[<span class="number">15</span>][<span class="number">13</span>] == <span class="number">183</span>, key[<span class="number">15</span>][<span class="number">14</span>] == <span class="number">229</span>, key[<span class="number">15</span>][<span class="number">15</span>] == <span class="number">1</span>, key[<span class="number">15</span>][<span class="number">16</span>] == <span class="number">27</span>, key[<span class="number">15</span>][<span class="number">17</span>] == <span class="number">9</span>, key[<span class="number">15</span>][<span class="number">18</span>] == <span class="number">88</span>, key[<span class="number">15</span>][<span class="number">19</span>] == <span class="number">59</span>, </span><br><span class="line">key[<span class="number">16</span>][<span class="number">0</span>] == <span class="number">57</span>, key[<span class="number">16</span>][<span class="number">1</span>] == <span class="number">72</span>, key[<span class="number">16</span>][<span class="number">2</span>] == <span class="number">91</span>, key[<span class="number">16</span>][<span class="number">3</span>] == <span class="number">96</span>, key[<span class="number">16</span>][<span class="number">4</span>] == <span class="number">125</span>, key[<span class="number">16</span>][<span class="number">5</span>] == <span class="number">105</span>, key[<span class="number">16</span>][<span class="number">6</span>] == <span class="number">94</span>, key[<span class="number">16</span>][<span class="number">7</span>] == <span class="number">235</span>, key[<span class="number">16</span>][<span class="number">8</span>] == <span class="number">138</span>, key[<span class="number">16</span>][<span class="number">9</span>] == <span class="number">39</span>, key[<span class="number">16</span>][<span class="number">10</span>] == <span class="number">145</span>, key[<span class="number">16</span>][<span class="number">11</span>] == <span class="number">130</span>, key[<span class="number">16</span>][<span class="number">12</span>] == <span class="number">126</span>, key[<span class="number">16</span>][<span class="number">13</span>] == <span class="number">147</span>, key[<span class="number">16</span>][<span class="number">14</span>] == <span class="number">254</span>, key[<span class="number">16</span>][<span class="number">15</span>] == <span class="number">179</span>, key[<span class="number">16</span>][<span class="number">16</span>] == <span class="number">181</span>, key[<span class="number">16</span>][<span class="number">17</span>] == <span class="number">183</span>, key[<span class="number">16</span>][<span class="number">18</span>] == <span class="number">216</span>, key[<span class="number">16</span>][<span class="number">19</span>] == <span class="number">211</span>, </span><br><span class="line">key[<span class="number">17</span>][<span class="number">0</span>] == <span class="number">164</span>, key[<span class="number">17</span>][<span class="number">1</span>] == <span class="number">205</span>, key[<span class="number">17</span>][<span class="number">2</span>] == <span class="number">28</span>, key[<span class="number">17</span>][<span class="number">3</span>] == <span class="number">160</span>, key[<span class="number">17</span>][<span class="number">4</span>] == <span class="number">233</span>, key[<span class="number">17</span>][<span class="number">5</span>] == <span class="number">70</span>, key[<span class="number">17</span>][<span class="number">6</span>] == <span class="number">109</span>, key[<span class="number">17</span>][<span class="number">7</span>] == <span class="number">51</span>, key[<span class="number">17</span>][<span class="number">8</span>] == <span class="number">0</span>, key[<span class="number">17</span>][<span class="number">9</span>] == <span class="number">71</span>, key[<span class="number">17</span>][<span class="number">10</span>] == <span class="number">99</span>, key[<span class="number">17</span>][<span class="number">11</span>] == <span class="number">163</span>, key[<span class="number">17</span>][<span class="number">12</span>] == <span class="number">37</span>, key[<span class="number">17</span>][<span class="number">13</span>] == <span class="number">98</span>, key[<span class="number">17</span>][<span class="number">14</span>] == <span class="number">46</span>, key[<span class="number">17</span>][<span class="number">15</span>] == <span class="number">44</span>, key[<span class="number">17</span>][<span class="number">16</span>] == <span class="number">138</span>, key[<span class="number">17</span>][<span class="number">17</span>] == <span class="number">135</span>, key[<span class="number">17</span>][<span class="number">18</span>] == <span class="number">191</span>, key[<span class="number">17</span>][<span class="number">19</span>] == <span class="number">144</span>, </span><br><span class="line">key[<span class="number">18</span>][<span class="number">0</span>] == <span class="number">13</span>, key[<span class="number">18</span>][<span class="number">1</span>] == <span class="number">240</span>, key[<span class="number">18</span>][<span class="number">2</span>] == <span class="number">143</span>, key[<span class="number">18</span>][<span class="number">3</span>] == <span class="number">53</span>, key[<span class="number">18</span>][<span class="number">4</span>] == <span class="number">75</span>, key[<span class="number">18</span>][<span class="number">5</span>] == <span class="number">23</span>, key[<span class="number">18</span>][<span class="number">6</span>] == <span class="number">26</span>, key[<span class="number">18</span>][<span class="number">7</span>] == <span class="number">224</span>, key[<span class="number">18</span>][<span class="number">8</span>] == <span class="number">31</span>, key[<span class="number">18</span>][<span class="number">9</span>] == <span class="number">199</span>, key[<span class="number">18</span>][<span class="number">10</span>] == <span class="number">182</span>, key[<span class="number">18</span>][<span class="number">11</span>] == <span class="number">220</span>, key[<span class="number">18</span>][<span class="number">12</span>] == <span class="number">130</span>, key[<span class="number">18</span>][<span class="number">13</span>] == <span class="number">61</span>, key[<span class="number">18</span>][<span class="number">14</span>] == <span class="number">170</span>, key[<span class="number">18</span>][<span class="number">15</span>] == <span class="number">130</span>, key[<span class="number">18</span>][<span class="number">16</span>] == <span class="number">253</span>, key[<span class="number">18</span>][<span class="number">17</span>] == <span class="number">240</span>, key[<span class="number">18</span>][<span class="number">18</span>] == <span class="number">182</span>, key[<span class="number">18</span>][<span class="number">19</span>] == <span class="number">9</span>, </span><br><span class="line">key[<span class="number">19</span>][<span class="number">0</span>] == <span class="number">245</span>, key[<span class="number">19</span>][<span class="number">1</span>] == <span class="number">96</span>, key[<span class="number">19</span>][<span class="number">2</span>] == <span class="number">170</span>, key[<span class="number">19</span>][<span class="number">3</span>] == <span class="number">79</span>, key[<span class="number">19</span>][<span class="number">4</span>] == <span class="number">249</span>, key[<span class="number">19</span>][<span class="number">5</span>] == <span class="number">16</span>, key[<span class="number">19</span>][<span class="number">6</span>] == <span class="number">121</span>, key[<span class="number">19</span>][<span class="number">7</span>] == <span class="number">6</span>, key[<span class="number">19</span>][<span class="number">8</span>] == <span class="number">7</span>, key[<span class="number">19</span>][<span class="number">9</span>] == <span class="number">69</span>, key[<span class="number">19</span>][<span class="number">10</span>] == <span class="number">212</span>, key[<span class="number">19</span>][<span class="number">11</span>] == <span class="number">133</span>, key[<span class="number">19</span>][<span class="number">12</span>] == <span class="number">52</span>, key[<span class="number">19</span>][<span class="number">13</span>] == <span class="number">20</span>, key[<span class="number">19</span>][<span class="number">14</span>] == <span class="number">225</span>, key[<span class="number">19</span>][<span class="number">15</span>] == <span class="number">102</span>, key[<span class="number">19</span>][<span class="number">16</span>] == <span class="number">228</span>, key[<span class="number">19</span>][<span class="number">17</span>] == <span class="number">121</span>, key[<span class="number">19</span>][<span class="number">18</span>] == <span class="number">56</span>, key[<span class="number">19</span>][<span class="number">19</span>] == <span class="number">208</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        <span class="built_in">sum</span>[i] += flag[j] * key[i][j]</span><br><span class="line">s.add(<span class="built_in">sum</span>[<span class="number">0</span>] == <span class="number">217114</span>, <span class="built_in">sum</span>[<span class="number">1</span>] == <span class="number">270581</span>, <span class="built_in">sum</span>[<span class="number">2</span>] == <span class="number">291585</span>, <span class="built_in">sum</span>[<span class="number">3</span>] == <span class="number">234325</span>, <span class="built_in">sum</span>[<span class="number">4</span>] == <span class="number">240502</span>, <span class="built_in">sum</span>[<span class="number">5</span>] == <span class="number">277604</span>, <span class="built_in">sum</span>[<span class="number">6</span>] == <span class="number">286168</span>, <span class="built_in">sum</span>[<span class="number">7</span>] == <span class="number">290450</span>, <span class="built_in">sum</span>[<span class="number">8</span>] == <span class="number">179355</span>, <span class="built_in">sum</span>[<span class="number">9</span>] == <span class="number">272487</span>, <span class="built_in">sum</span>[<span class="number">10</span>] == <span class="number">249816</span>, <span class="built_in">sum</span>[<span class="number">11</span>] == <span class="number">305636</span>, <span class="built_in">sum</span>[<span class="number">12</span>] == <span class="number">276217</span>, <span class="built_in">sum</span>[<span class="number">13</span>] == <span class="number">294166</span>, <span class="built_in">sum</span>[<span class="number">14</span>] == <span class="number">237236</span>, <span class="built_in">sum</span>[<span class="number">15</span>] == <span class="number">242008</span>, <span class="built_in">sum</span>[<span class="number">16</span>] == <span class="number">289929</span>, <span class="built_in">sum</span>[<span class="number">17</span>] == <span class="number">221788</span>, <span class="built_in">sum</span>[<span class="number">18</span>] == <span class="number">268459</span>, <span class="built_in">sum</span>[<span class="number">19</span>] == <span class="number">247407</span>)</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(m[flag[i]].as_long()) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)]))</span><br><span class="line">    <span class="comment"># have_fun_in_vm_hahaa</span></span><br></pre></td></tr></table></figure>



<h2 id="ezvm-vmre"><a href="#ezvm-vmre" class="headerlink" title="ezvm | vmre"></a>ezvm | vmre</h2><p>与上一个vm不同的是引入了寄存器和flag位 采用函数表的方式存放op 还是先弄懂每个op的含义 然后模拟出加密过程:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># emulate the procees of vm</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">op_1_extract_v_from_reg_by_hb</span></span><br><span class="line"><span class="string">op_1_extract_v_from_reg_by_lb</span></span><br><span class="line"><span class="string">op_2_save_in_reg_by_hb</span></span><br><span class="line"><span class="string">op_3_nop                      ; pt += 1</span></span><br><span class="line"><span class="string">op_4_add                      ; reg[hb] += reg[lb]</span></span><br><span class="line"><span class="string">op_5_minus                    ; reg[hb] -= reg[lb]</span></span><br><span class="line"><span class="string">op_6_mul                      ; reg[hb] *= reg[lb]</span></span><br><span class="line"><span class="string">op_7_div                      ; reg[hb] /= reg[lb]</span></span><br><span class="line"><span class="string">op_8_inc                      ; reg[hb] += 1</span></span><br><span class="line"><span class="string">op_9_dec                      ; reg[hb] -= 1</span></span><br><span class="line"><span class="string">op_10_xor                     ; reg[hb] ^= reg[lb]</span></span><br><span class="line"><span class="string">op_11_and                     ; reg[hb] &amp;= reg[lb]</span></span><br><span class="line"><span class="string">op_12_pop_in                  ; pop reg[hb] in stack</span></span><br><span class="line"><span class="string">op_13                         ; 组合op[9]接下来的4个数据(大端序)并入栈</span></span><br><span class="line"><span class="string">op_14                         ; esp += 4</span></span><br><span class="line"><span class="string">op_15                         ; reg[hb] = reg[lb]</span></span><br><span class="line"><span class="string">op_16                         ; reg[hb] = input[k]</span></span><br><span class="line"><span class="string">op_17                         ; input[k] = reg[hb]</span></span><br><span class="line"><span class="string">op_18                         ; check reg[3]:reg[3] = 1 -&gt; *op[9] -= *(op[9] + 1)</span></span><br><span class="line"><span class="string">op_19                         ; set reg[4]:reg[4] = sign of (reg[hb] - reg[lb])</span></span><br><span class="line"><span class="string">op_20                         ; check reg[4]:reg[4] == -1 -&gt; op[9] += 2 + *(op[9] + 1) else += 2</span></span><br><span class="line"><span class="string">op_21                         ; anti-op_20, reg[4] == 1</span></span><br><span class="line"><span class="string">op_22                         ; else reg[4] == 0</span></span><br><span class="line"><span class="string">op_23                         ; k++</span></span><br><span class="line"><span class="string">op_24                         ; k--</span></span><br><span class="line"><span class="string">op_25                         ; *(op[9] + i) ^= 0x66 for i in range(1, 16)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">stack = [<span class="number">0</span>] * <span class="number">0x100</span></span><br><span class="line">input_text = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">input</span>()]</span><br><span class="line">k = <span class="number">0</span></span><br><span class="line">reg = [<span class="number">0</span>] * <span class="number">5</span></span><br><span class="line">esp = <span class="built_in">len</span>(stack) - <span class="number">1</span></span><br><span class="line">opcode = [<span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1E</span>, <span class="number">0x71</span>, <span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, </span><br><span class="line">  <span class="number">0x73</span>, <span class="number">0x10</span>, <span class="number">0x67</span>, <span class="number">0x01</span>, <span class="number">0x7B</span>, <span class="number">0x74</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x75</span>, <span class="number">0x0B</span>, </span><br><span class="line">  <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1E</span>, <span class="number">0x71</span>, <span class="number">0x30</span>, <span class="number">0x7B</span>, <span class="number">0x75</span>, <span class="number">0x01</span>, </span><br><span class="line">  <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1E</span>, <span class="number">0x71</span>, <span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">0x10</span>, <span class="number">0x7A</span>, </span><br><span class="line">  <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x6D</span>, <span class="number">0x01</span>, <span class="number">0x74</span>, <span class="number">0x00</span>, <span class="number">0x75</span>, <span class="number">0x09</span>, <span class="number">0x66</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC7</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>, <span class="number">0x0C</span>, <span class="number">0xE5</span>, <span class="number">0x08</span>, </span><br><span class="line">  <span class="number">0xAD</span>, <span class="number">0xDE</span>, <span class="number">0xAF</span>, <span class="number">0xCD</span>, <span class="number">0x67</span>, <span class="number">0xBF</span>, <span class="number">0x1F</span>, <span class="number">0xBF</span>, <span class="number">0x1E</span>, <span class="number">0x68</span>, </span><br><span class="line">  <span class="number">0xFE</span>, <span class="number">0x25</span>, <span class="number">0xFD</span>, <span class="number">0x6F</span>, <span class="number">0x08</span>, <span class="number">0x50</span>, <span class="number">0xCD</span>, <span class="number">0x15</span>, <span class="number">0xB0</span>, <span class="number">0x21</span>, </span><br><span class="line">  <span class="number">0x8B</span>, <span class="number">0x3E</span>, <span class="number">0xFD</span>, <span class="number">0x73</span>, <span class="number">0xED</span>, <span class="number">0x90</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>]</span><br><span class="line">pointer_to_opcode = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> pointer_to_opcode &lt; <span class="built_in">len</span>(opcode):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;==================opcode: &quot;</span> + <span class="built_in">hex</span>(opcode[pointer_to_opcode]), opcode[pointer_to_opcode] - <span class="number">0x67</span> + <span class="number">4</span>, <span class="string">f&quot;is excuted=======================opcode at <span class="subst">&#123;pointer_to_opcode&#125;</span>=====================&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x66</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;failed&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x67</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] += reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>]  &amp; <span class="number">0xf</span>) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] += reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x68</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] -= reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>]  &amp; <span class="number">0xf</span>) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] -= reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x69</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] *= reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>]  &amp; <span class="number">0xf</span>) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] *= reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x6A</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] /= reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>]  &amp; <span class="number">0xf</span>) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] /= reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x6B</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] += 1&quot;</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] += <span class="number">1</span></span><br><span class="line">        pointer_to_opcode += <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x6C</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] -= 1&quot;</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] -= <span class="number">1</span></span><br><span class="line">        pointer_to_opcode += <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x6D</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] ^= reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>]  &amp; <span class="number">0xf</span>) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] ^= reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x6E</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] &amp;= reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>]  &amp; <span class="number">0xf</span>) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] &amp;= reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x6F</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;pop reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] in stack&quot;</span>)</span><br><span class="line">        esp -= <span class="number">1</span></span><br><span class="line">        stack[esp] = reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x70</span>:</span><br><span class="line">        data = opcode[pointer_to_opcode + <span class="number">1</span>] &lt;&lt; <span class="number">24</span> | opcode[pointer_to_opcode + <span class="number">2</span>] &lt;&lt; <span class="number">16</span> | opcode[pointer_to_opcode + <span class="number">3</span>] &lt;&lt; <span class="number">8</span> | opcode[pointer_to_opcode + <span class="number">4</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;pop &quot;</span> + <span class="built_in">hex</span>(data) + <span class="string">&quot; in stack&quot;</span>)</span><br><span class="line">        esp -= <span class="number">1</span></span><br><span class="line">        stack[esp] = data</span><br><span class="line">        pointer_to_opcode += <span class="number">5</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x71</span>:</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] = stack[esp]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;pop <span class="subst">&#123;stack[esp]&#125;</span> out to reg[<span class="subst">&#123;opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>&#125;</span>] and esp += 1&quot;</span>)</span><br><span class="line">        esp += <span class="number">1</span></span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x72</span>:</span><br><span class="line">        <span class="built_in">print</span>(reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] = reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>]  &amp; <span class="number">0xf</span>) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] = reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x73</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;] = input[&quot;</span> + <span class="built_in">str</span>(k) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">        reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] = input_text[k]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x74</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;input[&quot;</span> + <span class="built_in">str</span>(k) + <span class="string">&quot;] = reg[&quot;</span> + <span class="built_in">str</span>(opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) + <span class="string">&quot;]&quot;</span> )</span><br><span class="line">        input_text[k] = reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>]</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x75</span>:</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">3</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;jump to&quot;</span>, <span class="built_in">hex</span>(pointer_to_opcode - opcode[pointer_to_opcode + <span class="number">1</span>]))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;reg[3] = <span class="subst">&#123;reg[<span class="number">3</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            reg[<span class="number">3</span>] -= <span class="number">1</span></span><br><span class="line">            pointer_to_opcode -= opcode[pointer_to_opcode + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;not jump&quot;</span>)</span><br><span class="line">            pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x76</span>:</span><br><span class="line">        <span class="keyword">if</span> reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] == reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>]:</span><br><span class="line">            reg[<span class="number">4</span>] = <span class="number">0</span></span><br><span class="line">            pointer_to_opcode += <span class="number">2</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        reg[<span class="number">4</span>] = <span class="number">1</span> <span class="keyword">if</span> reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>] &gt; reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>] <span class="keyword">else</span> -<span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;set reg[4] to&quot;</span>, reg[<span class="number">4</span>], <span class="string">&quot;cause&quot;</span>, reg[opcode[pointer_to_opcode + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>], reg[opcode[pointer_to_opcode + <span class="number">1</span>] &amp; <span class="number">0x0F</span>])</span><br><span class="line">        pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x77</span>:</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">4</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;jump to&quot;</span>, <span class="built_in">hex</span>(pointer_to_opcode + opcode[pointer_to_opcode + <span class="number">1</span>]))</span><br><span class="line">            pointer_to_opcode += opcode[pointer_to_opcode + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;not jump cause reg[4] = &quot;</span>, reg[<span class="number">4</span>])</span><br><span class="line">            pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x78</span>:</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">4</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;jump to&quot;</span>, <span class="built_in">hex</span>(pointer_to_opcode + opcode[pointer_to_opcode + <span class="number">1</span>]))</span><br><span class="line">            pointer_to_opcode += opcode[pointer_to_opcode + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;not jump cause reg[4] = &quot;</span>, reg[<span class="number">4</span>])</span><br><span class="line">            pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x79</span>:</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">4</span>] == -<span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;jump to&quot;</span>, <span class="built_in">hex</span>(pointer_to_opcode + opcode[pointer_to_opcode + <span class="number">1</span>]))</span><br><span class="line">            pointer_to_opcode += opcode[pointer_to_opcode + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;not jump cause reg[4] = &quot;</span>, reg[<span class="number">4</span>])</span><br><span class="line">            pointer_to_opcode += <span class="number">2</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x7A</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;k++&quot;</span>)</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">        pointer_to_opcode += <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x7B</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;k--&quot;</span>)</span><br><span class="line">        k -= <span class="number">1</span></span><br><span class="line">        pointer_to_opcode += <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> opcode[pointer_to_opcode] == <span class="number">0x7C</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">16</span>):</span><br><span class="line">            <span class="built_in">print</span>(opcode[pointer_to_opcode + <span class="number">1</span>], <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;opcode[&quot;</span> + <span class="built_in">str</span>(pointer_to_opcode + i) + <span class="string">&quot;] ^= 0x66&quot;</span>)</span><br><span class="line">            stack[esp + i] ^= <span class="number">0x66</span></span><br><span class="line">        pointer_to_opcode += <span class="number">16</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    pointer_to_opcode += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>发现加密过程就是flag的每一位+&#x3D;下一位(除最后一位) 然后再逆序每一位^&#x3D;上一位(除第一位) 据此写出keygen:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0xC7</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>, <span class="number">0x0C</span>, <span class="number">0xE5</span>, <span class="number">0x08</span>, <span class="number">0xAD</span>, <span class="number">0xDE</span>, <span class="number">0xAF</span>, <span class="number">0xCD</span>, </span><br><span class="line">  <span class="number">0x67</span>, <span class="number">0xBF</span>, <span class="number">0x1F</span>, <span class="number">0xBF</span>, <span class="number">0x1E</span>, <span class="number">0x68</span>, <span class="number">0xFE</span>, <span class="number">0x25</span>, <span class="number">0xFD</span>, <span class="number">0x6F</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x50</span>, <span class="number">0xCD</span>, <span class="number">0x15</span>, <span class="number">0xB0</span>, <span class="number">0x21</span>, <span class="number">0x8B</span>, <span class="number">0x3E</span>, <span class="number">0xFD</span>, <span class="number">0x73</span>, </span><br><span class="line">  <span class="number">0xED</span>, <span class="number">0x90</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">    enc[i] ^= enc[i - <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">    enc[i - <span class="number">1</span>] -= enc[i]</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(enc[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># begin&#123;r3@11y_A_B4by_34$y_FK_Vm!&#125;</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Reverse/" rel="tag"># Reverse</a>
              <a href="/tags/Writeups/" rel="tag"># Writeups</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/02/23/NBCTF2024%E9%80%86%E5%90%91%E6%96%B9%E5%90%91wp/" rel="prev" title="NBCTF2024逆向方向wp">
      <i class="fa fa-chevron-left"></i> NBCTF2024逆向方向wp
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/02/23/LACTF2024%E9%80%86%E5%90%91%E6%96%B9%E5%90%91%E9%83%A8%E5%88%86wp/" rel="next" title="LACTF2024逆向方向部分wp">
      LACTF2024逆向方向部分wp <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#superguesser-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="nav-number">1.</span> <span class="nav-text">superguesser | 动态调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezpython-%E6%B3%A8%E5%85%A5%E8%A7%A3%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">ezpython | 注入解法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#24-3-23%E6%9B%B4%E6%96%B0%E6%AD%A3%E5%B8%B8%E8%A7%A3"><span class="nav-number">2.1.</span> <span class="nav-text">24&#x2F;3&#x2F;23更新正常解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#goforfun-go%E8%AF%AD%E8%A8%80%E9%80%86%E5%90%91"><span class="nav-number">3.</span> <span class="nav-text">goforfun | go语言逆向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#not-main-%E5%8F%8D%E8%B0%83%E8%AF%95"><span class="nav-number">4.</span> <span class="nav-text">not main | 反调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E7%9A%84%E5%AF%86%E7%A0%81%E6%98%AF%E4%BB%80%E4%B9%88-%E4%B8%8D%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88%E5%8A%A0%E5%AF%86-%E6%B7%B7%E6%B7%86"><span class="nav-number">5.</span> <span class="nav-text">出题人的密码是什么 | 不知道什么加密 | 混淆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%84%E8%AF%AD%E5%AD%A6%E4%B9%A0-%E9%98%B2%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="nav-number">6.</span> <span class="nav-text">俄语学习 | 防静态分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E7%99%BD%E6%9C%BA-%E7%AE%80%E5%8D%95%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">7.</span> <span class="nav-text">红白机 | 简单虚拟机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#stick-game-js%E6%B7%B7%E6%B7%86"><span class="nav-number">8.</span> <span class="nav-text">stick game | js混淆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xor"><span class="nav-number">9.</span> <span class="nav-text">xor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#babyvm-vmre"><span class="nav-number">10.</span> <span class="nav-text">babyvm | vmre</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezvm-vmre"><span class="nav-number">11.</span> <span class="nav-text">ezvm | vmre</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="1K0CT B14s"
      src="/images/myavatar.gif">
  <p class="site-author-name" itemprop="name">1K0CT B14s</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        <!--
-->

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">1K0CT B14s</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">367k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:34</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
